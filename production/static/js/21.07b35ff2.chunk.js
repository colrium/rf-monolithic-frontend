(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[21],{1357:function(e,t,a){e.exports=a.p+"static/media/empty-state-table.cdb06dd9.svg"},1384:function(e,t,a){"use strict";var n=a(6),r=a(9),i=a.n(r),o=a(20),s=a(12),l=a(2),c=a(14),d=a(26),u=a(27),p=a(18),m=a(17),h=a(255),f=a(43),b=a.n(f),v=a(22),g=a(16),y=a(21),w=a(0),O=a.n(w),E=a(35),x=a(63),C=a.n(x),j=a(1625),k=a(1496),_=a(1497),D=a(213),N=a(461),S=a(1248),R=a(1402),A=a.n(R),q=a(1424),P=a.n(q),M=a(1423),F=a.n(M),I=a(1403),V=a.n(I),T=a(55),L=a(59),B=a(94),J=a(264),U=a.n(J),z=a(263),W=a.n(z),K=a(412),Y=a(1357),Z=a.n(Y),H=a(1311),X=a(1346),G=a(1679),$=a(2032),Q=a(1316),ee=a(1456),te=a.n(ee),ae=a(3),ne=a(42),re=a(431),ie=a(691),oe=a(432),se=a(433),le=a(92),ce=a(77),de=a(33),ue=a(45),pe=a(437),me=b()({indicator:{backgroundColor:ae.b.hex.accent}})(X.a),he=b()((function(e){return{root:{textTransform:"none",minWidth:50,fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(),"&:hover":{color:ae.b.hex.default,opacity:1},"&$selected":{color:ae.b.hex.accent,fontWeight:e.typography.fontWeightMedium},"&:focus":{color:ae.b.hex.accent}},selected:{}}}))((function(e){return O.a.createElement(H.a,e)})),fe=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=O.a.createRef(),n.state={view:"month",view_title:(new Date).format(ce.b.dateformats.month),calendars:[],tasks:[],schedules:[]},n.handleChangeCalendarView=function(e,t){if(n.calendarRef.current){var a=n.calendarRef.current.getInstance().getDate().toDate();n.setState((function(e){return{view:t,view_title:"day"===t?a.format(ce.b.dateformats.date):"week"===t?a.format(ce.b.dateformats.week):a.format(ce.b.dateformats.month)}}))}else n.setState((function(e){return{view:t}}))},n.handleClickPrevButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.prev();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleClickNextButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.next();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleOnEditEntryClick=function(e){n.calendarRef.current},n.handleOnDeleteEntryClick=function(e){n.calendarRef.current};var r=e.theme,i=e.view,o=e.calendars,s=e.tasks,d=e.schedules,p=e.show_actions,m=e.icon,h=e.title,f=e.subtitle,b=e.icon_color,v=e.title_color,g=e.subtitle_color,y=e.calendarProps;return n.state=Object(l.a)(Object(l.a)({},n.state),{},{theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:o,tasks:s,schedules:d,show_actions:p,icon:m,title:h,subtitle:f,icon_color:b,title_color:v,subtitle_color:g,calendarProps:y}),n.handleChangeCalendarView=n.handleChangeCalendarView.bind(Object(u.a)(n)),n.handleClickPrevButton=n.handleClickPrevButton.bind(Object(u.a)(n)),n.handleClickNextButton=n.handleClickNextButton.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.initCalendarEvents()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{refreshRequired:!Object.areEqual(e,this.props)}}},{key:"componentDidUpdate",value:function(e,t,a){var n=this.props,r=n.theme,i=n.view,o=n.calendars,s=n.tasks,l=n.schedules,c=n.show_actions,d=n.icon,u=n.title,p=n.subtitle,m=n.icon_color,h=n.title_color,f=n.subtitle_color,b=n.calendarProps;a.refreshRequired&&this.setState({theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:o,tasks:s,schedules:l,show_actions:c,icon:d,title:u,subtitle:p,icon_color:m,title_color:h,subtitle_color:f,calendarProps:b},this.initCalendarEvents)}},{key:"initCalendarEvents",value:function(){var e=this.props,t=e.onSelect,a=e.onClickEntry,n=e.onClickEdit,r=e.onClickDelete,i=this.calendarRef.current.getInstance();i&&i.on({clickSchedule:function(e){de.e.isOfType(a,"function")&&a(e.schedule)},beforeCreateSchedule:function(e){de.e.isOfType(t,"function")&&t(e)},beforeUpdateSchedule:function(e){de.e.isOfType(n,"function")&&n(e)},beforeDeleteSchedule:function(e){de.e.isOfType(r,"function")&&r(e)}})}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.height,n=e.defaultView,r=e.disableDblClick,i=e.disableClick,o=e.isReadOnly,s=e.useDetailPopup,c=e.useCreationPopup,d=e.scheduleView,u=e.taskView,p=this.state,m=p.theme,h=p.view,f=p.view_title,b=p.calendars,w=p.tasks,E=p.schedules,x=(p.show_actions,p.icon),C=p.title,j=p.subtitle,k=p.icon_color,_=(p.title_color,p.subtitle_color,p.calendarProps),D=Object(l.a)({height:a+"px",defaultView:n,disableDblClick:r,disableClick:i,isReadOnly:o,useDetailPopup:s,useCreationPopup:c,scheduleView:d,taskView:u},_);return O.a.createElement(re.a,{elevation:0,outlineColor:"#cfd8dc"},O.a.createElement(se.a,{avatar:O.a.createElement(ne.a,{"aria-label":C,style:{background:k}},x),title:C,subheader:j}),O.a.createElement(oe.a,{className:"p-0 m-0"},O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{sm:6,md:4},O.a.createElement(me,{value:h,onChange:this.handleChangeCalendarView,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"view change tabs"},O.a.createElement(he,{value:"month",label:"Month"}),O.a.createElement(he,{value:"week",label:"Week"}),O.a.createElement(he,{value:"day",label:"Day"}))),O.a.createElement(g.a,{sm:6,md:4},O.a.createElement(y.a,{variant:"h3",center:!0}," ",f," ")),O.a.createElement(g.a,{sm:12,md:4},O.a.createElement("div",{className:"float-right"},O.a.createElement(B.a,{onClick:this.handleClickPrevButton},O.a.createElement(G.a,null)),O.a.createElement(B.a,{onClick:this.handleClickNextButton},O.a.createElement($.a,null))))),O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{xs:12},O.a.createElement(te.a,Object.assign({theme:m,view:h,className:t.calendar,calendars:b,tasks:w,schedules:E,ref:this.calendarRef},D)))))),O.a.createElement(ie.a,null,O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{variant:"subtitle2",display:"block",color:"default",gutterBottom:!0}," ","Calendar index"," ")),O.a.createElement(g.a,{xs:12},b.map((function(e,t){return O.a.createElement(le.a,{color:e.bgColor?e.bgColor:ae.b.hex.secondary,text:e.name,key:"calendar-"+t})}))))))}}]),a}(O.a.Component);fe.defaultProps={calendars:[],tasks:[],schedules:[],view:"month",theme:{"common.border":"1px solid rgba("+ae.b.rgb.grey+", 0.5)","common.backgroundColor":"#fcfcfc","common.holiday.color":ae.b.hex.grey,"common.saturday.color":ae.b.hex.grey,"common.dayname.color":ae.b.hex.default,"common.today.color":ae.b.hex.primary,"week.currentTime.color":ae.b.hex.primarydark},show_actions:!0,icon:O.a.createElement(Q.a,null),title:"My",subtitle:"Calendar",icon_color:ae.b.hex.primary,title_color:ae.b.hex.primary,subtitle_color:ae.b.hex.grey,calendarProps:{},height:900,defaultView:"month",disableDblClick:!0,disableClick:!1,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!0};var be=Object(ue.a)(b()(pe.a)(fe)),ve=a(170),ge=a(11),ye=a(50),we=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=O.a.createRef(),n.state={loading:!0,load_error:!1,records:[]},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;r({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{}}),n.state.service.delete(e).then((function(e){i(),n.loadData()})).catch((function(e){console.log("CalendarView delete error",e),i()}))}};var r=e.defination,i=e.service,o=e.query;e.app;return n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1}):{p:1},n.handleEditItem=n.handleEditItem.bind(Object(u.a)(n)),n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.loadContext()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination)&&!Object.areEqual(e.service,this.props.service),dataReloadRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&this.loadContext(),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"componentWillUnmount",value:function(){var e=this.props;e.openDialog;(0,e.closeDialog)()}},{key:"handleEditItem",value:function(e){var t=this.props.auth;this.state.defination.access.actions.update.restricted(t.user)||(window.location.href="/"+this.state.defination.access.actions.update.uri(e.schedule.id))}},{key:"handleDeleteItemConfirm",value:function(e){var t=this.props,a=t.openDialog,n=t.closeDialog;a({title:"Confirm Delete",body:"Are you sure you want delete "+e.schedule.title+"? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return n()}},delete:{text:"Delete",color:"error",onClick:this.handleDeleteItem(e.schedule.id)}}})}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.auth;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},calendars:[{id:t.name,name:t.label,bgColor:t.color,borderColor:t.color}],records:[],loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n)if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){console.log("calendar data",t),Function.isFunction(o)&&o(t,e.state.query),e.prepareData(t)})).catch((function(t){console.log("calendar error",t),e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l,this.state.query),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.calendarview.resolveData)&&r.views.listing.calendarview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props.classes;return O.a.createElement(v.a,{className:e.root},this.state.defination&&O.a.createElement(g.a,{className:"p-0 m-0",xs:12},this.state.loading?O.a.createElement(v.a,{className:e.full_height,justify:"center",alignItems:"center"},O.a.createElement(g.a,{xs:1},O.a.createElement(ve.a,{size:24,thickness:4,className:e.progress,color:"secondary",disableShrink:!0}))):O.a.createElement(v.a,{className:"p-0 m-0"},this.state.load_error?O.a.createElement(v.a,null,O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},O.a.createElement(K.a,{fontSize:"large"},"error"))),O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{color:"error",variant:"body1",center:!0,fullWidth:!0},"An error occured.",O.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,O.a.createElement("br",null),this.state.load_error.msg))):O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{xs:12},O.a.createElement(be,{icon:this.state.defination.icon,title:this.state.defination.label,title_color:this.state.defination.color,icon_color:this.state.defination.color,subtitle:"",calendars:this.state.calendars,view:"month",schedules:this.state.records,className:e.calendar,onClickEdit:this.handleEditItem,onClickDelete:this.handleDeleteItemConfirm}))):O.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},O.a.createElement("img",{alt:"Empty list",className:e.emptyImage,src:Z.a}),O.a.createElement(y.a,{className:e.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",this.state.defination.label?this.state.defination.label:"Records"," ","found")))))))}}]),a}(O.a.Component);we.defaultProps={calendarProps:{height:"900px",defaultView:"month",disableDblClick:!0,disableClick:!0,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!1},query:{p:1},cache_data:!0,load_data:!0};var Oe=Object(ye.a)(C()(b()((function(e){return{root:{padding:"0"}}})),Object(E.b)((function(e){return{auth:e.auth,app:e.app}}),{apiCallRequest:ge.gb,openDialog:ge.sb,closeDialog:ge.pb}))(we)),Ee=(a(1390),a(1407)),xe=a(1338),Ce=a(1204),je=a(1207),ke=a(1280),_e=a(1284),De=a(1250),Ne=a(1409),Se=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,raw_records:[],records:[]},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props.dispatch;Object(u.a)(n);a(ge.sb({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return a(ge.pb())}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}}))}},n.handleDeleteItem=function(e){return function(e){var t=n.props.dispatch;t(ge.sb({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return t(ge.pb())}}}}))}};e.defination;return n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.cache;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n){if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(o)&&o(t,e.state.query),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else if(i){var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l,this.state.query),this.prepareData(l)}}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=a.auth,r=a.cache,i=a.defination,o=a.entryItemProps,s=Array.isArray(t)?t:Array.isArray(r.data[i.name])?r.data[i.name]:[];i&&i.scope.columns;Function.isFunction(i.views.listing.listview.resolveData)&&i.views.listing.listview.resolveData(s,n.user,o).then((function(a){e.setState((function(e){return{raw_records:t,records:a,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],raw_records:[],loading:!1}}))}))}},{key:"prepareForData",value:function(){var e=this.props,t=(e.classes,e.defination);e.auth,e.dispatch,t.scope.columns;this.state.records=[],this.state.loading=!1}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=(t.service,t.onClickEntry);return O.a.createElement(v.a,{className:a.root},O.a.createElement(g.a,{className:"p-0 m-0",xs:12},this.state.loading?O.a.createElement(v.a,null,O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-8/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-4/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-5/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-9/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-4/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),O.a.createElement(g.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},O.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),O.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},O.a.createElement(Ne.a,{variant:"text",className:"w-4/12"})))):O.a.createElement(v.a,{className:"p-0 m-0"},this.state.load_error?O.a.createElement(v.a,null,O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},O.a.createElement(K.a,{fontSize:"large"},"error"))),O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{color:"error",variant:"body1",className:"w-full text-center",center:!0,fullWidth:!0},"An error occured.",O.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,O.a.createElement("br",null),this.state.load_error.msg))):O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{xs:12},O.a.createElement(Ce.a,{className:"p-0 transparent-bg"},this.state.records.map((function(t,i){return O.a.createElement("div",{key:n.name+"-"+i},O.a.createElement(je.a,{button:!0,alignItems:"flex-start",onClick:function(){Function.isFunction(r)&&r(e.state.raw_records[i],i)},className:a.listItem},t.avatar&&O.a.createElement(ke.a,null," ",t.avatar," "),t.icon&&O.a.createElement(_e.a,null," ",t.icon," "),O.a.createElement(De.a,{primary:t.title,secondary:t.body})),O.a.createElement(xe.a,{component:"li"}))}))))):O.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},O.a.createElement("img",{alt:"Empty list",className:a.emptyImage,src:Z.a}),O.a.createElement(y.a,{className:a.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",n.label?n.label:"Records"," ","found")))))))}}]),a}(O.a.Component);Se.defaultProps={show_actions:!0,show_links:!0,query:{p:1},load_data:!0,cache_data:!0};var Re=C()(b()((function(e){return{root:{padding:"0"},listItem:{background:"transparent",transition:e.transitions.create("background",{easing:e.transitions.easing.sharp,duration:50}),"&:hover":{background:e.palette.action.hover}}}})),Object(E.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:ge.gb,openDialog:ge.sb,closeDialog:ge.pb}),ye.a)(Se),Ae=a(1258),qe=(a(1393),a(1209)),Pe=(a(1406),a(1463)),Me=a.n(Pe),Fe=a(348),Ie=a.n(Fe),Ve=a(1382),Te=a.n(Ve),Le=a(1442),Be=a.n(Le),Je=a(1441),Ue=a.n(Je),ze=a(453),We=a.n(ze),Ke=a(1464),Ye=a.n(Ke),Ze=a(1465),He=a.n(Ze),Xe=a(1401),Ge=a.n(Xe),$e=a(1467),Qe=a.n($e),et=a(1466),tt=a.n(et),at=a(1468),nt=a.n(at),rt=a(1435),it=a.n(rt),ot=a(67),st=a(41),lt=a(74),ct={Add:Object(w.forwardRef)((function(e,t){return O.a.createElement(Me.a,Object.assign({},e,{ref:t}))})),Check:Object(w.forwardRef)((function(e,t){return O.a.createElement(Te.a,Object.assign({},e,{ref:t}))})),Clear:Object(w.forwardRef)((function(e,t){return O.a.createElement(We.a,Object.assign({},e,{ref:t}))})),Delete:Object(w.forwardRef)((function(e,t){return O.a.createElement(Ye.a,Object.assign({},e,{ref:t}))})),DetailPanel:Object(w.forwardRef)((function(e,t){return O.a.createElement(Ue.a,Object.assign({},e,{ref:t}))})),Edit:Object(w.forwardRef)((function(e,t){return O.a.createElement(He.a,Object.assign({},e,{ref:t}))})),Export:Object(w.forwardRef)((function(e,t){return O.a.createElement(tt.a,Object.assign({},e,{ref:t}))})),Filter:Object(w.forwardRef)((function(e,t){return O.a.createElement(Ge.a,Object.assign({},e,{ref:t}))})),FirstPage:Object(w.forwardRef)((function(e,t){return O.a.createElement(A.a,Object.assign({},e,{ref:t}))})),LastPage:Object(w.forwardRef)((function(e,t){return O.a.createElement(V.a,Object.assign({},e,{ref:t}))})),NextPage:Object(w.forwardRef)((function(e,t){return O.a.createElement(Ue.a,Object.assign({},e,{ref:t}))})),PreviousPage:Object(w.forwardRef)((function(e,t){return O.a.createElement(Be.a,Object.assign({},e,{ref:t}))})),ResetSearch:Object(w.forwardRef)((function(e,t){return O.a.createElement(We.a,Object.assign({},e,{ref:t}))})),Search:Object(w.forwardRef)((function(e,t){return O.a.createElement(W.a,Object.assign({},e,{ref:t}))})),SortArrow:Object(w.forwardRef)((function(e,t){return O.a.createElement(Ie.a,Object.assign({},e,{ref:t}))})),ThirdStateCheck:Object(w.forwardRef)((function(e,t){return O.a.createElement(Qe.a,Object.assign({},e,{ref:t}))})),ViewColumn:Object(w.forwardRef)((function(e,t){return O.a.createElement(nt.a,Object.assign({},e,{ref:t}))}))},dt=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},dt_columns:[],records:[],raw_data:[],raw_data_mutated:!1,mouseX:null,mouseY:null,actionsView:"contextMenu",context:null},n.handleSocketsOnCreate=function(e){var t=n.props,a=t.defination,r=(t.sockets,e.context),i=e.action;n.state.raw_data;a.model===r&&n.setState((function(e){var t=e.raw_data;console.log("handleSocketsOnCreate context",r),console.log("handleSocketsOnCreate action",i);var a=Array.isArray(t)?t:[];return a.unshift(i.result),console.log("handleSocketsOnCreate new_raw_data",a),{raw_data:a,raw_data_mutated:!0}}))},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;Object(u.a)(n);r({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return i()}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}})}},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog;(0,a.closeDialog)(),e._id&&(e=e._id),n.state.service.delete(e).then((function(t){n.setState((function(t){var a=t.records;return Array.isArray(a)&&(a=a.filter((function(t){if(t.entry){if(t.entry._id===e)return!1}else if(t._id===e)return!1;return!0}))),Array.isArray(a)||(a=[]),{records:a}}))})).catch((function(e){r({title:"Delete failed",body:e.msg,actions:{}})}))}},n.handleOnRowContextMenu=function(e){return function(t){t.preventDefault();var a=t.clientX-2,r=t.clientY-4;console.log("this.state.raw_data[index]",n.state.raw_data[e]),n.setState((function(t){return{mouseX:a,mouseY:r,context:t.raw_data[e]}}))}},n.handleOnRowContextMenuClose=function(e){e.preventDefault(),n.setState({mouseX:null,mouseY:null})};var r=e.defination,i=e.service,o=e.query,s=e.cache.data;return n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1}):{p:1},n.state.records=Array.isArray(s[r.name])?s[r.name]:[],n.mounted=!1,n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n.handleOnRowContextMenu=n.handleOnRowContextMenu.bind(Object(u.a)(n)),n.handleSocketsOnCreate=n.handleSocketsOnCreate.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination,n=e.sockets;n&&n.default&&n.default.on("create",this.handleSocketsOnCreate),this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;if(this.mounted=!0,a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var r=this.props.query;this.setState({query:r?Object(l.a)(Object(l.a)({},r),{},{p:1}):{p:1}},(function(){n.loadData(r?Object(l.a)(Object(l.a)({},r),{},{p:1}):{p:1})}))}this.state.raw_data_mutated&&this.setState({raw_data_mutated:!1},this.prepareData(this.state.raw_data))}},{key:"componentWillUnmount",value:function(){var e=this.props.sockets;e&&e.default&&e.default.off("create",this.handleSocketsOnCreate)}},{key:"loadContext",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=t.service,i=t.query,o=t.auth;t.actionsType;if(n){var c=n.scope.columns,d=[];if(!n.access.restricted(o.user)){d.push({title:String.isString(n.label)?n.label.singularize():"ID",field:"_id"});for(var u=function(){var t=Object(s.a)(m[p],2),n=t[0],r=t[1],i=!0;r.restricted&&"display"in r.restricted&&"function"===typeof r.restricted.display&&(i=!r.restricted.display(!1,o.user)),i&&(Function.isFunction(e.state.defination.views.listing.tableview.resolveData)?r.reference||r.possibilities?d.push(Object(l.a)({field:n,title:r.label,render:function(e){return Array.isArray(e[n])?O.a.createElement(v.a,{spacing:2},e[n].map((function(e,t){return O.a.createElement("div",{key:t},e," ")}))):e||""}},r.tableProps)):d.push(Object(l.a)({field:n,title:r.label},r.tableProps)):r.reference&&"file"!==r.input.type&&!r.isAttachment?d.push(Object(l.a)({field:n,title:r.label,render:function(e){return Array.isArray(e[n])?O.a.createElement(v.a,{spacing:2},e[n].map((function(e,t){return O.a.createElement(Ae.a,{className:a.valueChip,key:e.value,label:e.resolve})}))):Boolean(e[n])?O.a.createElement(Ae.a,{label:e[n].resolve}):""}},r.tableProps)):r.reference&&("file"===r.input.type||r.isAttachment)?d.push(Object(l.a)({field:n,title:r.label,render:function(e){return Array.isArray(e[n])?O.a.createElement(v.a,{spacing:2},e[n].map((function(e,t){return O.a.createElement(Ae.a,{className:a.valueChip,avatar:O.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e.resolve)?st.attachments.getAttachmentFileUrl(e.value):void 0},de.c.fileIcon(e.resolve)),label:e.resolve,onClick:function(t){t.preventDefault(),window.open(st.attachments.getAttachmentFileUrl(e.value),"_blank").focus()},key:"file-"+e.value})}))):Boolean(e[n])?O.a.createElement(Ae.a,{avatar:O.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e[n].resolve)?st.attachments.getAttachmentFileUrl(e[n].value):void 0},de.c.fileIcon(e[n].resolve)),onClick:function(t){t.preventDefault(),window.open(st.attachments.getAttachmentFileUrl(e[n].value),"_blank").focus()},label:e[n].resolve}):""}},r.tableProps)):d.push(Object(l.a)({field:n,title:r.label},r.tableProps)))},p=0,m=Object.entries(c);p<m.length;p++)u()}this.setState({defination:n,service:r,query:i?Object(l.a)(Object(l.a)({},i),{},{p:1}):{p:1},dt_columns:d,records:[],loading:!1},(function(){e.loadData(i?Object(l.a)(Object(l.a)({},i),{},{p:1}):{p:1})}))}}},{key:"parseData",value:function(e){for(var t=this.props,a=t.defination,n=t.auth,r=e,i=a.scope.columns,o=0,l=Object.entries(i);o<l.length;o++){var c=Object(s.a)(l[o],2),d=c[0],u=c[1];if("date"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.date):r[d]=""),"datetime"===u.input.type&&e[d]&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.datetime):r[d]=""),"time"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.time):r[d]=""),"boolean"===u.type&&(e[d]?r[d]="Yes":r[d]="No"),JSON.isJSON(r[d])&&!u.reference&&(r[d]=JSON.stringify(r[d])),u.possibilities)if(JSON.isJSON(u.possibilities))e[d]in u.possibilities&&(r[d]=u.possibilities[e[d]]);else if(Function.isFunction(u.possibilities)){var p=u.possibilities(e,n.user);JSON.isJSON(p)&&e[d]in p&&(r[d]=p[e[d]])}}return r}},{key:"loadData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=this.props,n=(a.auth,a.cache),r=a.defination,i=a.apiCallRequest,o=a.cache_data,s=a.onLoadData,l=a.load_data;if(r)if(l)this.setState({loading:!0,load_error:!1}),i(r.name,{uri:r.endpoint,type:"records",params:t,data:{},cache:o}).then((function(a){Function.isFunction(s)&&s(a,t),e.setState({loading:!1}),e.prepareData(a)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var c=Array.isArray(n.data[r.name])?n.data[r.name]:[];this.prepareData(c),Function.isFunction(s)&&s(c,t)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.props,a=t.auth,n=t.cache,r=t.defination,i=Array.isArray(e)?e:Array.isArray(n.data[r.name])?n.data[r.name]:[],o=r?r.scope.columns:{},s=[];s=de.d.resolveReferenceColumnsDisplays(i,o,a.user);var l=this,c=s.map((function(e){return l.parseData(e)}));this.setState((function(e){return{records:c}}))}},{key:"downloadCSV",value:function(e){e.toCSV()}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.defination,n=e.api,r=(e.cache,e.actionsType),i=e.history;e.location;return O.a.createElement(v.a,{className:t.root},O.a.createElement(g.a,{className:"p-0 m-0",xs:12},this.state.loading&&O.a.createElement(v.a,{className:t.full_height,justify:"center",alignItems:"center"},O.a.createElement(g.a,{xs:12,className:"flex relative flex-row"},O.a.createElement("div",{className:"flex-grow"},O.a.createElement(Ne.a,{variant:"text",width:150})),O.a.createElement("div",{className:"flex"},O.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),O.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),O.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),O.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}))),O.a.createElement(g.a,{xs:12},O.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),O.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),O.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),O.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}))),!this.state.loading&&Array.isArray(this.state.records)&&O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{className:"p-0 m-0",xs:12},"context"===r&&O.a.createElement(qe.a,{onContextMenu:this.handleOnRowContextMenuClose,onClickAway:this.handleOnRowContextMenuClose},O.a.createElement(N.a,{open:null!==this.state.mouseY,onClose:this.handleOnRowContextMenuClose,anchorReference:"anchorPosition",anchorPosition:null!==this.state.mouseY&&null!==this.state.mouseX?{top:this.state.mouseY,left:this.state.mouseX}:void 0},O.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Copy"),O.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Print"),O.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Highlight"),O.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Email"))),this.state.records.length>0?O.a.createElement(it.a,{icons:ct,columns:this.state.dt_columns,data:this.state.records,options:{search:!1,exportButton:!0,exportCsv:function(e,t){var n={};e.map((function(e){n[e.field]=e.title})),t.unshift(n),t.forEach((function(e){Object.entries(e).map((function(t){var a=Object(s.a)(t,2),n=a[0],r=a[1];JSON.isJSON(r)&&(e[n]=r.resolve)}))})),t.toCSV((a?a.label:"Records")+" - "+(new Date).format("d M Y H:i:s A")+".csv")},paging:!1},title:(n.loading?"Loading ":"")+a.label+(n.loading?"...":""),onRowClick:function(e,t){i.push(("/"+a.name+"/view/"+t._id).toUriWithDashboardPrefix())}}):O.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},O.a.createElement("img",{alt:"Empty list",className:t.emptyImage,src:Z.a}),O.a.createElement(y.a,{className:t.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",a.label?a.label:"Records"," ","found")))),!!n&&(n.busy&&n.error)&&O.a.createElement(v.a,null,O.a.createElement(g.a,{xs:12},O.a.createElement(y.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg+" \n Displaying cached data."))))))}}]),a}(O.a.Component);dt.defaultProps={show_actions:!0,show_links:!0,query:{p:1},cache_data:!0,load_data:!0,actionsType:"inline"};var ut=C()(b()((function(e){return{root:{padding:"0"},data_actions_wrapper:{display:"inline-block",whiteSpace:"nowrap","& > *":{display:"inline-block",whiteSpace:"nowrap"}},valueChip:{margin:e.spacing(.5)},emptyImage:{maxWidth:200,width:"100%"},emptyText:{marginTop:e.spacing(3)}}})),lt.c,ot.i,Object(E.b)((function(e,t){return{auth:e.auth,cache:e.cache,api:e.api}}),{openDialog:ge.sb,closeDialog:ge.pb,apiCallRequest:ge.gb}))(dt);function pt(e){var t=Object(T.a)(),a=e.count,n=e.page,r=e.rowsPerPage,i=e.onChangePage;return O.a.createElement("div",{className:"ml-2 flex-shrink-0"},O.a.createElement(B.a,{onClick:function(e){i(e,0)},disabled:0===n,"aria-label":"first page"},"rtl"===t.direction?O.a.createElement(V.a,null):O.a.createElement(A.a,null)),O.a.createElement(B.a,{onClick:function(e){i(e,n-1)},disabled:0===n,"aria-label":"previous page"},"rtl"===t.direction?O.a.createElement(F.a,null):O.a.createElement(P.a,null)),O.a.createElement(B.a,{onClick:function(e){i(e,n+1)},disabled:n>=Math.ceil(a/r)-1,"aria-label":"next page"},"rtl"===t.direction?O.a.createElement(P.a,null):O.a.createElement(F.a,null)),O.a.createElement(B.a,{onClick:function(e){i(e,Math.max(0,Math.ceil(a/r)-1))},disabled:n>=Math.ceil(a/r)-1,"aria-label":"last page"},"rtl"===t.direction?O.a.createElement(A.a,null):O.a.createElement(V.a,null)))}var mt=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={defination:null,service:null,view:"tableview",views:{},showViewOptions:!0,showAddBtn:!0,searchKeyword:"",query:{},pages:10,page:1,viewMenuAnchorEl:null,sortFields:[],filterAccordionExpanded:!1,filterableFields:{},filterContext:!1,filterMenuAnchor:null,filters:{values:{},labels:{}}},n.mounted=!1,n.searchkeywordRef=O.a.createRef(),n.handleViewItemClick=function(e){return function(t){n.mounted?n.setState({view:e,viewMenuAnchorEl:null}):(n.state.view=e,n.state.viewMenuAnchorEl=null)}},n.handleShowViewsMenu=function(e){var t=e.currentTarget;n.mounted?n.setState({viewMenuAnchorEl:t}):n.state.viewMenuAnchorEl=t},n.handleCloseViewsMenu=function(){n.mounted?n.setState({viewMenuAnchorEl:null}):n.state.viewMenuAnchorEl=null},n.handleOnPageChanged=function(e,t){n.setState((function(e){return{page:t+1,query:Object(l.a)(Object(l.a)({},e.query),{},{page:t+1}),viewMenuAnchorEl:null}}))},n.handleOnRecordsPerPageChanged=function(e){var t=Number.parseNumber(e.target.value,n.state.query.pagination);n.setState((function(e){return{page:1,query:Object(l.a)(Object(l.a)({},e.query),{},{pagination:t})}}))};var r=e.defination,i=e.service,o=e.query,d=(e.cache,e.app);n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1,pagination:"rpp"in o?o.rpp:"pagination"in o?o.pagination:d.preferences.data.pagination,page:"pg"in o?o.pg:"page"in o?o.page:1}):{p:1,pagination:"rpp"in o?o.rpp:"pagination"in o?o.pagination:d.preferences.data.pagination,page:"pg"in o?o.pg:"page"in o?o.page:1};var p={},m=!1,h="";if(Object.entries(r.scope.columns).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(p[n]=r)})),JSON.isJSON(o)){var f=!1,b=Object.keys(p);Object.entries(o).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];!f&&b.includes(a)&&(m=a,h=n,h=String.isString(n)?n:String(n),f=!0)}))}return m||!o.q&&!o.query?(n.state.searchKeyword=h,n.state.filterContext=m):o.q?n.state.searchKeyword=o.q:n.state.searchKeyword=o.query,n.handleViewItemClick=n.handleViewItemClick.bind(Object(u.a)(n)),n.handleOnPageChanged=n.handleOnPageChanged.bind(Object(u.a)(n)),n.handleOnRecordsPerPageChanged=n.handleOnRecordsPerPageChanged.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0,this.prepareForRender()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"getSnapshotBeforeUpdate",value:function(e){return this.mounted=!1,{prepareForRenderRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){this.mounted=!0,a.prepareForRenderRequired&&this.prepareForRender()}},{key:"prepareForRender",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a,n,r,o,c,d,u,p,m,h,f,b,v,g,y,w,O,E,x,C;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.defination,n=t.service,r=t.query,o=t.view,c=t.showViewOptions,d=t.showAddBtn,u=t.app,a&&n){p={tableview:"Table View",listview:"List View",googlemapview:"Map View",vectormapview:"Vector Map View",calendarview:"Calendar View"},m={},h="tableview",a.views.listing.default in p&&(h=a.views.listing.default);for(f=0,b=Object.entries(p);f<b.length;f++)v=Object(s.a)(b[f],2),g=v[0],y=v[1],g in a.views.listing&&(m[g]=y);w={},O=!1,E="",Object.entries(a.scope.columns).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(w[n]=r)})),JSON.isJSON(r)&&(x=!1,C=Object.keys(w),Object.entries(r).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];!x&&C.includes(a)&&(O=a,E=n,E=String.isString(n)?n:String(n),x=!0)}))),console.log("this.searchkeywordRef","this.searchkeywordRef"),this.mounted?this.setState((function(e){return{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:m,view:o||h,showViewOptions:c,showAddBtn:d,filterableFields:w,searchKeyword:E,filterContext:O}})):this.state=Object(l.a)(Object(l.a)({},this.state),{},{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:m,view:o||h,showViewOptions:c,showAddBtn:d,filterableFields:w,searchKeyword:E,filterContext:O})}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,r=t.auth,i=(t.query,t.defination),o=(t.service,t.cache),c=(t.api,t.showPagination),d=t.showSorter,u=t.cache_data,p=t.onLoadData,m=t.load_data,f=t.onClickEntry,b=(t.sorterFormLayoutType,this.state.view);return O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(v.a,{className:"p-0 m-0"},this.state.showViewOptions&&O.a.createElement(g.a,{sm:12,md:8},Object.entries(this.state.views).map((function(t,a){var n=Object(s.a)(t,2),r=n[0],i=n[1];return O.a.createElement(h.a,{color:"primary",variant:r===b?"contained":"text",onClick:function(t){console.log(r),e.setState({view:r,viewMenuAnchorEl:null})},key:"btn-view-"+r},i)}))),this.state.showAddBtn&&i&&!i.access.actions.create.restricted(r.user)&&O.a.createElement(g.a,{sm:12,md:this.state.showViewOptions?4:12},i.access.actions.create.link.inline.default({className:"float-right"}))),O.a.createElement(v.a,{className:"p-1 m-0"},d&&"googlemapview"!==b&&O.a.createElement(g.a,{xs:12,className:"p-0 m-0 mb-2"},O.a.createElement(v.a,{className:"p-0 m-0"},O.a.createElement(g.a,{xs:12,className:"p-0"},O.a.createElement(k.a,{expanded:this.state.filterAccordionExpanded,className:"p-0",variant:"outlined"},O.a.createElement(D.a,{component:"form",elevation:0,className:a.searchRoot,onSubmit:function(t){t.preventDefault(),e.setState((function(e){return{query:e.filterContext?Object(l.a)(Object(l.a)({},e.query),{},Object(n.a)({},e.filterContext,e.searchKeyword)):Object(l.a)(Object(l.a)({},e.query),{},{q:e.searchKeyword})}})),console.log("Search submit searchKeyword",e.state.searchKeyword)}},!this.state.filterContext&&O.a.createElement(B.a,{className:a.filterIconButton,"aria-label":"Filter",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},O.a.createElement(U.a,null)),this.state.filterContext&&this.state.filterableFields[this.state.filterContext]&&O.a.createElement(h.a,{"aria-label":"Filter",size:"small",color:"secondary",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},Function.isFunction(this.state.filterableFields[this.state.filterContext].label)?this.state.filterContext.humanize():this.state.filterableFields[this.state.filterContext].label),O.a.createElement(N.a,{id:"filter-fields-menu",anchorEl:this.state.filterMenuAnchor,keepMounted:!0,open:Boolean(this.state.filterMenuAnchor),onClose:function(){return e.setState({filterMenuAnchor:null})}},Object.entries(this.state.filterableFields).map((function(t,a){var n=Object(s.a)(t,2),r=n[0],i=n[1];return O.a.createElement(S.a,{onClick:function(){e.setState({filterContext:e.state.filterContext!==r&&r,filterMenuAnchor:null})}},Function.isFunction(i.label)?r.humanize():i.label)}))),O.a.createElement(L.m,{className:a.searchInput,placeholder:"Search...",inputProps:{"aria-label":"Search"},defaultValue:this.state.searchKeyword,onFocus:function(){e.state.filterAccordionExpanded||e.setState({filterAccordionExpanded:!0})},onChange:function(t){e.setState((function(e){var a={searchKeyword:t};if(e.query&&e.query.q){var n=JSON.fromJSON(e.query);delete n.q,a.query=n}return a}))},variant:"base",ref:function(t){return e.searchkeywordRef=t}}),O.a.createElement(B.a,{type:"submit",className:a.searchIconButton,"aria-label":"search"},O.a.createElement(W.a,null))),O.a.createElement(_.a,{className:"p-0"},Object.keys(this.state.filters.values).length>0&&O.a.createElement(v.a,{className:"m-0"},Object.entries(this.state.filters.labels).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];return O.a.createElement(Ae.a,{className:"mx-1 my-1 max-w-xs",color:"secondary",label:(String.isString(i.scope.columns[n].label)?i.scope.columns[n].label+" : ":"")+r,variant:"outlined",style:{maxWidth:180},key:"filter-chip-"+t})})))))))),O.a.createElement(g.a,{xs:12,className:"p-0 m-0"},"tableview"==b&&O.a.createElement(ut,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"googlemapview"===b&&O.a.createElement(Ee.default,{context:i.name,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"calendarview"===b&&O.a.createElement(Oe,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"listview"===b&&O.a.createElement(Re,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}))),c&&"googlemapview"!=b&&O.a.createElement(v.a,{className:"p-0 m-0 mb-4"},O.a.createElement(g.a,{xs:12,className:"p-2 flex items-center justify-center"},O.a.createElement(j.a,{count:i.name in o.res?o.res[i.name].count:1,page:i.name in o.res?o.res[i.name].page-1:this.state.page-1,rowsPerPage:this.state.query.pagination,onChangePage:this.handleOnPageChanged,labelRowsPerPage:"Records per page",rowsPerPageOptions:[5,10,25,50,100,{value:-1,label:"All"}],onChangeRowsPerPage:this.handleOnRecordsPerPageChanged,ActionsComponent:pt,SelectProps:{label:"Records per page",variant:"outlined"},classes:{toolbar:"flex-col-reverse px-2"}}))))}}]),a}(O.a.Component);mt.defaultProps={show_actions:!0,show_links:!0,showViewOptions:!0,showAddBtn:!0,showPagination:!0,showSorter:!0,sorterFormLayoutType:"inline",query:{},load_data:!0,cache_data:!0};t.a=C()(b()((function(e){return{root:{padding:e.spacing(),backgroundColor:e.palette.background.paper},calendar:{borderRight:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important",borderLeft:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important"},activeVieBtn:{background:ae.b.hex.primary,color:ae.b.hex.inverse,border:"1px solid"+ae.b.hex.primary},viewBtnGroup:{position:"absolute !important",right:e.spacing()},searchRoot:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%",margin:0},searchInput:{marginLeft:e.spacing(1),flex:1},searchIconButton:{padding:10},searchDivider:{height:28,margin:4}}})),Object(E.b)((function(e){return{auth:e.auth,cache:e.cache,api:e.api,app:e.app}}),{}),ye.a)(mt)},1390:function(e,t,a){"use strict";var n=a(2),r=a(14),i=a(26),o=a(27),s=a(18),l=a(17),c=a(43),d=a.n(c),u=(a(1357),a(266)),p=a(22),m=a(16),h=a(21),f=a(0),b=a.n(f),v=a(35),g=a(63),y=a.n(g),w=a(11),O=a(50),E=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(e){var i;Object(r.a)(this,a),(i=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},records:[]},i.handleDeleteItemConfirm=function(e){return function(t){var a=i.props,n=a.openDialog,r=a.closeDialog;Object(o.a)(i);n({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return r()}},delete:{text:"Delete",color:"error",onClick:function(t){r(),i.handleDeleteItem(e)}}}})}},i.handleDeleteItem=function(e){return function(e){var t=i.props,a=t.openDialog,n=t.closeDialog;a({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return n()}}}})}};var s=e.defination,l=e.service,c=e.query;return i.state.defination=s,i.state.service=l,i.state.query=c?Object(n.a)(Object(n.a)({},c),{},{p:1}):{p:1},i.handleDeleteItemConfirm=i.handleDeleteItemConfirm.bind(Object(o.a)(i)),i.handleDeleteItem=i.handleDeleteItem.bind(Object(o.a)(i)),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var r=this.props.query;this.setState({query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,r=e.query;e.cache;t&&this.setState({defination:t,service:a,query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n)if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(o)&&o(t),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.googlemapview.resolveData)&&r.views.listing.googlemapview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.googleMapProps,n=e.api,r=e.defination;return b.a.createElement(p.a,{className:t.root},b.a.createElement(m.a,{className:"p-0 m-0",xs:12},b.a.createElement(p.a,{className:"p-0 m-0"},b.a.createElement(p.a,{className:"p-0 m-0"},b.a.createElement(m.a,{className:"p-0 m-0",xs:12},b.a.createElement(p.a,{className:"p-0 m-0"},b.a.createElement(m.a,{xs:12,className:"p-0 m-0"},b.a.createElement(u.a,Object.assign({defaultZoom:12,zoom:12},a,{polylines:r&&"polyline"===r.views.listing.googlemapview.type?this.state.records:[],markers:"marker"===r.views.listing.googlemapview.type?this.state.records:[],circles:"circle"===r.views.listing.googlemapview.type?this.state.records:[],showCurrentPosition:!0})))))),!!n&&(n.complete&&n.error)&&b.a.createElement(p.a,null,b.a.createElement(m.a,{xs:12},b.a.createElement(h.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg))))))}}]),a}(b.a.Component);E.defaultProps={googleMapProps:{mapHeight:900,showClientsPositions:!0,showCurrentPosition:!0},query:{},load_data:!0,cache_data:!0};y()(d()((function(e){return{root:{padding:"0"}}})),Object(v.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:w.gb,openDialog:w.sb,closeDialog:w.pb}),O.a)(E)},1406:function(e,t,a){"use strict";var n=a(2),r=a(6),i=a(12),o=a(14),s=a(26),l=a(27),c=a(18),d=a(17),u=a(24),p=a(255),m=a(461),h=a(1248),f=a(43),b=a.n(f),v=a(4),g=a(1277),y=a(94),w=a(257),O=a.n(w),E=a(21),x=a(1384),C=a(1340),j=a(1346),k=a(1311),_=a(1245),D=a(22),N=a(16),S=a(0),R=a.n(S),A=a(35),q=a(63),P=a.n(q),M=a(50),F=a(431),I=a(691),V=a(432),T=a(433),L=a(77),B=a(33);var J=Object(A.b)((function(e){return{auth:e.auth}}),{})(Object(M.a)((function(e){var t=Object.assign({},e),a=R.a.useState(!0),n=Object(i.a)(a,2),r=(n[0],n[1],t.record),o=t.defination,s=t.auth,l={};function c(e){return o.scope.columns[e].reference&&l[e]?Array.isArray(l[e])?R.a.createElement(R.a.Fragment,null,l[e].map((function(t,a){return R.a.createElement(E.a,{color:"default",paragraph:!0,key:e+"-"+a},t.resolve)}))):R.a.createElement(E.a,{color:"default",paragraph:!0},l[e].resolve):Array.isArray(l[e])?R.a.createElement(R.a.Fragment,null,l[e].map((function(t,a){return R.a.createElement(E.a,{color:"default",paragraph:!0,key:e+"-"+a},t)}))):JSON.isJSON(l[e])?R.a.createElement(E.a,{color:"default",paragraph:!0},JSON.stringify(l[e])):"date"===o.scope.columns[e].input.type||"datetime"===o.scope.columns[e].input.type?"date"===o.scope.columns[e].input.type?R.a.createElement(E.a,{color:"default",paragraph:!0},l[e]?new Date(l[e]).format(L.b.dateformats.date):""):R.a.createElement(E.a,{color:"default",paragraph:!0},l[e]?new Date(l[e]).format(L.b.dateformats.datetime):""):"boolean"===o.scope.columns[e].type?R.a.createElement(E.a,{color:"default",paragraph:!0},l[e]?"Yes":"No"):R.a.createElement(E.a,{color:"default",paragraph:!0},l[e]?l[e]:"")}return"function"===typeof o.views.single.cardview.resolveData?(l=o.views.single.cardview.resolveData(r,s.user,!0),JSON.isJSON(l)||(l={}),l.resolver="defination"):(l=B.d.resolveReferenceColumnsDisplays([r],o.scope.columns,s.user)[0],JSON.isJSON(l)||(l={}),l.resolver="helper"),o&&r?R.a.createElement(F.a,{elevation:0,outlineColor:"#CCCCCC"},R.a.createElement(T.a,{avatar:function(){var e=null;return"defination"===l.resolver&&(e=l.avatar),e}(),title:function(){var e="";if("defination"===l.resolver)e=l.title;else if("helper"===l.resolver)for(var t=o.scope.identity.primary,a=0;a<t.length;a++)e+=o.scope.columns[t[a]].reference&&l[t[a]]?l[t[a]].resolve:l[t[a]];return e}(),subheader:function(){var e="";if("defination"===l.resolver)e=l.subtitle;else if("helper"===l.resolver)for(var t=o.scope.identity.secondary,a=0;a<t.length;a++)e+=o.scope.columns[t[a]].reference&&l[t[a]]?l[t[a]].resolve:l[t[a]];return e}()}),R.a.createElement(V.a,{className:"p-0 m-0"},function(){var e="";return"defination"===l.resolver?e=l.body:"helper"===l.resolver&&(e=R.a.createElement(D.a,{className:"p-0 m-0"},Object.entries(o.scope.columns).map((function(e,t){var a=Object(i.a)(e,2),n=a[0],o=a[1];return o.restricted&&Function.isFunction()?!o.restricted.display(r,s.user)&&R.a.createElement(D.a,{className:"p-0 m-0",key:t},R.a.createElement(N.a,{xs:5},R.a.createElement(E.a,{color:"grey",paragraph:!0},o.label)),R.a.createElement(N.a,{xs:7},c(n))):R.a.createElement(D.a,{className:"p-0 m-0",key:t},R.a.createElement(N.a,{xs:5},R.a.createElement(E.a,{color:"grey",paragraph:!0},o.label)),R.a.createElement(N.a,{xs:7},c(n)))})))),e}()),R.a.createElement(I.a,null)):R.a.createElement(D.a,null)}))),U=a(28),z=a(41);function W(e){var t=e.children,a=e.value,n=e.index,r=Object(u.a)(e,["children","value","index"]);return R.a.createElement(E.a,Object.assign({component:"div",role:"tabpanel",hidden:a!==n,id:"scrollable-force-tabpanel-".concat(n),"aria-labelledby":"scrollable-force-tab-".concat(n)},r),R.a.createElement(_.a,{className:"p-0"},t))}var K=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={view:"cardview",views:{},viewMenuAnchorEl:null,expanded:!0},n.handleViewMenuItemClick=function(e){return function(t){n.setState({view:e,viewMenuAnchorEl:null})}},n.handleShowViewsMenu=function(e){n.setState({viewMenuAnchorEl:e.currentTarget})},n.handleCloseViewsMenu=function(){n.setState({viewMenuAnchorEl:null})},n.prepareForView(),n.handleExpandClick=n.handleExpandClick.bind(Object(l.a)(n)),n.handleViewMenuItemClick=n.handleViewMenuItemClick.bind(Object(l.a)(n)),n.handleRelatedTabValueChange=n.handleRelatedTabValueChange.bind(Object(l.a)(n)),n.handleCloseViewsMenu=n.handleCloseViewsMenu.bind(Object(l.a)(n)),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){}},{key:"handleRelatedTabValueChange",value:function(e,t){this.setState({relatedTab:t})}},{key:"handleExpandClick",value:function(){this.setState((function(e){return{expanded:!e.expanded}}))}},{key:"prepareForView",value:function(){var e=this.props,t=e.defination,a=e.auth,n={cardview:"Card View",googlemapview:"Google Map View",vectormapview:"Vector Map View",calendarview:"Calendar View"},r={},o="cardview";t.views.single.default in n&&(o=t.views.single.default);for(var s=0,l=Object.entries(n);s<l.length;s++){var c=Object(i.a)(l[s],2),d=c[0],u=c[1];d in t.views.single&&(r[d]=u)}var p=null;if(JSON.isJSON(t.scope.dependants))for(var m=0,h=Object.entries(t.scope.dependants);m<h.length;m++){var f=Object(i.a)(h[m],2),b=f[0];f[1];if(U[b].name!==t.name){if(String.isString(p))break;U[b].access.restricted(a.user)||(p=U[b].name)}}this.state.views=r,this.state.view=o,this.state.relatedTab=p}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.auth,s=t.defination,l=t.record,c=t.service;return R.a.createElement(D.a,{className:a.root},R.a.createElement(D.a,null,R.a.createElement(N.a,{xs:12},R.a.createElement(p.a,{className:a.viewSelectBtn,onClick:this.handleShowViewsMenu,"aria-label":"view-select"},this.state.views[this.state.view]),R.a.createElement(m.a,{id:"lock-menu",anchorEl:this.state.viewMenuAnchorEl,keepMounted:!0,open:Boolean(this.state.viewMenuAnchorEl),onClose:this.handleCloseViewsMenu},Object.entries(this.state.views).map((function(t,a){var n=Object(i.a)(t,2),r=n[0],o=n[1];return R.a.createElement(h.a,{key:r,selected:r===e.state.view,onClick:e.handleViewMenuItemClick(r)},o)}))))),R.a.createElement(D.a,null,"cardview"===this.state.view&&R.a.createElement(J,{defination:s,service:c,record:l})),R.a.createElement(D.a,{className:"p-0"},R.a.createElement(N.a,{xs:12},R.a.createElement(D.a,null,R.a.createElement(N.a,{xs:2,md:1},R.a.createElement(y.a,{className:Object(v.a)(a.expand,Object(r.a)({},a.expandOpen,this.state.expanded)),onClick:this.handleExpandClick,"aria-expanded":this.state.expanded,"aria-label":"show more"},R.a.createElement(O.a,null))),R.a.createElement(N.a,{xs:10,md:11},R.a.createElement(E.a,{className:a.relationsSectionTitle,color:this.state.expanded?"default":"grey",variant:"body2"}," ","Related to this"," ",s.label.singularize()," ")))),R.a.createElement(N.a,{xs:12},R.a.createElement(g.a,{in:this.state.expanded,timeout:"auto"},JSON.isJSON(s.scope.dependants)?R.a.createElement(C.a,{position:"static",color:"default",elevation:0},R.a.createElement(j.a,{value:this.state.relatedTab,onChange:this.handleRelatedTabValueChange,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"related data tabs"},Object.entries(s.scope.dependants).map((function(e,t){var a,n=Object(i.a)(e,2),r=n[0];n[1];return!U[r].access.restricted(o.user)&&R.a.createElement(k.a,Object.assign({value:r,label:U[r].label,icon:U[r].icon,key:t+"_tab"},{id:"scrollable-force-tab-".concat(a=r),"aria-controls":"scrollable-force-tabpanel-".concat(a)}))})))):R.a.createElement(E.a,{color:"grey",paragraph:!0}," ","No Related data"," "),JSON.isJSON(s.scope.dependants)&&Object.entries(s.scope.dependants).map((function(t,a){var s=Object(i.a)(t,2),c=s[0],d=s[1];return!U[c].access.restricted(o.user)&&R.a.createElement(W,{className:"p-0",value:e.state.relatedTab,index:c,key:"tab-"+a},R.a.createElement(x.a,{defination:U[c],service:z[c],query:Object(n.a)(Object(n.a)({},d.query),{},Object(r.a)({},d.column,l._id)),show_actions:!1,showAddBtn:!1}))}))))))}}]),a}(R.a.Component);K.defaultProps={};t.a=P()(b()((function(e){return{root:{padding:e.spacing()},viewSelectBtn:{position:"absolute !important",right:e.spacing(),bottom:e.spacing()},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"},relationsSectionTitle:{height:"100%",lineHeight:"48px",verticalAlign:"middle"}}})),Object(A.b)((function(e){return{auth:e.auth}}),{}),M.a)(K)},1407:function(e,t,a){"use strict";a.r(t);var n=a(24),r=a(12),i=a(9),o=a.n(i),s=a(6),l=a(2),c=a(20),d=a(14),u=a(26),p=a(27),m=a(18),h=a(17),f=a(94),b=a(29),v=a.n(b),g=a(43),y=a.n(g),w=a(1352),O=a(1204),E=a(1207),x=a(1250),C=a(1280),j=a(260),k=a.n(j),_=a(220),D=(a(3),a(42)),N=a(431),S=a(691),R=a(432),A=a(433),q=a(22),P=a(16),M=a(21),F=a(2033),I=a(2034),V=a(605),T=a(1457),L=a.n(T),B=a(0),J=a.n(B),U=a(35),z=a(11),W=a(74),K=a(63),Y=a.n(K),Z=a(266),H=(a(1390),a(1384)),X=a(59),G=a(50),$=a(450),Q=a.n($),ee=a(451),te=a.n(ee),ae=!1,ne=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(d.a)(this,a),(n=t.call(this,e)).state={definations:{},services:{},defination:null,service:null,drawerOpen:!0,show_client_positions:!0,clients_positions:{},context:"commissions",context_entry:null,defaultZoom:10,multicontexts:!0,rendered_contexts:[],contexts_props:{},zoom:15,query:{},records:[],markers:[],circles:[],polylines:[]},n.toggleDrawer=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&e!==n.state.drawerOpen&&n.setState((function(t){return{drawerOpen:e}}))}},n.handleOnDrawerNavigationValueChange=function(e,t){var a=n.props,r=a.definations,i=a.services,o=a.cache;n.setState((function(e){return{context:t,context_entry:null,context_entries:["commissions","tracks"].includes(t)&&Array.isArray(o.data[t])?o.data[t]:[],defination:["commissions","tracks"].includes(t)?r[t]:e.defination,service:["commissions","tracks"].includes(t)?i[t]:e.service}}))},n.handleClientListItemClick=function(e,t){return function(e){console.log("handleClientListItemClick client",t,"googleMap",ae),ae&&(ae.panTo({lat:t.position.latitude,lng:t.position.longitude}),ae.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.setZoom(15))}},n.handleToggleContextRender=function(e,t){var a=n.props,r=a.definations,i=(a.cache,a.apiCallRequest),d=a.app;n.setState((function(t){var a=t.rendered_contexts.indexOf(e);return{rendered_contexts:t.rendered_contexts.includes(e)?t.rendered_contexts.removeAtIndex(a):t.rendered_contexts.concat([e])}}),Object(c.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r[e]&&t?i(r[e].name,{uri:r[e].endpoint,type:"records",params:JSON.isJSON(n.state.contexts_props[e])?n.state.contexts_props[e].query:{page:1,pagination:d.preferences.data.pagination,populate:1},data:{},cache:!0}).then((function(t){r[e]&&Function.isFunction(r[e].views.listing.googlemapview.resolveData)&&Array.isArray(t)&&r[e].views.listing.googlemapview.resolveData(t,!0).then((function(a){n.isMounted()?n.setState((function(n){return{context_entry_type:r[e].views.listing.googlemapview.type,context_entry:t.length>0?0:void 0,contexts_props:Object(l.a)(Object(l.a)({},n.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0})))}})):(n.state.context_entry_type=r[e].views.listing.googlemapview.type,n.state.context_entry=t.length>0?0:void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0}))))}))})).catch((function(e){})):r[e]&&(n.isMounted()?n.setState((function(t){return{context_entry_type:void 0,context_entry:void 0,contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},t.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))}})):(n.state.context_entry_type=void 0,n.state.context_entry=void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))));case 1:case"end":return a.stop()}}),a)}))))},n.handleContextEntryClick=function(e,t){n.setState({context_entry:t})};var r=n.props,i=(r.device,r.cache),u=r.context,m=r.contexts,h=(r.definations,r.app);return n.elementRef=J.a.createRef(),n.prepareForView(),n.toggleDrawer=n.toggleDrawer.bind(Object(p.a)(n)),n.handleOnLoadMap=n.handleOnLoadMap.bind(Object(p.a)(n)),n.handleClientListItemClick=n.handleClientListItemClick.bind(Object(p.a)(n)),n.handleOnToggleShowClients=n.handleOnToggleShowClients.bind(Object(p.a)(n)),n.handleOnClientsPositionsLoaded=n.handleOnClientsPositionsLoaded.bind(Object(p.a)(n)),n.handleOnClientPositionAvailable=n.handleOnClientPositionAvailable.bind(Object(p.a)(n)),n.handleOnClientPositionUnavailable=n.handleOnClientPositionUnavailable.bind(Object(p.a)(n)),n.handleOnClientPositionChanged=n.handleOnClientPositionChanged.bind(Object(p.a)(n)),n.handleOnDrawerNavigationValueChange=n.handleOnDrawerNavigationValueChange.bind(Object(p.a)(n)),n.handleContextEntryClick=n.handleContextEntryClick.bind(Object(p.a)(n)),n.handleToggleContextRender=n.handleToggleContextRender.bind(Object(p.a)(n)),n.state=Object(l.a)(Object(l.a)({},n.state),{},{context:u||n.state.context,defaultZoom:h.preferences.data.defaultMapZoom,multicontexts:!!Array.isArray(m)&&m.length>1,rendered_contexts:u?[u]:[],contexts_props:u?Object(s.a)({},u,{query:{page:1,pagination:h.preferences.data.pagination,populate:1},element:"marker",records:[]}):{},context_entries:Array.isArray(i.data[n.state.defination.name])?i.data[n.state.defination.name]:[],drawerOpen:!1}),n}return Object(u.a)(a,[{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"componentDidMount",value:function(){}},{key:"prepareForView",value:function(){for(var e=this.props,t=e.auth,a=e.definations,n=e.services,i=e.app,o=null,s=null,l={},c={},d=this.state.contexts_props,u=0,p=Object.entries(a);u<p.length;u++){var m=Object(r.a)(p[u],2),h=m[0],f=m[1];f.access.restricted(t.user)||f.views.listing.googlemapview&&Function.isFunction(f.views.listing.googlemapview.resolveData)&&(l[h]=f,c[h]=n[h],d[h]={query:{page:1,pagination:i.preferences.data.pagination,populate:1},element:f.views.listing.googlemapview.type,elements:[],loaded:!1},null===o&&(o=f,s=n[h]))}this.state.contexts_props=d,this.state.definations=l,this.state.services=c,this.state.defination=o,this.state.service=s}},{key:"handleOnToggleShowClients",value:function(e){this.setState((function(e){return{show_client_positions:!e.show_client_positions}}))}},{key:"handleOnLoadMap",value:function(e,t){ae=e}},{key:"handleOnClientsPositionsLoaded",value:function(e){this.setState((function(t){return{clients_positions:e}}))}},{key:"handleOnClientPositionAvailable",value:function(e,t){this.setState((function(a){return{clients_positions:Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(s.a)({},e,t))}}))}},{key:"handleOnClientPositionUnavailable",value:function(e,t){this.setState((function(t){var a=t.clients_positions;return delete a[e],{clients_positions:a}}))}},{key:"handleOnClientPositionChanged",value:function(e,t){this.setState((function(a){return{clients_positions:a.drawerOpen?Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(s.a)({},e,t)):a.clients_positions}}))}},{key:"render",value:function(){var e,t=this,a=this.props,i=a.theme,o=a.classes,c=(a.showAll,a.device),d=(a.sockets,a.definations),u=a.services,p=a.contexts,m=a.actions,h=this.state,b=h.context,g=h.clients_positions,y=(h.show_client_positions,h.rendered_contexts),j=h.contexts_props,V=[],T=[],B=[];return y.map((function(e){d[e]&&e in j&&("marker"===j[e].element&&Array.isArray(j[e].elements)?T=T.concat(j[e].elements):"circle"===j[e].element&&Array.isArray(j[e].elements)?V=V.concat(j[e].elements):"polyline"===j[e].element&&Array.isArray(j[e].elements)&&(B=B.concat(j[e].elements)))})),J.a.createElement(N.a,{elevation:0,outlineColor:i.palette.text.primary,style:{backgroundColor:i.palette.background.paper},ref:this.elementRef},J.a.createElement(A.a,{avatar:J.a.createElement(D.a,{style:{backgroundColor:"rgba(0,0,0,0.05)",color:i.palette.text.primary}},J.a.createElement(L.a,null)),title:this.props.context?d[this.props.context]?d[this.props.context].label+" Map":"Map":"Map Overview",subheader:"Click on any context marker, route or polyline in the map for more infomation on the context ",action:J.a.createElement("div",null,Array.isArray(m)&&m.map((function(e,t){var a=e.onClick,r=e.icon,i=Object(n.a)(e,["onClick","icon"]);return J.a.createElement(f.a,Object.assign({"aria-label":"Action",className:"mx-1 inverse-text translucent ",onClick:a,style:{backgroundColor:"rgba(0,0,0,0.05)"},key:"action-button-"+t},i),r)})),J.a.createElement(f.a,{"aria-label":"menu",color:"inherit",className:"mx-1 inverse-text ",onClick:this.toggleDrawer(!this.state.drawerOpen),style:{backgroundColor:"rgba(0,0,0,0.05)"}},J.a.createElement(k.a,{path:_.f,title:"Map Overview Drawer Menu",rotate:this.state.drawerOpen?0:180,size:.8,color:i.palette.text.primary})))}),J.a.createElement(R.a,{className:"p-0 m-0 overflow-x-hidden"},J.a.createElement(q.a,{className:"p-0 m-0"},J.a.createElement(P.a,{xs:12,className:o.wrapper},J.a.createElement("div",{className:v()(o.content,(e={},Object(s.a)(e,o.contentDrawerMargin,c.window_size.width>=1280),Object(s.a)(e,o.contentShift,this.state.drawerOpen&&c.window_size.width>=1280),e)),style:{minHeight:c.window_size.height,backgroundColor:i.palette.background.paper}},J.a.createElement(Z.a,{mapHeight:c.window_size.height,showClientsPositions:y.includes("clients_positions"),showCurrentPosition:!0,onLoadClientsPositions:this.handleOnClientsPositionsLoaded,onClientPositionAvailable:this.handleOnClientPositionAvailable,onClientPositionUnavailable:this.handleOnClientPositionUnavailable,onClientPositionChanged:this.handleOnClientPositionChanged,selectedEntry:this.state.context_entry,selectedEntryType:this.state.context_entry_type?this.state.context_entry_type:"clients_position",defaultZoom:this.state.defaultZoom,zoom:this.state.zoom,onMapLoad:this.handleOnLoadMap,polylines:B,markers:T,circles:V})),J.a.createElement(w.a,{className:o.drawer,variant:c.window_size.width>=1280?"persistent":"temporary",anchor:"right",open:this.state.drawerOpen,onClose:this.toggleDrawer(!1),onOpen:this.toggleDrawer(!0),classes:{paper:c.window_size.width>=1280?o.drawerPaper:o.temporaryDrawerPaper}},this.state.multicontexts&&J.a.createElement(F.a,{value:b,onChange:this.handleOnDrawerNavigationValueChange,showLabels:!0,className:"w-full"},J.a.createElement(I.a,{value:"clients_positions",label:"Users",icon:J.a.createElement(k.a,{path:_.a,title:"Clients Postions Users",size:1})}),Object.entries(this.state.definations).map((function(e,t){var a=Object(r.a)(e,2),n=a[0],i=a[1];return J.a.createElement(I.a,{value:n,label:i.label,icon:i.icon,key:"googlemapview-btn-"+n+"-option"})}))),"clients_positions"===b&&0===Object.size(g)&&J.a.createElement(q.a,null,J.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},J.a.createElement(k.a,{path:_.d,title:"No Records available yet.",color:"#CCCCCC",size:5})),J.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},J.a.createElement(M.a,null,"No Records available yet."))),"clients_positions"===b&&J.a.createElement(O.a,{className:o.root},Object.entries(g).map((function(e,a){var n=Object(r.a)(e,2),i=n[0],o=n[1],s=!0;if(a>0&&o.user._id===g[Object.keys(g)[a-1]].user._id&&(s=!1),o.user&&s)return J.a.createElement(E.a,{className:"cursor-pointer hover:bg-gray-400",onClick:t.handleClientListItemClick(i,o),key:"client-"+i},J.a.createElement(C.a,null,J.a.createElement(D.a,{src:String.isString(o.user.gender)&&"female"===o.user.gender.trim().toLowerCase()?Q.a:te.a})),J.a.createElement(x.a,{primary:o.user.first_name+" "+o.user.last_name,secondary:String.isString(o.user.role)?o.user.role.humanize():""}))}))),"commissions"===b&&J.a.createElement(H.a,{defination:d.commissions,service:u.commissions,query:{},showViewOptions:!1,showAddBtn:!1,showSorter:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[b]&&Function.isFunction(d[b].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[b].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},b,Object(l.a)(Object(l.a)({},t.contexts_props[b]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(a){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},b,Object(l.a)(Object(l.a)({},t.contexts_props[b]),{},{elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}),"tracks"===b&&J.a.createElement(H.a,{defination:d.tracks,service:u.tracks,showViewOptions:!1,showAddBtn:!1,showSorter:!0,showPagination:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[b]&&Function.isFunction(d[b].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[b].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},b,Object(l.a)(Object(l.a)({},t.contexts_props[b]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},b,Object(l.a)(Object(l.a)({},t.contexts_props[b]),{},{query:a,elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}))))),J.a.createElement(S.a,null,J.a.createElement(q.a,{className:"p-0 m-0"},Array.isArray(p)&&p.map((function(e,a){return J.a.createElement(P.a,{xs:12,md:Math.round(12/p.length),className:"flex items-center justify-center",key:"context_entry_switch-"+a},J.a.createElement(X.l,{label:"clients_positions"===e?"Users":d[e]?d[e].label:e,value:t.state.rendered_contexts.includes(e),onChange:function(a){t.handleToggleContextRender(e,a)}}))})),J.a.createElement(P.a,{xs:12},J.a.createElement(M.a,{variant:"body2"},this.props.context&&d[this.props.context]?d[this.props.context].label+" Map from a glance":"Map from a glance")))))}}]),a}(J.a.Component);ne.defaultProps={contexts:["clients_positions","commissions","tracks"],context:"clients_positions",actions:[]};t.default=Object(W.c)(Y()(y()((function(e){return{root:{padding:"0"},wrapper:{display:"flex",margin:0,padding:0},drawer:{width:e.appDrawer.width,flexShrink:0},drawerPaper:{width:e.appDrawer.width,position:"absolute",zIndex:e.zIndex.appBar/2,backgroundColor:e.palette.background.paper},temporaryDrawerPaper:{width:e.appDrawer.width,background:e.palette.background.default},content:{flexGrow:1,padding:0,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentDrawerMargin:{marginRight:-e.appDrawer.width},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}})),Object(U.b)((function(e){return{app:e.app,auth:e.auth,cache:e.cache,device:e.device}}),{apiCallRequest:z.gb,closeDialog:z.pb,openDialog:z.sb}),V.a,G.a)(ne))}}]);
//# sourceMappingURL=21.07b35ff2.chunk.js.map