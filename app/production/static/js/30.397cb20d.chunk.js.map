{"version":3,"sources":["views/widgets/Charts/AggregatesBarChart/index.jsx","views/widgets/Charts/AggregatesBarChart/styles.jsx"],"names":["defaults","global","legend","display","AggregatesBarChart","props","state","loading","load_error","aggregate","aggregates","chart_data","labels","datasets","data","aggregateMenuEl","aggregatables","colors","handleShowAggregateMenu","event","currentTarget","setState","handleAggregateMenuItemClick","column","loadAggregates","g","bind","handleCloseAggregateMenu","this","prepareForData","prepareChartData","prevProps","Object","areEqual","defination","api","Array","isArray","cache","equals","dynamic","monochrome","color","service","onResolveAggregates","entries","scope","columns","properties","possibilities","push","name","label","length","no_of_colors","monochrome_colors","UtilitiesHelper","monochromeColorScheme","rotation_colors","rotationColorScheme","auth","onLoadAggregates","user","error","chart_data_labels","chart_data_data","onload_callback_data","i","_id","count","backgroundColor","query_data","apiCallRequest","new_aggregate","group","uri","endpoint","type","params","classes","className","showTitle","showMenu","GridContainer","GridItem","xs","Typography","variant","fullWidth","center","Button","aria-controls","aria-haspopup","onClick","size","aria-label","simple","Menu","id","anchorEl","keepMounted","open","Boolean","onClose","map","aggregatable","index","MenuItem","key","options","maintainAspectRatio","scales","yAxes","ticks","beginAtZero","justify","alignItems","alt","emptyImage","src","EmptyStateImage","emptyText","complete","msg","React","Component","defaultProps","hex","accent","compose","withStyles","theme","root","padding","data_actions_wrapper","whiteSpace","valueChip","margin","spacing","maxWidth","width","marginTop","connect","ownProps","withErrorHandler"],"mappings":"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","file":"static/js/30.397cb20d.chunk.js","sourcesContent":["/** @format */\r\n\r\nimport { Menu, MenuItem } from \"@material-ui/core\";\r\n//\r\nimport withStyles from \"@material-ui/core/styles/withStyles\";\r\nimport { MoreVert as AggregateMenuIcon } from \"@material-ui/icons\";\r\nimport EmptyStateImage from \"assets/img/empty-state-table.svg\";\r\nimport { colors } from \"assets/jss/app-theme\";\r\nimport Button from \"components/Button\";\r\nimport GridContainer from \"components/Grid/GridContainer\";\r\nimport GridItem from \"components/Grid/GridItem\";\r\nimport Typography from \"components/Typography\";\r\nimport PropTypes from \"prop-types\";\r\nimport React from \"react\";\r\nimport { defaults, Bar } from \"react-chartjs-2\";\r\nimport { connect } from \"react-redux\";\r\nimport compose from \"recompose/compose\";\r\nimport { apiCallRequest } from \"state/actions\";\r\nimport { withErrorHandler } from \"hoc/ErrorHandler\";\r\n//\r\nimport { UtilitiesHelper } from \"hoc/Helpers\";\r\nimport styles from \"./styles\";\r\n\r\n//\r\ndefaults.global.legend.display = false;\r\n\r\nclass AggregatesBarChart extends React.Component {\r\n\tstate = {\r\n\t\tloading: true,\r\n\t\tload_error: false,\r\n\t\taggregate: \"status\",\r\n\t\taggregates: [],\r\n\t\tchart_data: {\r\n\t\t\tlabels: [],\r\n\t\t\tdatasets: [\r\n\t\t\t\t{\r\n\t\t\t\t\tdata: [],\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t},\r\n\t\taggregateMenuEl: null,\r\n\t};\r\n\taggregatables = [];\r\n\tcolors = [];\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.handleShowAggregateMenu = this.handleShowAggregateMenu.bind(this);\r\n\t\tthis.handleCloseAggregateMenu = this.handleCloseAggregateMenu.bind(\r\n\t\t\tthis\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.prepareForData();\r\n\t\tthis.loadAggregates();\r\n\t\tthis.prepareChartData();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (!Object.areEqual(this.props.defination, prevProps.defination)) {\r\n\t\t\tthis.prepareForData();\r\n\t\t\tthis.loadAggregates();\r\n\t\t} else if (!Object.areEqual(prevProps.api, this.props.api)) {\r\n\t\t\tthis.prepareChartData();\r\n\t\t} else if (Array.isArray(this.props.cache)) {\r\n\t\t\tif (!this.props.cache.equals(prevProps.cache)) {\r\n\t\t\t\tthis.prepareChartData();\r\n\t\t\t}\r\n\t\t} else if (Array.isArray(prevProps.cache)) {\r\n\t\t\tif (!prevProps.cache.equals(this.props.cache)) {\r\n\t\t\t\tthis.prepareChartData();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprepareForData() {\r\n\t\tlet {\r\n\t\t\tdynamic,\r\n\t\t\tmonochrome,\r\n\t\t\tcolor,\r\n\t\t\tcolors,\r\n\t\t\tdefination,\r\n\t\t\tservice,\r\n\t\t\taggregate,\r\n\t\t\tonResolveAggregates,\r\n\t\t} = this.props;\r\n\r\n\t\tif (dynamic) {\r\n\t\t\tthis.aggregatables = [];\r\n\t\t\tfor (let [column, properties] of Object.entries(\r\n\t\t\t\tdefination.scope.columns\r\n\t\t\t)) {\r\n\t\t\t\tif (properties.possibilities) {\r\n\t\t\t\t\tthis.aggregatables.push({\r\n\t\t\t\t\t\tname: column,\r\n\t\t\t\t\t\tlabel: properties.label,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!aggregate && this.aggregatables.length > 0) {\r\n\t\t\taggregate = this.aggregatables[0].name;\r\n\t\t\tif (onResolveAggregates) {\r\n\t\t\t\tonResolveAggregates(defination.name, this.aggregatables);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dynamic) {\r\n\t\t\tthis.state.aggregate = aggregate;\r\n\r\n\t\t\t//generate color scheme if monochromatic\r\n\t\t\tif (monochrome) {\r\n\t\t\t\tlet no_of_colors =\r\n\t\t\t\t\tthis.aggregatables.length > 0\r\n\t\t\t\t\t\t? this.aggregatables.length\r\n\t\t\t\t\t\t: 1;\r\n\t\t\t\tlet monochrome_colors = UtilitiesHelper.monochromeColorScheme(\r\n\t\t\t\t\tcolor,\r\n\t\t\t\t\tno_of_colors\r\n\t\t\t\t);\r\n\t\t\t\tthis.colors = monochrome_colors;\r\n\t\t\t} else if (colors) {\r\n\t\t\t\tthis.colors = colors;\r\n\t\t\t} else {\r\n\t\t\t\tlet no_of_colors =\r\n\t\t\t\t\tthis.aggregatables.length > 0\r\n\t\t\t\t\t\t? this.aggregatables.length\r\n\t\t\t\t\t\t: 1;\r\n\t\t\t\tlet rotation_colors = UtilitiesHelper.rotationColorScheme(\r\n\t\t\t\t\tcolor,\r\n\t\t\t\t\tno_of_colors\r\n\t\t\t\t);\r\n\t\t\t\tthis.colors = rotation_colors;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprepareChartData() {\r\n\t\tconst {\r\n\t\t\tmonochrome,\r\n\t\t\tcolor,\r\n\t\t\tcolors,\r\n\t\t\taggregate,\r\n\t\t\tdefination,\r\n\t\t\tservice,\r\n\t\t\tauth,\r\n\t\t\tonLoadAggregates,\r\n\t\t\tcache,\r\n\t\t\tapi,\r\n\t\t} = this.props;\r\n\t\tif (Array.isArray(cache)) {\r\n\t\t\tlet possibilities = defination.scope.columns[this.state.aggregate]\r\n\t\t\t\t? defination.scope.columns[this.state.aggregate].possibilities\r\n\t\t\t\t: {};\r\n\t\t\tif (typeof possibilities === \"function\") {\r\n\t\t\t\tpossibilities = possibilities(false, auth.user);\r\n\t\t\t}\r\n\t\t\t//generate color scheme if monochromatic\r\n\t\t\tif (monochrome) {\r\n\t\t\t\tlet no_of_colors = cache.length > 0 ? cache.length : 1;\r\n\t\t\t\tlet monochrome_colors = UtilitiesHelper.monochromeColorScheme(\r\n\t\t\t\t\tapi.loading || api.error ? \"#595959\" : color,\r\n\t\t\t\t\tno_of_colors\r\n\t\t\t\t);\r\n\t\t\t\tthis.colors = monochrome_colors;\r\n\t\t\t} else if (colors) {\r\n\t\t\t\tthis.colors =\r\n\t\t\t\t\tapi.loading || api.error\r\n\t\t\t\t\t\t? UtilitiesHelper.monochromeColorScheme(\"#595959\")\r\n\t\t\t\t\t\t: colors;\r\n\t\t\t} else {\r\n\t\t\t\tlet no_of_colors = cache.length > 0 ? cache.length : 1;\r\n\t\t\t\tlet rotation_colors = UtilitiesHelper.rotationColorScheme(\r\n\t\t\t\t\tapi.loading || api.error ? \"#595959\" : color,\r\n\t\t\t\t\tno_of_colors\r\n\t\t\t\t);\r\n\t\t\t\tthis.colors = rotation_colors;\r\n\t\t\t}\r\n\r\n\t\t\tlet chart_data_labels = [];\r\n\t\t\tlet chart_data_data = [];\r\n\t\t\tlet onload_callback_data = [];\r\n\r\n\t\t\tif (typeof possibilities === \"object\") {\r\n\t\t\t\tfor (var i = 0; i < cache.length; i++) {\r\n\t\t\t\t\tif (cache[i]._id in possibilities) {\r\n\t\t\t\t\t\tchart_data_labels.push(possibilities[cache[i]._id]);\r\n\t\t\t\t\t\tchart_data_data.push(cache[i].count);\r\n\t\t\t\t\t\tif (onLoadAggregates) {\r\n\t\t\t\t\t\t\tonload_callback_data.push({\r\n\t\t\t\t\t\t\t\tname: cache[i]._id,\r\n\t\t\t\t\t\t\t\tlabel: possibilities[cache[i]._id],\r\n\t\t\t\t\t\t\t\tcount: cache[i].count,\r\n\t\t\t\t\t\t\t\tcolor: this.colors[i],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet chart_data = {\r\n\t\t\t\tlabels: chart_data_labels,\r\n\t\t\t\tdatasets: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: chart_data_data,\r\n\t\t\t\t\t\tbackgroundColor: this.colors,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t};\r\n\r\n\t\t\tthis.setState(state => ({\r\n\t\t\t\taggregates: cache,\r\n\t\t\t\tchart_data: chart_data,\r\n\t\t\t\tloading: false,\r\n\t\t\t}));\r\n\t\t\tif (onLoadAggregates) {\r\n\t\t\t\tonLoadAggregates(onload_callback_data);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet chart_data_labels = [];\r\n\t\t\tlet chart_data_data = [];\r\n\t\t\tlet onload_callback_data = [];\r\n\r\n\t\t\tlet chart_data = {\r\n\t\t\t\tlabels: chart_data_labels,\r\n\t\t\t\tdatasets: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: chart_data_data,\r\n\t\t\t\t\t\tbackgroundColor: this.colors,\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t};\r\n\r\n\t\t\tthis.setState(state => ({\r\n\t\t\t\taggregates: cache,\r\n\t\t\t\tchart_data: chart_data,\r\n\t\t\t\tloading: false,\r\n\t\t\t}));\r\n\t\t\tif (onLoadAggregates) {\r\n\t\t\t\tonLoadAggregates(onload_callback_data);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tloadAggregates(query_data) {\r\n\t\tconst { apiCallRequest, defination } = this.props;\r\n\r\n\t\tif (!query_data) {\r\n\t\t\tquery_data = { g: this.state.aggregate };\r\n\t\t}\r\n\r\n\t\tlet new_aggregate =\r\n\t\t\t\"g\" in query_data\r\n\t\t\t\t? query_data.g\r\n\t\t\t\t: \"group\" in query_data\r\n\t\t\t\t? query_data.group\r\n\t\t\t\t: false;\r\n\t\tthis.setState(state => ({ aggregate: new_aggregate }));\r\n\r\n\t\tif (defination) {\r\n\t\t\tapiCallRequest(\r\n\t\t\t\tdefination.name + \"_aggregates\",\r\n\t\t\t\t{\r\n\t\t\t\t\turi: defination.endpoint,\r\n\t\t\t\t\ttype: \"aggregates\",\r\n\t\t\t\t\tparams: query_data,\r\n\t\t\t\t\tdata: {},\r\n\t\t\t\t\tcache: true,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\thandleShowAggregateMenu = event => {\r\n\t\tlet aggregateMenuEl = event.currentTarget;\r\n\t\tthis.setState({ aggregateMenuEl: aggregateMenuEl });\r\n\t};\r\n\r\n\thandleCloseAggregateMenu() {\r\n\t\tthis.setState({ aggregateMenuEl: null });\r\n\t}\r\n\r\n\thandleAggregateMenuItemClick = column => event => {\r\n\t\t//this.handleCloseAggregateMenu();\r\n\t\tthis.setState({ aggregateMenuEl: null });\r\n\t\tthis.loadAggregates({ g: column });\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tclasses,\r\n\t\t\tclassName,\r\n\t\t\taggregate,\r\n\t\t\tdynamic,\r\n\t\t\tdefination,\r\n\t\t\tservice,\r\n\t\t\tshowTitle,\r\n\t\t\tshowMenu,\r\n\t\t\tapi,\r\n\t\t\tcache,\r\n\t\t} = this.props;\r\n\t\treturn (\r\n\t\t\t<GridContainer className={className + \" p-0 m-0\"}>\r\n\t\t\t\t<GridItem xs={12} className=\"p-0 m-0\">\r\n\t\t\t\t\t<GridContainer className=\"p-0 m-0\">\r\n\t\t\t\t\t\t<GridContainer className=\"p-0 m-0\">\r\n\t\t\t\t\t\t\t{(showMenu || showTitle) && (\r\n\t\t\t\t\t\t\t\t<GridItem xs={12}>\r\n\t\t\t\t\t\t\t\t\t<GridContainer>\r\n\t\t\t\t\t\t\t\t\t\t{showTitle && !showMenu && (\r\n\t\t\t\t\t\t\t\t\t\t\t<GridItem xs={12}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"body1\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfullWidth\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcenter\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{defination.scope.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? defination.scope\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  ].label\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Unknown\"}{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tAggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t\t\t\t\t</GridItem>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t\t{dynamic && showMenu && (\r\n\t\t\t\t\t\t\t\t\t\t\t<GridItem\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"p-0 m-0\"\r\n\t\t\t\t\t\t\t\t\t\t\t\txs={12}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-controls=\"aggregate-menu\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-haspopup=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.handleShowAggregateMenu\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"float-right\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Aggregate Menu\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsimple\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{defination.scope.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? defination.scope\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  ].label\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Unknown\"}{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tAggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<AggregateMenuIcon />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Menu\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"surveys-aggregate-menu\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tanchorEl={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.aggregateMenuEl\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkeepMounted\r\n\t\t\t\t\t\t\t\t\t\t\t\t\topen={Boolean(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.aggregateMenuEl\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.handleCloseAggregateMenu\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{this.aggregatables.map(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taggregatable,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tindex\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<MenuItem\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.handleAggregateMenuItemClick(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taggregatable.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"aggregate_\" +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taggregatable.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{aggregatable.label +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\" Aggregate\"}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</MenuItem>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Menu>\r\n\t\t\t\t\t\t\t\t\t\t\t</GridItem>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</GridContainer>\r\n\t\t\t\t\t\t\t\t</GridItem>\r\n\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t<GridItem className=\"p-0 m-0\" xs={12}>\r\n\t\t\t\t\t\t\t\t{Array.isArray(this.state.chart_data.labels) &&\r\n\t\t\t\t\t\t\t\tthis.state.chart_data.labels.length > 0 ? (\r\n\t\t\t\t\t\t\t\t\t<Bar \r\n\t\t\t\t\t\t\t\t\t\tdata={this.state.chart_data} \r\n\t\t\t\t\t\t\t\t\t\toptions={{\r\n\t\t\t\t\t\t\t\t\t\t\tmaintainAspectRatio: false,\r\n\t\t\t\t\t\t\t\t\t\t\tscales: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tyAxes: [{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tticks: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbeginAtZero: true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<GridContainer\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"p-0 m-0\"\r\n\t\t\t\t\t\t\t\t\t\tjustify=\"center\"\r\n\t\t\t\t\t\t\t\t\t\talignItems=\"center\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\talt=\"Empty Aggregates\"\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={classes.emptyImage}\r\n\t\t\t\t\t\t\t\t\t\t\tsrc={EmptyStateImage}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={classes.emptyText}\r\n\t\t\t\t\t\t\t\t\t\t\tcolor=\"grey\"\r\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"body2\"\r\n\t\t\t\t\t\t\t\t\t\t\tcenter\r\n\t\t\t\t\t\t\t\t\t\t\tfullWidth\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\tNo{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t{defination.scope.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.state.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t\t\t\t? defination.scope.columns[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.state.aggregate\r\n\t\t\t\t\t\t\t\t\t\t\t\t  ].label\r\n\t\t\t\t\t\t\t\t\t\t\t\t: \"\"}{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\tAggregates\r\n\t\t\t\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t\t\t</GridContainer>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</GridItem>\r\n\t\t\t\t\t\t</GridContainer>\r\n\r\n\t\t\t\t\t\t{api.complete && api.error && (\r\n\t\t\t\t\t\t\t<GridContainer>\r\n\t\t\t\t\t\t\t\t<GridItem xs={12}>\r\n\t\t\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\t\t\tcolor=\"error\"\r\n\t\t\t\t\t\t\t\t\t\tvariant=\"body2\"\r\n\t\t\t\t\t\t\t\t\t\tcenter\r\n\t\t\t\t\t\t\t\t\t\tfullWidth\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{\"An error occured. \\n \" +\r\n\t\t\t\t\t\t\t\t\t\t\tapi.error.msg}\r\n\t\t\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t\t</GridItem>\r\n\t\t\t\t\t\t\t</GridContainer>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</GridContainer>\r\n\t\t\t\t</GridItem>\r\n\t\t\t</GridContainer>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nAggregatesBarChart.propTypes = {\r\n\tclassName: PropTypes.string,\r\n\tclasses: PropTypes.object.isRequired,\r\n\tdynamic: PropTypes.bool,\r\n\tshowTitle: PropTypes.bool,\r\n\tshowMenu: PropTypes.bool,\r\n\tmonochrome: PropTypes.bool,\r\n\tcolor: PropTypes.string,\r\n\tcolors: PropTypes.array,\r\n\tdefination: PropTypes.object.isRequired,\r\n\tservice: PropTypes.any.isRequired,\r\n\taggregate: PropTypes.string,\r\n\tonResolveAggregates: PropTypes.func,\r\n\tonLoadAggregates: PropTypes.func,\r\n};\r\n\r\nAggregatesBarChart.defaultProps = {\r\n\t//colors: [colors.hex.accent, colors.hex.primary, colors.hex.secondary, colors.hex.primarydark, colors.hex.default],\r\n\tcolor: colors.hex.accent,\r\n\tmonochrome: true,\r\n};\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n\tconst { defination } = ownProps;\r\n\treturn {\r\n\t\tauth: state.auth,\r\n\t\tcache: defination\r\n\t\t\t? state.cache.data[defination.name + \"_aggregates\"]\r\n\t\t\t: null,\r\n\t\tapi: defination\r\n\t\t\t? state.api[defination.name]\r\n\t\t\t\t? state.api[defination.name]\r\n\t\t\t\t: {}\r\n\t\t\t: {},\r\n\t};\r\n};\r\n\r\nexport default compose(\r\n\twithStyles(styles),\r\n\tconnect(mapStateToProps, { apiCallRequest }),\r\n\twithErrorHandler\r\n)(AggregatesBarChart);\r\n","/** @format */\r\n\r\nexport default theme => ({\r\n\troot: {\r\n\t\tpadding: \"0\",\r\n\t},\r\n\tdata_actions_wrapper: {\r\n\t\tdisplay: \"inline-block\",\r\n\t\twhiteSpace: \"nowrap\",\r\n\t\t\"& > *\": {\r\n\t\t\tdisplay: \"inline-block\",\r\n\t\t\twhiteSpace: \"nowrap\",\r\n\t\t},\r\n\t},\r\n\tvalueChip: {\r\n\t\tmargin: theme.spacing(0.5),\r\n\t},\r\n\temptyImage: {\r\n\t\tmaxWidth: 100,\r\n\t\twidth: \"70%\",\r\n\t\tmargin: theme.spacing(2),\r\n\t},\r\n\temptyText: {\r\n\t\tmarginTop: theme.spacing(3),\r\n\t},\r\n});\r\n"],"sourceRoot":""}