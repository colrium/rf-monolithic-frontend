(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[9,20],{1347:function(e,t,a){e.exports=a.p+"static/media/empty-state-table.cdb06dd9.svg"},1366:function(e,t,a){"use strict";var n=a(2),r=a(14),i=a(26),s=a(27),o=a(18),l=a(17),c=a(43),d=a.n(c),u=(a(1347),a(263)),m=a(22),p=a(16),f=a(21),h=a(0),g=a.n(h),v=a(35),y=a(63),b=a.n(y),x=a(11),w=a(50),E=function(e){Object(o.a)(a,e);var t=Object(l.a)(a);function a(e){var i;Object(r.a)(this,a),(i=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},records:[]},i.handleDeleteItemConfirm=function(e){return function(t){var a=i.props,n=a.openDialog,r=a.closeDialog;Object(s.a)(i);n({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return r()}},delete:{text:"Delete",color:"error",onClick:function(t){r(),i.handleDeleteItem(e)}}}})}},i.handleDeleteItem=function(e){return function(e){var t=i.props,a=t.openDialog,n=t.closeDialog;a({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return n()}}}})}};var o=e.defination,l=e.service,c=e.query;return i.state.defination=o,i.state.service=l,i.state.query=c?Object(n.a)(Object(n.a)({},c),{},{p:1}):{p:1},i.handleDeleteItemConfirm=i.handleDeleteItemConfirm.bind(Object(s.a)(i)),i.handleDeleteItem=i.handleDeleteItem.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var r=this.props.query;this.setState({query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,r=e.query;e.cache;t&&this.setState({defination:t,service:a,query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,s=t.onLoadData,o=t.load_data;if(n)if(o)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(s)&&s(t),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(s)&&s(l),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.googlemapview.resolveData)&&r.views.listing.googlemapview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.googleMapProps,n=e.api,r=e.defination;return g.a.createElement(m.a,{className:t.root},g.a.createElement(p.a,{className:"p-0 m-0",xs:12},g.a.createElement(m.a,{className:"p-0 m-0"},g.a.createElement(m.a,{className:"p-0 m-0"},g.a.createElement(p.a,{className:"p-0 m-0",xs:12},g.a.createElement(m.a,{className:"p-0 m-0"},g.a.createElement(p.a,{xs:12,className:"p-0 m-0"},g.a.createElement(u.a,Object.assign({defaultZoom:12,zoom:12},a,{polylines:r&&"polyline"===r.views.listing.googlemapview.type?this.state.records:[],markers:"marker"===r.views.listing.googlemapview.type?this.state.records:[],circles:"circle"===r.views.listing.googlemapview.type?this.state.records:[],showCurrentPosition:!0})))))),!!n&&(n.complete&&n.error)&&g.a.createElement(m.a,null,g.a.createElement(p.a,{xs:12},g.a.createElement(f.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg))))))}}]),a}(g.a.Component);E.defaultProps={googleMapProps:{mapHeight:900,showClientsPositions:!0,showCurrentPosition:!0},query:{},load_data:!0,cache_data:!0};b()(d()((function(e){return{root:{padding:"0"}}})),Object(v.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:x.gb,openDialog:x.sb,closeDialog:x.pb}),w.a)(E)},1370:function(e,t,a){"use strict";var n=a(6),r=a(9),i=a.n(r),s=a(20),o=a(12),l=a(2),c=a(14),d=a(26),u=a(27),m=a(18),p=a(17),f=a(254),h=a(43),g=a.n(h),v=a(22),y=a(16),b=a(21),x=a(0),w=a.n(x),E=a(35),O=a(63),_=a.n(O),N=a(1574),C=a(1474),k=a(1475),j=a(212),S=a(632),D=a(1240),A=a(1442),R=a.n(A),q=a(1395),P=a.n(q),M=a(1386),J=a.n(M),F=a(1441),I=a.n(F),L=a(56),z=a(59),V=a(109),B=a(261),T=a.n(B),U=a(264),W=a.n(U),H=a(430),Y=a(1347),X=a.n(Y),K=a(1301),Z=a(1337),G=a(1628),$=a(1925),Q=a(1307),ee=a(1425),te=a.n(ee),ae=a(3),ne=a(41),re=a(433),ie=a(687),se=a(434),oe=a(435),le=a(92),ce=a(76),de=a(34),ue=a(45),me=a(437),pe=g()({indicator:{backgroundColor:ae.b.hex.accent}})(Z.a),fe=g()((function(e){return{root:{textTransform:"none",minWidth:50,fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(),"&:hover":{color:ae.b.hex.default,opacity:1},"&$selected":{color:ae.b.hex.accent,fontWeight:e.typography.fontWeightMedium},"&:focus":{color:ae.b.hex.accent}},selected:{}}}))((function(e){return w.a.createElement(K.a,e)})),he=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=w.a.createRef(),n.state={view:"month",view_title:(new Date).format(ce.b.dateformats.month),calendars:[],tasks:[],schedules:[]},n.handleChangeCalendarView=function(e,t){if(n.calendarRef.current){var a=n.calendarRef.current.getInstance().getDate().toDate();n.setState((function(e){return{view:t,view_title:"day"===t?a.format(ce.b.dateformats.date):"week"===t?a.format(ce.b.dateformats.week):a.format(ce.b.dateformats.month)}}))}else n.setState((function(e){return{view:t}}))},n.handleClickPrevButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.prev();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleClickNextButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.next();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleOnEditEntryClick=function(e){n.calendarRef.current},n.handleOnDeleteEntryClick=function(e){n.calendarRef.current};var r=e.theme,i=e.view,s=e.calendars,o=e.tasks,d=e.schedules,m=e.show_actions,p=e.icon,f=e.title,h=e.subtitle,g=e.icon_color,v=e.title_color,y=e.subtitle_color,b=e.calendarProps;return n.state=Object(l.a)(Object(l.a)({},n.state),{},{theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:s,tasks:o,schedules:d,show_actions:m,icon:p,title:f,subtitle:h,icon_color:g,title_color:v,subtitle_color:y,calendarProps:b}),n.handleChangeCalendarView=n.handleChangeCalendarView.bind(Object(u.a)(n)),n.handleClickPrevButton=n.handleClickPrevButton.bind(Object(u.a)(n)),n.handleClickNextButton=n.handleClickNextButton.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.initCalendarEvents()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{refreshRequired:!Object.areEqual(e,this.props)}}},{key:"componentDidUpdate",value:function(e,t,a){var n=this.props,r=n.theme,i=n.view,s=n.calendars,o=n.tasks,l=n.schedules,c=n.show_actions,d=n.icon,u=n.title,m=n.subtitle,p=n.icon_color,f=n.title_color,h=n.subtitle_color,g=n.calendarProps;a.refreshRequired&&this.setState({theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:s,tasks:o,schedules:l,show_actions:c,icon:d,title:u,subtitle:m,icon_color:p,title_color:f,subtitle_color:h,calendarProps:g},this.initCalendarEvents)}},{key:"initCalendarEvents",value:function(){var e=this.props,t=e.onSelect,a=e.onClickEntry,n=e.onClickEdit,r=e.onClickDelete,i=this.calendarRef.current.getInstance();i&&i.on({clickSchedule:function(e){de.e.isOfType(a,"function")&&a(e.schedule)},beforeCreateSchedule:function(e){de.e.isOfType(t,"function")&&t(e)},beforeUpdateSchedule:function(e){de.e.isOfType(n,"function")&&n(e)},beforeDeleteSchedule:function(e){de.e.isOfType(r,"function")&&r(e)}})}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.height,n=e.defaultView,r=e.disableDblClick,i=e.disableClick,s=e.isReadOnly,o=e.useDetailPopup,c=e.useCreationPopup,d=e.scheduleView,u=e.taskView,m=this.state,p=m.theme,f=m.view,h=m.view_title,g=m.calendars,x=m.tasks,E=m.schedules,O=(m.show_actions,m.icon),_=m.title,N=m.subtitle,C=m.icon_color,k=(m.title_color,m.subtitle_color,m.calendarProps),j=Object(l.a)({height:a+"px",defaultView:n,disableDblClick:r,disableClick:i,isReadOnly:s,useDetailPopup:o,useCreationPopup:c,scheduleView:d,taskView:u},k);return w.a.createElement(re.a,{elevation:0,outlineColor:"#cfd8dc"},w.a.createElement(oe.a,{avatar:w.a.createElement(ne.a,{"aria-label":_,style:{background:C}},O),title:_,subheader:N}),w.a.createElement(se.a,{className:"p-0 m-0"},w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{sm:6,md:4},w.a.createElement(pe,{value:f,onChange:this.handleChangeCalendarView,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"view change tabs"},w.a.createElement(fe,{value:"month",label:"Month"}),w.a.createElement(fe,{value:"week",label:"Week"}),w.a.createElement(fe,{value:"day",label:"Day"}))),w.a.createElement(y.a,{sm:6,md:4},w.a.createElement(b.a,{variant:"h3",center:!0}," ",h," ")),w.a.createElement(y.a,{sm:12,md:4},w.a.createElement("div",{className:"float-right"},w.a.createElement(V.a,{onClick:this.handleClickPrevButton},w.a.createElement(G.a,null)),w.a.createElement(V.a,{onClick:this.handleClickNextButton},w.a.createElement($.a,null))))),w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{xs:12},w.a.createElement(te.a,Object.assign({theme:p,view:f,className:t.calendar,calendars:g,tasks:x,schedules:E,ref:this.calendarRef},j)))))),w.a.createElement(ie.a,null,w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{variant:"subtitle2",display:"block",color:"default",gutterBottom:!0}," ","Calendar index"," ")),w.a.createElement(y.a,{xs:12},g.map((function(e,t){return w.a.createElement(le.a,{color:e.bgColor?e.bgColor:ae.b.hex.secondary,text:e.name,key:"calendar-"+t})}))))))}}]),a}(w.a.Component);he.defaultProps={calendars:[],tasks:[],schedules:[],view:"month",theme:{"common.border":"1px solid rgba("+ae.b.rgb.grey+", 0.5)","common.backgroundColor":"#fcfcfc","common.holiday.color":ae.b.hex.grey,"common.saturday.color":ae.b.hex.grey,"common.dayname.color":ae.b.hex.default,"common.today.color":ae.b.hex.primary,"week.currentTime.color":ae.b.hex.primarydark},show_actions:!0,icon:w.a.createElement(Q.a,null),title:"My",subtitle:"Calendar",icon_color:ae.b.hex.primary,title_color:ae.b.hex.primary,subtitle_color:ae.b.hex.grey,calendarProps:{},height:900,defaultView:"month",disableDblClick:!0,disableClick:!1,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!0};var ge=Object(ue.a)(g()(me.a)(he)),ve=a(168),ye=a(11),be=a(50),xe=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=w.a.createRef(),n.state={loading:!0,load_error:!1,records:[]},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;r({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{}}),n.state.service.delete(e).then((function(e){i(),n.loadData()})).catch((function(e){console.log("CalendarView delete error",e),i()}))}};var r=e.defination,i=e.service,s=e.query;e.app;return n.state.defination=r,n.state.service=i,n.state.query=s?Object(l.a)(Object(l.a)({},s),{},{p:1}):{p:1},n.handleEditItem=n.handleEditItem.bind(Object(u.a)(n)),n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.loadContext()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination)&&!Object.areEqual(e.service,this.props.service),dataReloadRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&this.loadContext(),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"componentWillUnmount",value:function(){var e=this.props;e.openDialog;(0,e.closeDialog)()}},{key:"handleEditItem",value:function(e){var t=this.props.auth;this.state.defination.access.actions.update.restricted(t.user)||(window.location.href="/"+this.state.defination.access.actions.update.uri(e.schedule.id))}},{key:"handleDeleteItemConfirm",value:function(e){var t=this.props,a=t.openDialog,n=t.closeDialog;a({title:"Confirm Delete",body:"Are you sure you want delete "+e.schedule.title+"? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return n()}},delete:{text:"Delete",color:"error",onClick:this.handleDeleteItem(e.schedule.id)}}})}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.auth;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},calendars:[{id:t.name,name:t.label,bgColor:t.color,borderColor:t.color}],records:[],loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,s=t.onLoadData,o=t.load_data;if(n)if(o)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){console.log("calendar data",t),Function.isFunction(s)&&s(t,e.state.query),e.prepareData(t)})).catch((function(t){console.log("calendar error",t),e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(s)&&s(l,this.state.query),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.calendarview.resolveData)&&r.views.listing.calendarview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props.classes;return w.a.createElement(v.a,{className:e.root},this.state.defination&&w.a.createElement(y.a,{className:"p-0 m-0",xs:12},this.state.loading?w.a.createElement(v.a,{className:e.full_height,justify:"center",alignItems:"center"},w.a.createElement(y.a,{xs:1},w.a.createElement(ve.a,{size:24,thickness:4,className:e.progress,color:"secondary",disableShrink:!0}))):w.a.createElement(v.a,{className:"p-0 m-0"},this.state.load_error?w.a.createElement(v.a,null,w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},w.a.createElement(H.a,{fontSize:"large"},"error"))),w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{color:"error",variant:"body1",center:!0,fullWidth:!0},"An error occured.",w.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,w.a.createElement("br",null),this.state.load_error.msg))):w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{xs:12},w.a.createElement(ge,{icon:this.state.defination.icon,title:this.state.defination.label,title_color:this.state.defination.color,icon_color:this.state.defination.color,subtitle:"",calendars:this.state.calendars,view:"month",schedules:this.state.records,className:e.calendar,onClickEdit:this.handleEditItem,onClickDelete:this.handleDeleteItemConfirm}))):w.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},w.a.createElement("img",{alt:"Empty list",className:e.emptyImage,src:X.a}),w.a.createElement(b.a,{className:e.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",this.state.defination.label?this.state.defination.label:"Records"," ","found")))))))}}]),a}(w.a.Component);xe.defaultProps={calendarProps:{height:"900px",defaultView:"month",disableDblClick:!0,disableClick:!0,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!1},query:{p:1},cache_data:!0,load_data:!0};var we=Object(be.a)(_()(g()((function(e){return{root:{padding:"0"}}})),Object(E.b)((function(e){return{auth:e.auth,app:e.app}}),{apiCallRequest:ye.gb,openDialog:ye.sb,closeDialog:ye.pb}))(xe)),Ee=(a(1366),a(1380)),Oe=a(1329),_e=a(1198),Ne=a(1202),Ce=a(1270),ke=a(1274),je=a(1242),Se=a(1303),De=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,raw_records:[],records:[]},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props.dispatch;Object(u.a)(n);a(ye.sb({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return a(ye.pb())}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}}))}},n.handleDeleteItem=function(e){return function(e){var t=n.props.dispatch;t(ye.sb({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return t(ye.pb())}}}}))}};e.defination;return n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.cache;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,s=t.onLoadData,o=t.load_data;if(n){if(o)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(s)&&s(t,e.state.query),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else if(i){var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(s)&&s(l,this.state.query),this.prepareData(l)}}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=a.auth,r=a.cache,i=a.defination,s=a.entryItemProps,o=Array.isArray(t)?t:Array.isArray(r.data[i.name])?r.data[i.name]:[];i&&i.scope.columns;Function.isFunction(i.views.listing.listview.resolveData)&&i.views.listing.listview.resolveData(o,n.user,s).then((function(a){e.setState((function(e){return{raw_records:t,records:a,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],raw_records:[],loading:!1}}))}))}},{key:"prepareForData",value:function(){var e=this.props,t=(e.classes,e.defination);e.auth,e.dispatch,t.scope.columns;this.state.records=[],this.state.loading=!1}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=(t.service,t.onClickEntry);return w.a.createElement(v.a,{className:a.root},w.a.createElement(y.a,{className:"p-0 m-0",xs:12},this.state.loading?w.a.createElement(v.a,null,w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-3/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-8/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-4/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-3/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-5/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-9/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-4/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-3/12"}))),w.a.createElement(y.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},w.a.createElement(Se.a,{variant:"circle",width:40,height:40}),w.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},w.a.createElement(Se.a,{variant:"text",className:"w-4/12"})))):w.a.createElement(v.a,{className:"p-0 m-0"},this.state.load_error?w.a.createElement(v.a,null,w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},w.a.createElement(H.a,{fontSize:"large"},"error"))),w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{color:"error",variant:"body1",className:"w-full text-center",center:!0,fullWidth:!0},"An error occured.",w.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,w.a.createElement("br",null),this.state.load_error.msg))):w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{xs:12},w.a.createElement(_e.a,{className:"p-0 transparent-bg"},this.state.records.map((function(t,i){return w.a.createElement("div",{key:n.name+"-"+i},w.a.createElement(Ne.a,{button:!0,alignItems:"flex-start",onClick:function(){Function.isFunction(r)&&r(e.state.raw_records[i],i)},className:a.listItem},t.avatar&&w.a.createElement(Ce.a,null," ",t.avatar," "),t.icon&&w.a.createElement(ke.a,null," ",t.icon," "),w.a.createElement(je.a,{primary:t.title,secondary:t.body})),w.a.createElement(Oe.a,{component:"li"}))}))))):w.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},w.a.createElement("img",{alt:"Empty list",className:a.emptyImage,src:X.a}),w.a.createElement(b.a,{className:a.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",n.label?n.label:"Records"," ","found")))))))}}]),a}(w.a.Component);De.defaultProps={show_actions:!0,show_links:!0,query:{p:1},load_data:!0,cache_data:!0};var Ae=_()(g()((function(e){return{root:{padding:"0"},listItem:{background:"transparent",transition:e.transitions.create("background",{easing:e.transitions.easing.sharp,duration:50}),"&:hover":{background:e.palette.action.hover}}}})),Object(E.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:ye.gb,openDialog:ye.sb,closeDialog:ye.pb}),be.a)(De),Re=a(1250),qe=(a(1371),a(1204)),Pe=a(1427),Me=a.n(Pe),Je=a(42),Fe=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},dt_columns:[],records:[],raw_data:[],mouseX:null,mouseY:null,actionsView:"contextMenu",context:null},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;Object(u.a)(n);r({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return i()}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}})}},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog;(0,a.closeDialog)(),e._id&&(e=e._id),n.state.service.delete(e).then((function(t){n.setState((function(t){var a=t.records;return Array.isArray(a)&&(a=a.filter((function(t){if(t.entry){if(t.entry._id===e)return!1}else if(t._id===e)return!1;return!0}))),Array.isArray(a)||(a=[]),{records:a}}))})).catch((function(e){r({title:"Delete failed",body:e.msg,actions:{}})}))}},n.handleOnRowContextMenu=function(e){return function(t){t.preventDefault();var a=t.clientX-2,r=t.clientY-4;console.log("this.state.raw_data[index]",n.state.raw_data[e]),n.setState((function(t){return{mouseX:a,mouseY:r,context:t.raw_data[e]}}))}},n.handleOnRowContextMenuClose=function(e){e.preventDefault(),n.setState({mouseX:null,mouseY:null})};var r=e.defination,i=e.service,s=e.query,o=e.cache.data;return n.state.defination=r,n.state.service=i,n.state.query=s?Object(l.a)(Object(l.a)({},s),{},{p:1}):{p:1},n.state.records=Array.isArray(o[r.name])?o[r.name]:[],n.mounted=!1,n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n.handleOnRowContextMenu=n.handleOnRowContextMenu.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(this.mounted=!0,a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=t.service,i=t.query,s=t.auth,c=t.actionsType;if(n){var d=n.scope.columns,u=[];if(!n.access.restricted(s.user)){u.push({name:"entry",label:String.isString(n.label)?n.label.singularize():"Action",options:{filter:!1,sort:!1,customBodyRender:function(t,r,i){if("inline"===c)return w.a.createElement(v.a,{spacing:2,className:a.data_actions_wrapper},Object.keys(n.access.actions).map((function(a,r){return!n.access.actions[a].restricted(s.user)&&w.a.createElement("div",{key:t+"_"+a+"_action"},"delete"===a?n.access.actions[a].link.inline.listing(t,"error_text",e.handleDeleteItemConfirm(t)):n.access.actions[a].link.inline.listing(t))})))}}});for(var m=0,p=Object.entries(d);m<p.length;m++){var f=Object(o.a)(p[m],2),h=f[0],g=f[1],y=!0;g.restricted&&"display"in g.restricted&&"function"===typeof g.restricted.display&&(y=!g.restricted.display(!1,s.user)),y&&(de.e.isOfType(this.state.defination.views.listing.tableview.resolveData,"function")?g.reference||g.possibilities?u.push({name:h,label:g.label,options:{filter:!!g.possibilities,sort:!0,customBodyRender:function(e,t,a){return Array.isArray(e)?w.a.createElement(v.a,{spacing:2},e.map((function(e,t){return w.a.createElement("div",{key:t}," ",e," ")}))):null!==e&&void 0!==e?e:""}}}):u.push({name:h,label:g.label,options:{filter:!!g.possibilities,sort:!0}}):g.reference&&"file"!==g.input.type?u.push({name:h,label:g.label,options:{filter:!!g.possibilities,sort:!0,customBodyRender:function(e,t,n){return Array.isArray(e)?w.a.createElement(v.a,{spacing:2},e.map((function(e,t){return w.a.createElement(Re.a,{className:a.valueChip,key:e.value,label:e.resolve})}))):null!==e&&void 0!==e?w.a.createElement(Re.a,{label:e.resolve}):""}}}):g.reference&&"file"===g.input.type?u.push({name:h,label:g.label,options:{filter:!!g.possibilities,sort:!0,customBodyRender:function(e,t,n){return Array.isArray(e)?w.a.createElement(v.a,{spacing:2},e.map((function(e,t){return w.a.createElement(Re.a,{className:a.valueChip,avatar:w.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e.resolve)?Je.attachments.getAttachmentFileUrl(e.value):void 0},de.c.fileIcon(e.resolve)),label:e.resolve,onClick:function(t){t.preventDefault(),window.open(Je.attachments.getAttachmentFileUrl(e.value),"_blank").focus()},key:"file-"+e.value})}))):null!==e&&void 0!==e?w.a.createElement(Re.a,{avatar:w.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e.resolve)?Je.attachments.getAttachmentFileUrl(e.value):void 0},de.c.fileIcon(e.resolve)),onClick:function(t){t.preventDefault(),window.open(Je.attachments.getAttachmentFileUrl(e.value),"_blank").focus()},label:e.resolve}):""}}}):u.push({name:h,label:g.label,options:{filter:!!g.possibilities,sort:!0}}))}}this.setState({defination:n,service:r,query:i?Object(l.a)(Object(l.a)({},i),{},{p:1}):{p:1},dt_columns:u,records:[],loading:!1},this.loadData)}}},{key:"parseData",value:function(e){var t=this.props,a=t.defination,n=t.auth,r=e,i=a.scope.columns;r.entry=e;for(var s=0,l=Object.entries(i);s<l.length;s++){var c=Object(o.a)(l[s],2),d=c[0],u=c[1];if("date"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.date):r[d]=""),"datetime"===u.input.type&&e[d]&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.datetime):r[d]=""),"time"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.time):r[d]=""),"boolean"===u.type&&(e[d]?r[d]="Yes":r[d]="No"),JSON.isJSON(r[d])&&!u.reference&&(r[d]=JSON.stringify(r[d])),u.possibilities)if(JSON.isJSON(u.possibilities))e[d]in u.possibilities&&(r[d]=u.possibilities[e[d]]);else if(Function.isFunction(u.possibilities)){var m=u.possibilities(e,n.user);JSON.isJSON(m)&&e[d]in m&&(r[d]=m[e[d]])}}return r}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,s=t.onLoadData,o=t.load_data;if(n)if(o)this.setState({loading:!0,load_error:!1}),r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(s)&&s(t,e.state.query),e.setState({loading:!1}),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(s)&&s(l,this.state.query),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=a.auth,r=a.cache,i=a.defination,s=Array.isArray(t)?t:Array.isArray(r.data[i.name])?r.data[i.name]:[],o=i?i.scope.columns:{},l=[];if(Function.isFunction(i.views.listing.tableview.resolveData))i.views.listing.tableview.resolveData(s,!0).then((function(t){e.mounted?e.setState((function(e){return{raw_data:s,records:t,loading:!1}})):(e.state.records=t,e.state.loading=!1)})).catch((function(t){e.mounted?e.setState((function(e){return{raw_data:[],records:[],loading:!1}})):(e.state.records=[],e.state.loading=!1)}));else{l=de.d.resolveReferenceColumnsDisplays(s,o,n.user);var c=this,d=l.map((function(e){return c.parseData(e)}));this.setState((function(e){return{records:d}}))}}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.defination,n=e.api,r=(e.cache,e.actionsType),i={filterType:"dropdown",filter:!0,downloadOptions:{filename:(a?a.label:"Records")+" - "+(new Date).format("d M Y H:i:s A")+".csv",separator:","},resizableColumns:!1,selectableRows:"none",responsive:"scroll",pagination:!1,rowHover:!0,customToolbarSelect:function(e,t,a){console.log("customToolbarSelect selectedRows",e),console.log("customToolbarSelect displayData",t)}};return w.a.createElement(v.a,{className:t.root},w.a.createElement(y.a,{className:"p-0 m-0",xs:12},this.state.loading&&w.a.createElement(v.a,{className:t.full_height,justify:"center",alignItems:"center"},w.a.createElement(y.a,{xs:12,className:"flex relative flex-row"},w.a.createElement("div",{className:"flex-grow"},w.a.createElement(Se.a,{variant:"text",width:150})),w.a.createElement("div",{className:"flex"},w.a.createElement(Se.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),w.a.createElement(Se.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),w.a.createElement(Se.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),w.a.createElement(Se.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}))),w.a.createElement(y.a,{xs:12},w.a.createElement(Se.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),w.a.createElement(Se.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),w.a.createElement(Se.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),w.a.createElement(Se.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}))),!this.state.loading&&Array.isArray(this.state.records)&&w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{className:"p-0 m-0",xs:12},"context"===r&&w.a.createElement(qe.a,{onContextMenu:this.handleOnRowContextMenuClose,onClickAway:this.handleOnRowContextMenuClose},w.a.createElement(S.a,{open:null!==this.state.mouseY,onClose:this.handleOnRowContextMenuClose,anchorReference:"anchorPosition",anchorPosition:null!==this.state.mouseY&&null!==this.state.mouseX?{top:this.state.mouseY,left:this.state.mouseX}:void 0},w.a.createElement(D.a,{onClick:this.handleOnRowContextMenuClose},"Copy"),w.a.createElement(D.a,{onClick:this.handleOnRowContextMenuClose},"Print"),w.a.createElement(D.a,{onClick:this.handleOnRowContextMenuClose},"Highlight"),w.a.createElement(D.a,{onClick:this.handleOnRowContextMenuClose},"Email"))),this.state.records.length>0?w.a.createElement(Me.a,{title:(n.loading?"Loading ":"")+a.label+(n.loading?"...":""),data:this.state.records,columns:this.state.dt_columns,options:i}):w.a.createElement(v.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},w.a.createElement("img",{alt:"Empty list",className:t.emptyImage,src:X.a}),w.a.createElement(b.a,{className:t.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",a.label?a.label:"Records"," ","found")))),!!n&&(n.busy&&n.error)&&w.a.createElement(v.a,null,w.a.createElement(y.a,{xs:12},w.a.createElement(b.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg+" \n Displaying cached data."))))))}}]),a}(w.a.Component);Fe.defaultProps={show_actions:!0,show_links:!0,query:{p:1},cache_data:!0,load_data:!0,actionsType:"inline"};var Ie=Object(be.a)(_()(g()((function(e){return{root:{padding:"0"},data_actions_wrapper:{display:"inline-block",whiteSpace:"nowrap","& > *":{display:"inline-block",whiteSpace:"nowrap"}},valueChip:{margin:e.spacing(.5)},emptyImage:{maxWidth:200,width:"100%"},emptyText:{marginTop:e.spacing(3)}}})),Object(E.b)((function(e,t){return{auth:e.auth,cache:e.cache,api:e.api}}),{openDialog:ye.sb,closeDialog:ye.pb,apiCallRequest:ye.gb}))(Fe));function Le(e){var t=Object(L.a)(),a=e.count,n=e.page,r=e.rowsPerPage,i=e.onChangePage;return w.a.createElement("div",{className:"ml-2 flex-shrink-0"},w.a.createElement(V.a,{onClick:function(e){i(e,0)},disabled:0===n,"aria-label":"first page"},"rtl"===t.direction?w.a.createElement(I.a,null):w.a.createElement(R.a,null)),w.a.createElement(V.a,{onClick:function(e){i(e,n-1)},disabled:0===n,"aria-label":"previous page"},"rtl"===t.direction?w.a.createElement(J.a,null):w.a.createElement(P.a,null)),w.a.createElement(V.a,{onClick:function(e){i(e,n+1)},disabled:n>=Math.ceil(a/r)-1,"aria-label":"next page"},"rtl"===t.direction?w.a.createElement(P.a,null):w.a.createElement(J.a,null)),w.a.createElement(V.a,{onClick:function(e){i(e,Math.max(0,Math.ceil(a/r)-1))},disabled:n>=Math.ceil(a/r)-1,"aria-label":"last page"},"rtl"===t.direction?w.a.createElement(R.a,null):w.a.createElement(I.a,null)))}var ze=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={defination:null,service:null,view:"tableview",views:{},showViewOptions:!0,showAddBtn:!0,searchKeyword:"",query:{},pages:10,page:1,viewMenuAnchorEl:null,sortFields:[],filterAccordionExpanded:!1,filterableFields:{},filterContext:!1,filterMenuAnchor:null,filters:{values:{},labels:{}}},n.mounted=!1,n.searchkeywordRef=w.a.createRef(),n.handleViewItemClick=function(e){return function(t){n.mounted?n.setState({view:e,viewMenuAnchorEl:null}):(n.state.view=e,n.state.viewMenuAnchorEl=null)}},n.handleShowViewsMenu=function(e){var t=e.currentTarget;n.mounted?n.setState({viewMenuAnchorEl:t}):n.state.viewMenuAnchorEl=t},n.handleCloseViewsMenu=function(){n.mounted?n.setState({viewMenuAnchorEl:null}):n.state.viewMenuAnchorEl=null},n.handleOnPageChanged=function(e,t){n.setState((function(e){return{page:t+1,query:Object(l.a)(Object(l.a)({},e.query),{},{page:t+1}),viewMenuAnchorEl:null}}))},n.handleOnRecordsPerPageChanged=function(e){var t=Number.parseNumber(e.target.value,n.state.query.pagination);n.setState((function(e){return{page:1,query:Object(l.a)(Object(l.a)({},e.query),{},{pagination:t})}}))};var r=e.defination,i=e.service,s=e.query,d=(e.cache,e.app);n.state.defination=r,n.state.service=i,n.state.query=s?Object(l.a)(Object(l.a)({},s),{},{p:1,pagination:"rpp"in s?s.rpp:"pagination"in s?s.pagination:d.preferences.data.pagination,page:"pg"in s?s.pg:"page"in s?s.page:1}):{p:1,pagination:"rpp"in s?s.rpp:"pagination"in s?s.pagination:d.preferences.data.pagination,page:"pg"in s?s.pg:"page"in s?s.page:1};var m={},p=!1,f="";if(Object.entries(r.scope.columns).map((function(e,t){var a=Object(o.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(m[n]=r)})),JSON.isJSON(s)){var h=!1,g=Object.keys(m);Object.entries(s).map((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];!h&&g.includes(a)&&(p=a,f=n,f=String.isString(n)?n:String(n),h=!0)}))}return p||!s.q&&!s.query?(n.state.searchKeyword=f,n.state.filterContext=p):s.q?n.state.searchKeyword=s.q:n.state.searchKeyword=s.query,n.handleViewItemClick=n.handleViewItemClick.bind(Object(u.a)(n)),n.handleOnPageChanged=n.handleOnPageChanged.bind(Object(u.a)(n)),n.handleOnRecordsPerPageChanged=n.handleOnRecordsPerPageChanged.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0,this.prepareForRender()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"getSnapshotBeforeUpdate",value:function(e){return this.mounted=!1,{prepareForRenderRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){this.mounted=!0,a.prepareForRenderRequired&&this.prepareForRender()}},{key:"prepareForRender",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,a,n,r,s,c,d,u,m,p,f,h,g,v,y,b,x,w,E,O,_;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.defination,n=t.service,r=t.query,s=t.view,c=t.showViewOptions,d=t.showAddBtn,u=t.app,a&&n){m={tableview:"Table View",listview:"List View",googlemapview:"Map View",vectormapview:"Vector Map View",calendarview:"Calendar View"},p={},f="tableview",a.views.listing.default in m&&(f=a.views.listing.default);for(h=0,g=Object.entries(m);h<g.length;h++)v=Object(o.a)(g[h],2),y=v[0],b=v[1],y in a.views.listing&&(p[y]=b);x={},w=!1,E="",Object.entries(a.scope.columns).map((function(e,t){var a=Object(o.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(x[n]=r)})),JSON.isJSON(r)&&(O=!1,_=Object.keys(x),Object.entries(r).map((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];!O&&_.includes(a)&&(w=a,E=n,E=String.isString(n)?n:String(n),O=!0)}))),console.log("this.searchkeywordRef","this.searchkeywordRef"),this.mounted?this.setState((function(e){return{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:p,view:s||f,showViewOptions:c,showAddBtn:d,filterableFields:x,searchKeyword:E,filterContext:w}})):this.state=Object(l.a)(Object(l.a)({},this.state),{},{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:p,view:s||f,showViewOptions:c,showAddBtn:d,filterableFields:x,searchKeyword:E,filterContext:w})}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,r=t.auth,i=(t.query,t.defination),s=(t.service,t.cache),c=(t.api,t.showPagination),d=t.showSorter,u=t.cache_data,m=t.onLoadData,p=t.load_data,h=t.onClickEntry,g=(t.sorterFormLayoutType,this.state.view);return w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(v.a,{className:"p-0 m-0"},this.state.showViewOptions&&w.a.createElement(y.a,{sm:12,md:8},Object.entries(this.state.views).map((function(t,a){var n=Object(o.a)(t,2),r=n[0],i=n[1];return w.a.createElement(f.a,{color:"primary",variant:r===g?"contained":"text",onClick:function(t){console.log(r),e.setState({view:r,viewMenuAnchorEl:null})},key:"btn-view-"+r},i)}))),this.state.showAddBtn&&i&&!i.access.actions.create.restricted(r.user)&&w.a.createElement(y.a,{sm:12,md:this.state.showViewOptions?4:12},i.access.actions.create.link.inline.default({className:"float-right"}))),w.a.createElement(v.a,{className:"p-1 m-0"},d&&"googlemapview"!==g&&w.a.createElement(y.a,{xs:12,className:"p-0 m-0 mb-2"},w.a.createElement(v.a,{className:"p-0 m-0"},w.a.createElement(y.a,{xs:12,className:"p-0"},w.a.createElement(C.a,{expanded:this.state.filterAccordionExpanded,className:"p-0",variant:"outlined"},w.a.createElement(j.a,{component:"form",elevation:0,className:a.searchRoot,onSubmit:function(t){t.preventDefault(),e.setState((function(e){return{query:e.filterContext?Object(l.a)(Object(l.a)({},e.query),{},Object(n.a)({},e.filterContext,e.searchKeyword)):Object(l.a)(Object(l.a)({},e.query),{},{q:e.searchKeyword})}})),console.log("Search submit searchKeyword",e.state.searchKeyword)}},!this.state.filterContext&&w.a.createElement(V.a,{className:a.filterIconButton,"aria-label":"Filter",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},w.a.createElement(T.a,null)),this.state.filterContext&&this.state.filterableFields[this.state.filterContext]&&w.a.createElement(f.a,{"aria-label":"Filter",size:"small",color:"secondary",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},Function.isFunction(this.state.filterableFields[this.state.filterContext].label)?this.state.filterContext.humanize():this.state.filterableFields[this.state.filterContext].label),w.a.createElement(S.a,{id:"filter-fields-menu",anchorEl:this.state.filterMenuAnchor,keepMounted:!0,open:Boolean(this.state.filterMenuAnchor),onClose:function(){return e.setState({filterMenuAnchor:null})}},Object.entries(this.state.filterableFields).map((function(t,a){var n=Object(o.a)(t,2),r=n[0],i=n[1];return w.a.createElement(D.a,{onClick:function(){e.setState({filterContext:e.state.filterContext!==r&&r,filterMenuAnchor:null})}},Function.isFunction(i.label)?r.humanize():i.label)}))),w.a.createElement(z.m,{className:a.searchInput,placeholder:"Search...",inputProps:{"aria-label":"Search"},defaultValue:this.state.searchKeyword,onFocus:function(){e.state.filterAccordionExpanded||e.setState({filterAccordionExpanded:!0})},onChange:function(t){e.setState((function(e){var a={searchKeyword:t};if(e.query&&e.query.q){var n=JSON.fromJSON(e.query);delete n.q,a.query=n}return a}))},variant:"base",ref:function(t){return e.searchkeywordRef=t}}),w.a.createElement(V.a,{type:"submit",className:a.searchIconButton,"aria-label":"search"},w.a.createElement(W.a,null))),w.a.createElement(k.a,{className:"p-0"},Object.keys(this.state.filters.values).length>0&&w.a.createElement(v.a,{className:"m-0"},Object.entries(this.state.filters.labels).map((function(e,t){var a=Object(o.a)(e,2),n=a[0],r=a[1];return w.a.createElement(Re.a,{className:"mx-1 my-1 max-w-xs",color:"secondary",label:(String.isString(i.scope.columns[n].label)?i.scope.columns[n].label+" : ":"")+r,variant:"outlined",style:{maxWidth:180},key:"filter-chip-"+t})})))))))),w.a.createElement(y.a,{xs:12,className:"p-0 m-0"},"tableview"==g&&w.a.createElement(Ie,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:p,onLoadData:m,onClickEntry:h}),"googlemapview"===g&&w.a.createElement(Ee.default,{context:i.name,service:this.state.service,query:this.state.query,cache_data:u,load_data:p,onLoadData:m,onClickEntry:h}),"calendarview"===g&&w.a.createElement(we,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:p,onLoadData:m,onClickEntry:h}),"listview"===g&&w.a.createElement(Ae,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:p,onLoadData:m,onClickEntry:h}))),c&&"googlemapview"!=g&&w.a.createElement(v.a,{className:"p-0 m-0 mb-4"},w.a.createElement(y.a,{xs:12,className:"p-2 flex items-center justify-center"},w.a.createElement(N.a,{count:i.name in s.res?s.res[i.name].count:1,page:i.name in s.res?s.res[i.name].page-1:this.state.page-1,rowsPerPage:this.state.query.pagination,onChangePage:this.handleOnPageChanged,labelRowsPerPage:"Records per page",rowsPerPageOptions:[5,10,25,50,100,{value:-1,label:"All"}],onChangeRowsPerPage:this.handleOnRecordsPerPageChanged,ActionsComponent:Le,SelectProps:{label:"Records per page",variant:"outlined"},classes:{toolbar:"flex-col-reverse px-2"}}))))}}]),a}(w.a.Component);ze.defaultProps={show_actions:!0,show_links:!0,showViewOptions:!0,showAddBtn:!0,showPagination:!0,showSorter:!0,sorterFormLayoutType:"inline",query:{},load_data:!0,cache_data:!0};t.a=_()(g()((function(e){return{root:{padding:e.spacing(),backgroundColor:e.palette.background.paper},calendar:{borderRight:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important",borderLeft:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important"},activeVieBtn:{background:ae.b.hex.primary,color:ae.b.hex.inverse,border:"1px solid"+ae.b.hex.primary},viewBtnGroup:{position:"absolute !important",right:e.spacing()},searchRoot:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%",margin:0},searchInput:{marginLeft:e.spacing(1),flex:1},searchIconButton:{padding:10},searchDivider:{height:28,margin:4}}})),Object(E.b)((function(e){return{auth:e.auth,cache:e.cache,api:e.api,app:e.app}}),{}),be.a)(ze)},1380:function(e,t,a){"use strict";a.r(t);var n=a(24),r=a(12),i=a(9),s=a.n(i),o=a(6),l=a(2),c=a(20),d=a(14),u=a(26),m=a(27),p=a(18),f=a(17),h=a(109),g=a(29),v=a.n(g),y=a(43),b=a.n(y),x=a(1344),w=a(1198),E=a(1202),O=a(1242),_=a(1270),N=a(259),C=a.n(N),k=a(219),j=(a(3),a(41)),S=a(433),D=a(687),A=a(434),R=a(435),q=a(22),P=a(16),M=a(21),J=a(1926),F=a(1927),I=a(601),L=a(1426),z=a.n(L),V=a(0),B=a.n(V),T=a(35),U=a(11),W=a(72),H=a(63),Y=a.n(H),X=a(263),K=(a(1366),a(1370)),Z=a(59),G=a(50),$=a(451),Q=a.n($),ee=a(452),te=a.n(ee),ae=!1,ne=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;Object(d.a)(this,a),(n=t.call(this,e)).state={definations:{},services:{},defination:null,service:null,drawerOpen:!0,show_client_positions:!0,clients_positions:{},context:"commissions",context_entry:null,defaultZoom:10,multicontexts:!0,rendered_contexts:[],contexts_props:{},zoom:15,query:{},records:[],markers:[],circles:[],polylines:[]},n.toggleDrawer=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&e!==n.state.drawerOpen&&n.setState((function(t){return{drawerOpen:e}}))}},n.handleOnDrawerNavigationValueChange=function(e,t){var a=n.props,r=a.definations,i=a.services,s=a.cache;n.setState((function(e){return{context:t,context_entry:null,context_entries:["commissions","tracks"].includes(t)&&Array.isArray(s.data[t])?s.data[t]:[],defination:["commissions","tracks"].includes(t)?r[t]:e.defination,service:["commissions","tracks"].includes(t)?i[t]:e.service}}))},n.handleClientListItemClick=function(e,t){return function(e){console.log("handleClientListItemClick client",t,"googleMap",ae),ae&&(ae.panTo({lat:t.position.latitude,lng:t.position.longitude}),ae.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.setZoom(15))}},n.handleToggleContextRender=function(e,t){var a=n.props,r=a.definations,i=(a.cache,a.apiCallRequest),d=a.app;n.setState((function(t){var a=t.rendered_contexts.indexOf(e);return{rendered_contexts:t.rendered_contexts.includes(e)?t.rendered_contexts.removeAtIndex(a):t.rendered_contexts.concat([e])}}),Object(c.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r[e]&&t?i(r[e].name,{uri:r[e].endpoint,type:"records",params:JSON.isJSON(n.state.contexts_props[e])?n.state.contexts_props[e].query:{page:1,pagination:d.preferences.data.pagination,populate:1},data:{},cache:!0}).then((function(t){r[e]&&Function.isFunction(r[e].views.listing.googlemapview.resolveData)&&Array.isArray(t)&&r[e].views.listing.googlemapview.resolveData(t,!0).then((function(a){n.isMounted()?n.setState((function(n){return{context_entry_type:r[e].views.listing.googlemapview.type,context_entry:t.length>0?0:void 0,contexts_props:Object(l.a)(Object(l.a)({},n.contexts_props),{},Object(o.a)({},e,Object(l.a)(Object(l.a)({},n.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0})))}})):(n.state.context_entry_type=r[e].views.listing.googlemapview.type,n.state.context_entry=t.length>0?0:void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(o.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0}))))}))})).catch((function(e){})):r[e]&&(n.isMounted()?n.setState((function(t){return{context_entry_type:void 0,context_entry:void 0,contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(o.a)({},e,Object(l.a)(Object(l.a)({},t.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))}})):(n.state.context_entry_type=void 0,n.state.context_entry=void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(o.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))));case 1:case"end":return a.stop()}}),a)}))))},n.handleContextEntryClick=function(e,t){n.setState({context_entry:t})};var r=n.props,i=(r.device,r.cache),u=r.context,p=r.contexts,f=(r.definations,r.app);return n.elementRef=B.a.createRef(),n.prepareForView(),n.toggleDrawer=n.toggleDrawer.bind(Object(m.a)(n)),n.handleOnLoadMap=n.handleOnLoadMap.bind(Object(m.a)(n)),n.handleClientListItemClick=n.handleClientListItemClick.bind(Object(m.a)(n)),n.handleOnToggleShowClients=n.handleOnToggleShowClients.bind(Object(m.a)(n)),n.handleOnClientsPositionsLoaded=n.handleOnClientsPositionsLoaded.bind(Object(m.a)(n)),n.handleOnClientPositionAvailable=n.handleOnClientPositionAvailable.bind(Object(m.a)(n)),n.handleOnClientPositionUnavailable=n.handleOnClientPositionUnavailable.bind(Object(m.a)(n)),n.handleOnClientPositionChanged=n.handleOnClientPositionChanged.bind(Object(m.a)(n)),n.handleOnDrawerNavigationValueChange=n.handleOnDrawerNavigationValueChange.bind(Object(m.a)(n)),n.handleContextEntryClick=n.handleContextEntryClick.bind(Object(m.a)(n)),n.handleToggleContextRender=n.handleToggleContextRender.bind(Object(m.a)(n)),n.state=Object(l.a)(Object(l.a)({},n.state),{},{context:u||n.state.context,defaultZoom:f.preferences.data.defaultMapZoom,multicontexts:!!Array.isArray(p)&&p.length>1,rendered_contexts:u?[u]:[],contexts_props:u?Object(o.a)({},u,{query:{page:1,pagination:f.preferences.data.pagination,populate:1},element:"marker",records:[]}):{},context_entries:Array.isArray(i.data[n.state.defination.name])?i.data[n.state.defination.name]:[],drawerOpen:!1}),n}return Object(u.a)(a,[{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"componentDidMount",value:function(){}},{key:"prepareForView",value:function(){for(var e=this.props,t=e.auth,a=e.definations,n=e.services,i=e.app,s=null,o=null,l={},c={},d=this.state.contexts_props,u=0,m=Object.entries(a);u<m.length;u++){var p=Object(r.a)(m[u],2),f=p[0],h=p[1];h.access.restricted(t.user)||h.views.listing.googlemapview&&Function.isFunction(h.views.listing.googlemapview.resolveData)&&(l[f]=h,c[f]=n[f],d[f]={query:{page:1,pagination:i.preferences.data.pagination,populate:1},element:h.views.listing.googlemapview.type,elements:[],loaded:!1},null===s&&(s=h,o=n[f]))}this.state.contexts_props=d,this.state.definations=l,this.state.services=c,this.state.defination=s,this.state.service=o}},{key:"handleOnToggleShowClients",value:function(e){this.setState((function(e){return{show_client_positions:!e.show_client_positions}}))}},{key:"handleOnLoadMap",value:function(e,t){ae=e}},{key:"handleOnClientsPositionsLoaded",value:function(e){this.setState((function(t){return{clients_positions:e}}))}},{key:"handleOnClientPositionAvailable",value:function(e,t){this.setState((function(a){return{clients_positions:Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(o.a)({},e,t))}}))}},{key:"handleOnClientPositionUnavailable",value:function(e,t){this.setState((function(t){var a=JSON.fromJSON(t.clients_positions);return delete a[e],{clients_positions:a}}))}},{key:"handleOnClientPositionChanged",value:function(e,t){this.setState((function(a){return{clients_positions:a.drawerOpen?Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(o.a)({},e,t)):a.clients_positions}}))}},{key:"render",value:function(){var e,t=this,a=this.props,i=a.theme,s=a.classes,c=(a.showAll,a.device),d=(a.sockets,a.definations),u=a.services,m=a.contexts,p=a.actions,f=this.state,g=f.context,y=f.clients_positions,b=(f.show_client_positions,f.rendered_contexts),N=f.contexts_props,I=[],L=[],V=[];return b.map((function(e){d[e]&&e in N&&("marker"===N[e].element&&Array.isArray(N[e].elements)?L=L.concat(N[e].elements):"circle"===N[e].element&&Array.isArray(N[e].elements)?I=I.concat(N[e].elements):"polyline"===N[e].element&&Array.isArray(N[e].elements)&&(V=V.concat(N[e].elements)))})),B.a.createElement(S.a,{elevation:0,outlineColor:i.palette.text.primary,style:{backgroundColor:i.palette.background.paper},ref:this.elementRef},B.a.createElement(R.a,{avatar:B.a.createElement(j.a,{style:{backgroundColor:"rgba(0,0,0,0.05)",color:i.palette.text.primary}},B.a.createElement(z.a,null)),title:this.props.context?d[this.props.context]?d[this.props.context].label+" Map":"Map":"Map Overview",subheader:"Click on any context marker, route or polyline in the map for more infomation on the context ",action:B.a.createElement("div",null,Array.isArray(p)&&p.map((function(e,t){var a=e.onClick,r=e.icon,i=Object(n.a)(e,["onClick","icon"]);return B.a.createElement(h.a,Object.assign({"aria-label":"Action",className:"mx-1 inverse-text translucent ",onClick:a,style:{backgroundColor:"rgba(0,0,0,0.05)"},key:"action-button-"+t},i),r)})),B.a.createElement(h.a,{"aria-label":"menu",color:"inherit",className:"mx-1 inverse-text ",onClick:this.toggleDrawer(!this.state.drawerOpen),style:{backgroundColor:"rgba(0,0,0,0.05)"}},B.a.createElement(C.a,{path:k.f,title:"Map Overview Drawer Menu",rotate:this.state.drawerOpen?0:180,size:.8,color:i.palette.text.primary})))}),B.a.createElement(A.a,{className:"p-0 m-0 overflow-x-hidden"},B.a.createElement(q.a,{className:"p-0 m-0"},B.a.createElement(P.a,{xs:12,className:s.wrapper},B.a.createElement("div",{className:v()(s.content,(e={},Object(o.a)(e,s.contentDrawerMargin,c.window_size.width>=1280),Object(o.a)(e,s.contentShift,this.state.drawerOpen&&c.window_size.width>=1280),e)),style:{minHeight:c.window_size.height,backgroundColor:i.palette.background.paper}},B.a.createElement(X.a,{mapHeight:c.window_size.height,showClientsPositions:b.includes("clients_positions"),showCurrentPosition:!0,onLoadClientsPositions:this.handleOnClientsPositionsLoaded,onClientPositionAvailable:this.handleOnClientPositionAvailable,onClientPositionUnavailable:this.handleOnClientPositionUnavailable,onClientPositionChanged:this.handleOnClientPositionChanged,selectedEntry:this.state.context_entry,selectedEntryType:this.state.context_entry_type?this.state.context_entry_type:"clients_position",defaultZoom:this.state.defaultZoom,zoom:this.state.zoom,onMapLoad:this.handleOnLoadMap,polylines:V,markers:L,circles:I})),B.a.createElement(x.a,{className:s.drawer,variant:c.window_size.width>=1280?"persistent":"temporary",anchor:"right",open:this.state.drawerOpen,onClose:this.toggleDrawer(!1),onOpen:this.toggleDrawer(!0),classes:{paper:c.window_size.width>=1280?s.drawerPaper:s.temporaryDrawerPaper}},this.state.multicontexts&&B.a.createElement(J.a,{value:g,onChange:this.handleOnDrawerNavigationValueChange,showLabels:!0,className:"w-full"},B.a.createElement(F.a,{value:"clients_positions",label:"Users",icon:B.a.createElement(C.a,{path:k.a,title:"Clients Postions Users",size:1})}),Object.entries(this.state.definations).map((function(e,t){var a=Object(r.a)(e,2),n=a[0],i=a[1];return B.a.createElement(F.a,{value:n,label:i.label,icon:i.icon,key:"googlemapview-btn-"+n+"-option"})}))),"clients_positions"===g&&0===Object.size(y)&&B.a.createElement(q.a,null,B.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},B.a.createElement(C.a,{path:k.d,title:"No Records available yet.",color:"#CCCCCC",size:5})),B.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},B.a.createElement(M.a,null,"No Records available yet."))),"clients_positions"===g&&B.a.createElement(w.a,{className:s.root},Object.entries(y).map((function(e,a){var n=Object(r.a)(e,2),i=n[0],s=n[1],o=!0;if(a>0?s.user._id===y[Object.keys(y)[a-1]].user._id&&(o=!1):ae&&(ae.panTo({lat:s.position.latitude,lng:s.position.longitude}),ae.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.setZoom(15)),s.user&&o)return B.a.createElement(E.a,{className:"cursor-pointer hover:bg-gray-400",onClick:t.handleClientListItemClick(i,s),key:"client-"+i},B.a.createElement(_.a,null,B.a.createElement(j.a,{src:String.isString(s.user.gender)&&"female"===s.user.gender.trim().toLowerCase()?Q.a:te.a})),B.a.createElement(O.a,{primary:s.user.first_name+" "+s.user.last_name,secondary:String.isString(s.user.role)?s.user.role.humanize():""}))}))),"commissions"===g&&B.a.createElement(K.a,{defination:d.commissions,service:u.commissions,query:{},showViewOptions:!1,showAddBtn:!1,showSorter:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[g]&&Function.isFunction(d[g].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[g].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(o.a)({},g,Object(l.a)(Object(l.a)({},t.contexts_props[g]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(a){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(o.a)({},g,Object(l.a)(Object(l.a)({},t.contexts_props[g]),{},{elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}),"tracks"===g&&B.a.createElement(K.a,{defination:d.tracks,service:u.tracks,showViewOptions:!1,showAddBtn:!1,showSorter:!0,showPagination:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[g]&&Function.isFunction(d[g].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[g].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(o.a)({},g,Object(l.a)(Object(l.a)({},t.contexts_props[g]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(o.a)({},g,Object(l.a)(Object(l.a)({},t.contexts_props[g]),{},{query:a,elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}))))),B.a.createElement(D.a,null,B.a.createElement(q.a,{className:"p-0 m-0"},Array.isArray(m)&&m.map((function(e,a){return B.a.createElement(P.a,{xs:12,md:Math.round(12/m.length),className:"flex items-center justify-center",key:"context_entry_switch-"+a},B.a.createElement(Z.l,{label:"clients_positions"===e?"Users":d[e]?d[e].label:e,value:t.state.rendered_contexts.includes(e),onChange:function(a){t.handleToggleContextRender(e,a)}}))})),B.a.createElement(P.a,{xs:12},B.a.createElement(M.a,{variant:"body2"},this.props.context&&d[this.props.context]?d[this.props.context].label+" Map from a glance":"Map from a glance")))))}}]),a}(B.a.Component);ne.defaultProps={contexts:["clients_positions","commissions","tracks"],context:"clients_positions",actions:[]};t.default=Object(W.c)(Y()(b()((function(e){return{root:{padding:"0"},wrapper:{display:"flex",margin:0,padding:0},drawer:{width:e.appDrawer.width,flexShrink:0},drawerPaper:{width:e.appDrawer.width,position:"absolute",zIndex:e.zIndex.appBar/2,backgroundColor:e.palette.background.paper},temporaryDrawerPaper:{width:e.appDrawer.width,background:e.palette.background.default},content:{flexGrow:1,padding:0,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentDrawerMargin:{marginRight:-e.appDrawer.width},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}})),Object(T.b)((function(e){return{app:e.app,auth:e.auth,cache:e.cache,device:e.device}}),{apiCallRequest:U.gb,closeDialog:U.pb,openDialog:U.sb}),I.a,G.a)(ne))},1416:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=i},1417:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"}),"People");t.default=i},1477:function(e,t,a){"use strict";var n=a(12),r=a(0),i=a.n(r);function s(e){var t=e.className,a=e.children,s=e.offset,o=e.onViewportVisibilityChange,l=(e.placeholder,e.placeholderType,Object(r.useRef)());!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0px",a=Object(r.useState)(!1),i=Object(n.a)(a,2),s=i[0],l=i[1];Object(r.useEffect)((function(){var a=new IntersectionObserver((function(e){var t=Object(n.a)(e,1)[0];l(t.isIntersecting),Function.isFunction(o)&&o(t.isIntersecting)}),{rootMargin:t});return e.current&&a.observe(e.current),function(){a.unobserve(e.current)}}),[])}(l,0-Number.parseNumber(s,0)+"px");return i.a.createElement("div",{className:t||"w-full ",ref:l},a)}s.defaultProps={placeholderType:"skeleton",placeholder:{variant:"rect",width:"100%",height:200,animation:"wave"},offset:0},t.a=s},1864:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6zm-2 16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"}),"AudiotrackOutlined");t.default=i},1865:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M4 6.47L5.76 10H20v8H4V6.47M22 4h-4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4z"}),"MovieOutlined");t.default=i},1866:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}),"AttachFile");t.default=i},1867:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");t.default=i},1868:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M20 0H4v2h16V0zM4 24h16v-2H4v2zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75zM17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5V17z"}),"Contacts");t.default=i},1869:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight");t.default=i},1870:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft");t.default=i},1871:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"}),"Block");t.default=i},1872:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done");t.default=i},1873:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"}),"DoneAll");t.default=i},1874:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");t.default=i},1875:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"}),"ChatBubbleOutline");t.default=i},1876:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"}),"DeleteOutlined");t.default=i},1946:function(e,t,a){"use strict";a.r(t);var n=a(14),r=a(26),i=a(18),s=a(17),o=(a(3),a(22)),l=a(16),c=a(0),d=a.n(c),u=a(35),m=a(63),p=a.n(m),f=a(601),h=a(11),g=a(6),v=a(2),y=a(12),b=a(24),x=a(29),w=a.n(x),E=a(43),O=a.n(E),_=a(1263),N=a(1331),C=a(721),k=a(632),j=a(1240),S=a(77),D=a(1416),A=a.n(D),R=a(1867),q=a.n(R),P=a(1417),M=a.n(P),J=a(1868),F=a.n(J),I=a(1870),L=a.n(I),z=a(1869),V=a.n(z),B=a(256),T=a.n(B),U=a(1329),W=a(431),H=a(1209),Y=a(1271),X=a(1875),K=a.n(X),Z=a(603),G=a.n(Z),$=a(1874),Q=a.n($),ee=a(351),te=a.n(ee),ae=a(1866),ne=a.n(ae),re=a(600),ie=a.n(re),se=a(1865),oe=a.n(se),le=a(1864),ce=a.n(le),de=a(1876),ue=a.n(de),me=a(1871),pe=a.n(me),fe=a(1872),he=a.n(fe),ge=a(1873),ve=a.n(ge),ye=a(1198),be=a(1202),xe=a(1242),we=a(1270),Ee=a(1211),Oe=a(1344),_e=a(1333),Ne=(a(433),a(687),a(434),a(435),a(1303)),Ce=a(212),ke=a(109),je=a(258),Se=a(436),De=a(1477),Ae=a(1370),Re=a(59),qe=a(72),Pe=a(67),Me=a(42);function Je(e){return d.a.createElement(H.a,Object.assign({elevation:6,variant:"filled"},e))}function Fe(e){var t,a=e.classes,n=e.className,r=(e.layout,e.communication.messaging),i=(e.activeConversation,e.auth),s=e.device.window_size,u=e.apiCallRequest,m=e.theme,p=e.setMessagingCache,f=(e.clearMessagingCache,Object(b.a)(e,["classes","className","layout","communication","activeConversation","auth","device","apiCallRequest","theme","setMessagingCache","clearMessagingCache"]),d.a.createRef()),h=d.a.createRef(),x=Object(Pe.h)(),E=Object(Pe.g)(),O=Object(qe.b)(),D=O.definations,R=O.services,P=O.sockets,J=(r.unread_count,r.unread_ids,r.conversations),I=(r.contacts,r.drafts,r.active_conversation),z=r.active_conversation_messages,B=Object(c.useState)(Array.isArray(J)?J:[]),H=Object(y.a)(B,2),X=H[0],Z=H[1],$=Object(c.useState)(I),ee=Object(y.a)($,2),ae=(ee[0],ee[1],Object(c.useState)(z)),re=Object(y.a)(ae,2),se=(re[0],re[1],Object(c.useState)({desc:"created_on"})),le=Object(y.a)(se,2),de=le[0],me=(le[1],Object(c.useState)({desc:"created_on"})),fe=Object(y.a)(me,2),ge=fe[0],Fe=fe[1],Ie=Object(c.useState)(!0),Le=Object(y.a)(Ie,2),ze=Le[0],Ve=Le[1],Be=Object(c.useState)(!0),Te=Object(y.a)(Be,2),Ue=(Te[0],Te[1]),We=Object(c.useState)({}),He=Object(y.a)(We,2),Ye=He[0],Xe=He[1],Ke=Object(c.useState)([]),Ze=Object(y.a)(Ke,2),Ge=(Ze[0],Ze[1]),$e=Object(c.useState)(!1),Qe=Object(y.a)($e,2),et=Qe[0],tt=Qe[1],at=Object(c.useState)([]),nt=Object(y.a)(at,2),rt=(nt[0],nt[1]),it=Object(c.useState)(!1),st=Object(y.a)(it,2),ot=st[0],lt=st[1],ct=Object(c.useState)(!1),dt=Object(y.a)(ct,2),ut=dt[0],mt=dt[1],pt=Object(c.useState)({mouseX:null,mouseY:null}),ft=Object(y.a)(pt,2),ht=ft[0],gt=ft[1],vt=Object(c.useState)(!1),yt=Object(y.a)(vt,2),bt=(yt[0],yt[1]),xt=Object(c.useState)(!1),wt=Object(y.a)(xt,2),Et=wt[0],Ot=wt[1],_t=Object(c.useState)(!0),Nt=Object(y.a)(_t,2),Ct=Nt[0],kt=Nt[1],jt=Object(c.useState)(!1),St=Object(y.a)(jt,2),Dt=(St[0],St[1],[{icon:d.a.createElement(ie.a,null),name:"image",label:"Image",color:m.palette.error.main},{icon:d.a.createElement(ce.a,null),name:"audio",label:"Audio",color:m.palette.accent.main},{icon:d.a.createElement(oe.a,null),name:"video",label:"Video",color:m.palette.warning.main},{icon:d.a.createElement(ne.a,null),name:"file",label:"File",color:m.palette.info.main}]),At=function(){D&&(Ve(!0),u(D.conversations.name,{uri:"/inbox",type:"records",params:Object(v.a)(Object(v.a)({},de),{},{p:"1"}),data:{},cache:!1}).then((function(e){Array.isArray(e)&&p("conversations",e),tt(!1),Ve(!1)})).catch((function(e){console.log("conversations e",e);var t=e;JSON.isJSON(e)&&(t="msg"in e?e.msg:JSON.stringify(e)),tt(t),Ve(!1)})))},Rt=function(e,t){return function(a){a.preventDefault(),gt({type:e,entry:t,mouseX:a.clientX-2,mouseY:a.clientY-4})}},qt=function(){gt({mouseX:null,mouseY:null})},Pt=function(e){if(e){var t=[];(e=Array.isArray(e)?e:[e]).map((function(e){JSON.isJSON(e)&&"_id"in e?t.push(e._id):String.isEmpty(e)||t.push(e)})),lt(!1);var a=-1;if(J.map((function(e,n){if(-1===a&&"individual"===e.type){var r=e.owner,s=e.recipients[0];JSON.isJSON(e.owner)&&"_id"in e.owner&&(r=e.owner._id),r=r,s=JSON.isJSON(e.recipients[0])&&"_id"in e.recipients[0]?e.recipients[0]._id:e.recipients[0],(r==i.user._id&&t.includes(s)||s===i.user._id&&t.includes(r))&&(a=n)}})),-1!==a){var n=J,r=JSON.parse(JSON.stringify(n[a]));n.remove(a),n.unshift(r),Lt(r),p("conversations",n),p("active_conversation_messages",[]),p("active_conversation",r),Xe({is_reply:!1,sender:i.user,reply_for:null,type:"text",content:"",conversation:r._id})}else{var s={recipients:t,participants:e,state:{total:0,unread:0,read:0,last_message:{}},owner:i.user._id,started_by:i.user,type:Array.isArray(e)&&e.length>1?"group":"individual"};p("active_conversation_messages",[]),P.default&&P.default.emit("create-conversation",s)}}},Mt=function(e){var t=e.user,a=e.presence;rt((function(e){try{var n=JSON.parse(JSON.stringify(e)),r=t;return JSON.isJSON(t)&&(r=t._id),n.forEach((function(e){r===e._id&&(e.presence=a)})),n}catch(i){return console.error(i),e}})),p("conversations",(function(e){try{var n=JSON.parse(JSON.stringify(e)),r=t;return JSON.isJSON(t)&&(r=t._id),n.forEach((function(e){if("individual"===e.type){var t=e.owner;JSON.isJSON(e.owner)&&(t=e.owner._id),t===r?JSON.isJSON(e.owner)&&(e.owner.presence=a):Array.isArray(e.recipients)&&e.recipients.length>0&&JSON.isJSON(e.recipients[0])&&(e.recipients[0].presence=a)}})),n}catch(i){return console.error(i),e}}))},Jt=function(e){var t=e.conversation,a=e.user;p("conversations",(function(e){try{var n=JSON.parse(JSON.stringify(e)),r=a;JSON.isJSON(a)&&(r=a._id);var s=t;return JSON.isJSON(t)&&(s=t._id),n.forEach((function(e){if(e._id===s){var t=Array.isArray(e.typing)?e.typing:[],n=!1;t.map((function(e){n||e._id!==r||(n=!0)})),n||r===i.user._id||(e.typing=t.concat([a]))}})),n}catch(o){return console.error(o),e}})),p("active_conversation",(function(e){if(!e)return!1;try{var t=JSON.parse(JSON.stringify(e)),n=a;if(JSON.isJSON(a)&&(n=a._id),Array.isArray(t.typing)){var r=Array.isArray(t.typing)?t.typing:[],s=!1;r.map((function(e){s||e._id!==n||(s=!0)})),s||n===i.user._id||(t.typing=r.concat([a]))}else n!==i.user._id&&(t.typing=[a]);return t}catch(o){return console.error(o),e}}))},Ft=function(e){var t=e.conversation,a=e.user;p("conversations",(function(e){try{var n=JSON.parse(JSON.stringify(e)),r=a;JSON.isJSON(a)&&(r=a._id);var i=t;return JSON.isJSON(t)&&(i=t._id),n.forEach((function(e){if(e._id===i){var t=Array.isArray(e.typing)?e.typing:[];e.typing=t.filter((function(e){return e._id!==r})),Array.isArray(e.typing)||(e.typing=[])}})),n}catch(s){return console.error(s),e}})),p("active_conversation",(function(e){if(!e)return!1;var n=a;JSON.isJSON(a)&&(n=a._id);var r=t;if(JSON.isJSON(t)&&(r=t._id),r!==e._id)return e;try{var i=JSON.parse(JSON.stringify(e)),s=Array.isArray(i.typing)?i.typing:[];return i.typing=s.filter((function(e){return e._id!==n})),Array.isArray(i.typing)||(i.typing=[]),i}catch(o){return console.error(o),e}}))},It=function(e){e.conversation;var t=e.messages;bt(!1),p("active_conversation_messages",t)},Lt=function(e){e?(bt(!0),p("active_conversation_messages",[]),P.default&&P.default.emit("get-conversation-messages",{conversation:e._id,user:i.user})):bt(!1)},zt=function(e){tt(e)},Vt=function(e){var t=e.message;e.user;p("active_conversation_messages",(function(e){try{var a=JSON.parse(JSON.stringify(e));return Array.isArray(a)&&a.forEach((function(e){e._id===t._id&&(e.state=t.state)})),a}catch(n){return console.error(n),e}}))},Bt=function(e){var t=e.message;e.user;p("active_conversation_messages",(function(e){try{var a=JSON.parse(JSON.stringify(e));return Array.isArray(a)&&a.forEach((function(e){e._id===t._id&&(e.state=t.state)})),a}catch(n){return console.error(n),e}}))},Tt=function(e){var t=e.message;e.user;p("active_conversation_messages",(function(e){try{var a=JSON.parse(JSON.stringify(e));return Array.isArray(a)&&a.forEach((function(e){e._id===t._id&&(e.state=t.state)})),a}catch(n){return console.error(n),e}}))};return Object(c.useEffect)((function(){Z(J)}),[J]),Object(c.useEffect)((function(){I&&Ct&&(Lt(I),kt(!1))}),[I,Ct]),Object(c.useEffect)((function(){if(x&&!Et){var e=new URLSearchParams(x.search).get("with");console.log("location withRecipient",e),String.isEmpty(e)||(-1!==e.indexOf("@")?Fe({email_address:e.trim()}):Fe({_id:e.trim()}),Ot(!0))}}),[x,Et]),Object(c.useEffect)((function(){console.log("contactsQuery",ge)}),[ge]),Object(c.useEffect)((function(){if(Array.isArray(J)){var e=[];J.map((function(t){if("individual"===t.type){var a=t.owner;JSON.isJSON(t.owner)&&(a=t.owner._id),a!==i.user._id?e.push(a):Array.isArray(t.recipients)&&t.recipients.length>0&&(JSON.isJSON(t.recipients[0])?e.push(t.recipients[0]._id):e.push(t.recipients[0]))}})),Ge(e)}}),[J]),Object(c.useEffect)((function(){At()}),[D,de]),Object(c.useEffect)((function(){if(P.default)return P.default.on("presence-changed",Mt),P.default.on("user-changed-presence",Mt),P.default.on("message-typing-started",Jt),P.default.on("message-typing-stopped",Ft),P.default.on("conversation-messages",It),P.default.on("messages-deleted-for-user",Vt),P.default.on("messages-deleted-for-all",Bt),P.default.on("message-marked-as-received",Tt),P.default.on("message-received",Tt),P.default.on("message-marked-as-read",Tt),P.default.on("message-read",Tt),P.default.on("delete-conversation-for-user-error",zt),P.default.on("delete-message-for-user-error",zt),P.default.on("delete-message-for-all-error",zt),function(){P.default.off("presence-changed",Mt),P.default.off("user-changed-presence",Mt),P.default.off("message-typing-started",Jt),P.default.off("message-typing-stopped",Ft),P.default.off("conversation-messages",It),P.default.off("messages-deleted-for-user",Vt),P.default.off("messages-deleted-for-all",Bt),P.default.off("delete-conversation-for-user-error",zt),P.default.off("message-marked-as-received",Tt),P.default.off("message-received",Tt),P.default.off("message-marked-as-read",Tt),P.default.off("message-read",Tt),P.default.off("delete-message-for-user-error",zt),P.default.off("delete-message-for-all-error",zt),P.default.off("create-conversation-error",zt)}}),[P]),d.a.createElement(Ce.a,{className:w()((t={"p-0 m-0 relative":!0},Object(g.a)(t,a.root,!0),Object(g.a)(t,n,!0),t))},d.a.createElement(N.a,{position:"absolute",color:"transparent",className:a.mainAppBar},d.a.createElement(C.a,null,I&&d.a.createElement(ke.a,{onClick:function(){E&&Et&&E.push(E.location.pathname),p("active_conversation_messages",[]),p("active_conversation",!1)},className:"mr-2",edge:"start",color:"inherit","aria-label":"back-to-conversations"},d.a.createElement(A.a,null)),I&&("individual"==I.type?i.user._id!==I.owner._id&&i.user._id!==I.owner||!I.participants[0].avatar?I.started_by.avatar?d.a.createElement(Ee.a,{className:"mr-6 w-6 h-6",src:Me.attachments.getAttachmentFileUrl(I.started_by.avatar)}):d.a.createElement(Ee.a,{className:"mr-2 w-6 h-6 bg-transparent accent-text"},d.a.createElement(q.a,null)):d.a.createElement(Ee.a,{className:"mr-6 w-6 h-6",src:Me.attachments.getAttachmentFileUrl(I.participants[0].avatar)}):I.group_avatar?d.a.createElement(Ee.a,{className:"mr-6",src:Me.attachments.getAttachmentFileUrl(I.group_avatar)}):d.a.createElement(Ee.a,{className:"mr-6 w-6 h-6 bg-transparent accent-text"}," ","group"===I.type?d.a.createElement(M.a,null):d.a.createElement(q.a,null))),I&&d.a.createElement(S.a,{variant:"h6",className:"capitalize flex-grow"},"individual"==I.type?i.user._id===I.owner._id||i.user._id===I.owner?I.participants[0].first_name+" "+I.participants[0].last_name:I.started_by.first_name+" "+I.started_by.last_name:"group"==I.type?I.group_name:"Realfield"),!I&&d.a.createElement(S.a,{variant:"h6",className:"capitalize flex-grow"},"Conversations"),!I&&!ot&&d.a.createElement(ke.a,{onClick:function(){return lt(!0)},className:"mr-2",edge:"end",color:"inherit","aria-label":"Contacts"},d.a.createElement(F.a,null)))),d.a.createElement(Oe.a,{className:w()(Object(g.a)({},a.drawer,!0)),variant:s.width>=768?"persistent":"temporary",anchor:"right",open:ot,onClose:function(){return lt(!1)},onOpen:function(){return lt(!0)},classes:{paper:s.width>=768?a.drawerPaper:a.temporaryDrawerPaper}},d.a.createElement("div",{className:"w-full flex flex-row items-center h-16 secondary"},d.a.createElement(ke.a,{className:"mx-2",color:"inherit"},d.a.createElement(F.a,null)),d.a.createElement(S.a,{variant:"h6",className:"capitalize flex-grow"},"Contacts"),d.a.createElement(ke.a,{className:"mx-2",color:"inherit",onClick:function(){return lt(!1)}},"ltr"===m.direction?d.a.createElement(V.a,null):d.a.createElement(L.a,null))),d.a.createElement(U.a,null),d.a.createElement(je.a,{className:a.bodyWrapper},D&&d.a.createElement(Ae.a,{show_actions:!1,show_links:!1,showViewOptions:!1,showAddBtn:!1,cache_data:!1,showPagination:!0,showSorter:!0,defination:D.users,service:R.users,query:ge,view:"listview",onClickEntry:function(e){return Pt(e)},onLoadData:function(e,t){Et&&Array.isArray(e)&&e.map((function(a){a._id!==t._id&&a.email_address!==t.email_address||(Pt(a),console.log("onLoadData",e,t))}))}}))),!I&&d.a.createElement(l.a,{md:12,className:"flex flex-col relative min-h-full p-0"},d.a.createElement(Ce.a,{square:!0,className:a.paper},d.a.createElement(je.a,{className:a.bodyWrapper},ze&&(!Array.isArray(J)||Array.isArray(J)&&0===J.length)&&d.a.createElement(o.a,null,d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:80,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-3/6"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:110,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-8/12"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:80,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-4/12"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:90,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-3/6"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:70,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-10/12"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:80,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-9/12"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:120,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-4/5"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:100,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-3/6"}))),d.a.createElement(l.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},d.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),d.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},d.a.createElement(Ne.a,{variant:"text",width:80,className:"mb-1"}),d.a.createElement(Ne.a,{variant:"text",className:"w-11/12"})))),!ze&&(!Array.isArray(J)||Array.isArray(J)&&0===X.length)&&d.a.createElement(o.a,null,d.a.createElement(l.a,{md:12,className:"flex flex-col items-center relative p-0 px-4 my-4"},d.a.createElement(S.a,{variant:"subtitle1",color:"textSecondary",className:"mx-0 my-12 h-20 w-20 md:w-40  md:h-40 rounded-full text-4xl md:text-6xl flex flex-row items-center justify-center",style:{color:m.palette.text.disabled,background:m.palette.background.default}},d.a.createElement(G.a,{fontSize:"inherit"})),d.a.createElement(S.a,{variant:"body2",color:"textSecondary",className:"mx-0",style:{color:m.palette.text.disabled}},"You don't have any active conversations yet"))),Array.isArray(J)&&!ze&&d.a.createElement(ye.a,{className:a.list},J.map((function(e,t){if(0===t||t>0&&J[t-1]._id!==J[t]._id){var n="",r=!1,s=!1,o=!1,l=!1,c=!1;if(e.state.total>0&&e.state.last_message&&(o=e.state.last_message.content,e.state.last_message.sender===i.user._id?c="You":e.owner===e.state.last_message.sender?c=e.started_by.first_name:Array.isArray(e.participants)&&e.participants.map((function(t){t._id===e.state.last_message.sender&&(c=t.first_name)})),("deleted-for-sender"===e.state.last_message.state&&e.state.last_message.sender._id===i.user._id||"deleted-for-all"===e.state.last_message.state)&&(l=!0)),"individual"==e.type){var u=e.owner;JSON.isJSON(e.owner)&&(u=e.owner._id),i.user._id===u?Array.isArray(e.participants)&&e.participants.length>0&&(r=e.participants[0],n=e.participants[0].first_name+" "+e.participants[0].last_name,s=e.participants[0].avatar):(r=e.started_by,n=e.started_by.first_name+" "+e.started_by.last_name,s=e.started_by.avatar)}else"group"==e.type&&(n=e.group_name,s=e.group_avatar);return d.a.createElement(be.a,{className:"px-8 content-between",onClick:function(t){p("active_conversation_messages",[]),p("active_conversation",e),Lt(e)},onContextMenu:Rt("conversation",e),key:"chat-"+t,style:{background:"conversation"===ht.type&&ht.entry._id===e._id?m.palette.background.default:"transparent"},button:!0},r&&d.a.createElement(we.a,null,d.a.createElement(_.a,{variant:"dot",badgeContent:" ",anchorOrigin:{vertical:"bottom",horizontal:"right"},classes:{dot:"online"===r.presence?"bg-green-600":"away"==r.presence?"bg-orange-500":"bg-gray-500"}},r.avatar&&d.a.createElement(Ee.a,{className:a.contactAvatar,src:Me.attachments.getAttachmentFileUrl(r.avatar)}),!r.avatar&&d.a.createElement(Ee.a,{className:a.contactAvatar},d.a.createElement(q.a,null)))),!r&&d.a.createElement(we.a,null,s&&d.a.createElement(Ee.a,{src:Me.attachments.getAttachmentFileUrl(s)}),!s&&d.a.createElement(Ee.a,{className:a.iconAvatar},"group"===e.type?d.a.createElement(M.a,null):d.a.createElement(q.a,null))),d.a.createElement(xe.a,{className:"flex flex-col justify-center",primary:d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"capitalize font-bold"},n),secondary:d.a.createElement("div",{className:"w-full flex flex-row"},Array.isArray(e.typing)&&d.a.createElement(S.a,{variant:"body2",color:"primary",className:"mx-0"},e.typing.length>1?e.typing.length+" people are typing...":1===e.typing.length?e.typing[0].first_name+" is typing...":""),(!Array.isArray(e.typing)||0===e.typing.length)&&d.a.createElement("div",{className:"flex flex-row items-center flex-grow"},d.a.createElement(S.a,{variant:"body2",color:"textPrimary",className:"font-bold mr-2"},c||""),d.a.createElement(S.a,{variant:"body2",color:"textSecondary",className:"flex-grow truncate mr-2 font-normal"},o||"No messages yet"),l&&d.a.createElement("div",{className:"flex flex-row items-center w-full",style:{color:m.palette.divider}},d.a.createElement(S.a,{variant:"body1",color:"inherit",className:"flex-grow"},"Message deleted"),d.a.createElement(pe.a,{className:"mx-2 text-xs",fontSize:"small"})),!l&&d.a.createElement("div",{className:"flex flex-row items-center w-full",style:{color:m.palette.text.disabled}},"sent"===e.state.last_message.state&&e.state.last_message.sender===i.user._id&&d.a.createElement(he.a,{className:"mx-1 text-xs",fontSize:"small"}),("partially-received"===e.state.last_message.state||"received"===e.state.last_message.state)&&e.state.last_message.sender===i.user._id&&d.a.createElement(ve.a,{className:"mx-1 text-xs",fontSize:"small"}),("partially-read"===e.state.last_message.state||"read"===e.state.last_message.state)&&e.state.last_message.sender===i.user._id&&d.a.createElement(ve.a,{className:"mx-1 text-xs",color:"secondary",fontSize:"small"}))),(!Array.isArray(e.typing)||0===e.typing.length)&&d.a.createElement(S.a,{variant:"body2",color:"secondary",className:"mx-2"}))}),e.state.incoming_unread>0&&d.a.createElement(Y.a,null,d.a.createElement(Ee.a,{className:"bg-transparent primary-text h-4 w-4 text-xs"},e.state.incoming_unread)))}}))))),d.a.createElement(N.a,{position:"absolute",color:"secondary",className:a.chatsAppBar},d.a.createElement(C.a,null,d.a.createElement(ke.a,{edge:"start",color:"inherit","aria-label":"Refresh",onClick:function(){At(),D&&(Ue(!0),u("contacts",{uri:"/contacts",type:"records",params:{p:"1"},data:{},cache:!1}).then((function(e){Array.isArray(e)&&(p("contacts",e),rt(e)),tt(!1),Ue(!1)})).catch((function(e){console.log("contacts e",e);var t=e;JSON.isJSON(e)&&(t="msg"in e?e.msg:JSON.stringify(e)),tt(t),Ue(!1)})))}},d.a.createElement(Q.a,null)),d.a.createElement(_e.a,{color:"primary","aria-label":"add",className:a.fabButton,onClick:function(){return lt(!ot)}},!ot&&d.a.createElement(K.a,null),ot&&d.a.createElement(te.a,null)),d.a.createElement("div",{className:a.grow})))),I&&d.a.createElement(Ce.a,{square:!0,elevation:0,className:a.chatPaperWrapper},d.a.createElement(l.a,{md:12,className:"h-full p-0 flex flex-col relative"},!["audio","file","video","image"].includes(Ye.type)&&d.a.createElement(je.a,{className:"flex-grow "+a.chatScrollWrapper,style:{flex:10,backgroundColor:m.palette.background.default},scrollToBottomOnChildChange:!1,ref:h},d.a.createElement(o.a,{className:"px-4"},z.map((function(e,t){var n=!1,r=!0;if(t>0&&(z[t]._id!==z[t-1]._id&&e.conversation._id===I._id||(r=!1)),e&&r)return("deleted-for-sender"===e.state&&e.sender._id===i.user._id||"deleted-for-all"===e.state)&&(n=!0),d.a.createElement(l.a,{xs:12,className:"flex p-0 py-1 "+(e.sender._id===i.user._id?"flex-row-reverse":"flex-row"),id:"message-"+e._id,key:"conversation-"+I._id+"-message-"+t},d.a.createElement(De.a,{className:"p-2 mx-4  flex flex-col px-4 "+(e.sender._id===i.user._id?"bg-green-200 "+a.chatBubbleLocal:"bg-white "+a.chatBubbleExternal),onViewportVisibilityChange:function(t){t&&P.default&&("sent"===e.state&&e.sender._id!==i.user._id?P.default.emit("mark-message-as-received",{message:e,user:i.user}):"received"!==e.state&&"partially-received"!==e.state||e.sender._id===i.user._id||P.default.emit("mark-message-as-read",{message:e,user:i.user}))}},!n&&JSON.isJSON(e.sender)&&d.a.createElement("div",{className:"flex flex-row w-full items-center mb-1"},d.a.createElement(S.a,{variant:"body1",className:"flex-grow text-gray-500 font-bold"},e.sender.first_name+" "+e.sender.last_name),d.a.createElement(ke.a,{"aria-label":"Toggle Menu",onClick:Rt("message",e),className:"",size:"small"},d.a.createElement(T.a,{fontSize:"inherit"}))),!n&&["audio","file","video","image"].includes(e.type)&&Array.isArray(e.attachments)&&d.a.createElement("div",{className:"flex flex-col items-center mb-2"},e.attachments.map((function(t){return d.a.createElement("div",{className:"p-2 w-11/12 border border-gray-400 rounded"},"image"===e.type&&d.a.createElement(Se.a,{className:"w-full h-auto",src:Me.attachments.getAttachmentFileUrl(t),alt:t.name}),"audio"===e.type&&d.a.createElement("div",{className:"w-full h-auto flex flex-row items-center"},d.a.createElement(ce.a,{className:"text-2xl"}),d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"flex-grow truncate"},t.name)),"video"===e.type&&d.a.createElement("div",{className:"w-full h-auto flex flex-row items-center"},d.a.createElement(oe.a,{className:"text-2xl"}),d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"flex-grow truncate"},t.name)),"file"===e.type&&d.a.createElement("div",{className:"w-full h-auto flex flex-row items-center"},d.a.createElement(ne.a,{className:"text-2xl"}),d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"flex-grow truncate"},t.name)))}))),!n&&d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"flex-grow",paragraph:!0},e.content),n&&d.a.createElement("div",{className:"flex flex-row items-center w-full",style:{color:m.palette.divider}},d.a.createElement(S.a,{variant:"body1",color:"inherit",className:"flex-grow"},"Message deleted"),d.a.createElement(pe.a,{className:"mx-2",fontSize:"small"})),!n&&d.a.createElement("div",{className:"flex flex-row items-center w-full",style:{color:m.palette.text.disabled}},e.created_on&&d.a.createElement(S.a,{variant:"body2",className:"text-xs flex-grow"},e.created_on instanceof Date?e.created_on.toLocaleString():new Date(e.created_on).toLocaleString()),"sent"===e.state&&e.sender._id===i.user._id&&d.a.createElement(he.a,{className:"mx-2",fontSize:"small"}),("partially-received"===e.state||"received"===e.state)&&e.sender._id===i.user._id&&d.a.createElement(ve.a,{className:"mx-2",fontSize:"small"}),("partially-read"===e.state||"read"===e.state)&&e.sender._id===i.user._id&&d.a.createElement(ve.a,{className:"mx-2",color:"secondary",fontSize:"small"}))))})),!!Array.isArray(I.typing)&&I.typing.length>0&&d.a.createElement(l.a,{xs:12,className:"flex p-0 py-1 flex-row"},d.a.createElement("div",{className:a.avatar}," "),d.a.createElement("div",{className:"p-2 mx-4  flex flex-col px-4  rounded-full"},d.a.createElement("div",{className:a.typing_loader}))),d.a.createElement("div",{className:"w-full h-1",id:"chatLastChild"}," "))),d.a.createElement(o.a,{className:["audio","file","video","image"].includes(Ye.type)?"flex-grow flex flex-col":a.chatInputsWrapper,style:{backgroundColor:m.palette.background.paper,top:["audio","file","video","image"].includes(Ye.type)?0:"auto"}},Ye.reply_for&&d.a.createElement(l.a,{xs:12,className:"flex flex-row items-center bg-green-200"},d.a.createElement("div",{className:"p-2 mx-4"},d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:"font-bold"},Ye.reply_for.sender.first_name+" "+Ye.reply_for.sender.last_name),d.a.createElement(S.a,{variant:"body1",color:"textPrimary",className:""},Ye.reply_for.content))),["audio","file","video","image"].includes(Ye.type)&&d.a.createElement(l.a,{xs:12,className:"flex flex-grow flex-row items-center bg-grey-200"},d.a.createElement(Re.e,{variant:"outlined",value:["audio","file","video","image"].includes(Ye.type)&&Array.isArray(Ye.attachments)&&Ye.attachments>0?Ye.attachments[0]:void 0,onChange:function(e){Xe((function(t){try{var a=JSON.parse(JSON.stringify(t));return e?a.attachments=[e]:delete a.attachments,a}catch(n){return console.error(n),t}})),console.log("FileInput newValue ",e)},filesLimit:1,acceptedFiles:"file"===Ye.type?["image/*","video/*","audio/*","application/*"]:[Ye.type+"/*"]})),ut&&d.a.createElement(l.a,{xs:12,className:"flex flex-row items-center justify-evenly bg-grey-200"},Dt.map((function(e){return d.a.createElement(_e.a,{key:e.name,color:e.color,"aria-label":"Attach "+e.label,onClick:function(){var t;mt(!1),t=e.name,Xe((function(e){try{var a=JSON.parse(JSON.stringify(e));return a.type=t,a}catch(n){return console.error(n),e}}))},style:{background:e.color,color:m.palette.background.paper},className:"mx-2"},e.icon)}))),d.a.createElement(l.a,{xs:12,className:"flex flex-row items-center"},d.a.createElement(ke.a,{onClick:function(e){mt(!ut)},"aria-label":ut?["audio","file","video","image"].includes(Ye.type)&&Array.isArray(Ye.attachments)&&Ye.attachments>0?"Remove Attachments":"Dismiss File Attachment":"Close File Attachment",className:"mx-2"},ut?["audio","file","video","image"].includes(Ye.type)&&Array.isArray(Ye.attachments)&&Ye.attachments>0?d.a.createElement(ue.a,{color:"inherit"}):d.a.createElement(te.a,{color:"inherit"}):d.a.createElement(ne.a,{color:"inherit"})),d.a.createElement("div",{className:"flex-grow rounded-full mx-8"},d.a.createElement(Re.m,{variant:["audio","file","video","image"].includes(Ye.type)?"standard":"outlined",multiline:!0,rows:2,onBlur:function(e,t){I._id&&!String.isEmpty(e)&&Xe((function(t){try{var a={content:e,conversation:I._id};return JSON.isJSON(t)&&((a=JSON.parse(JSON.stringify(t))).content=e,a.conversation=I._id),a}catch(n){return console.error(n),t}})),I._id&&P.default&&P.default.emit("stopped-typing-message",{conversation:I._id,user:i.user})},onFocus:function(){I._id&&P.default&&P.default.emit("started-typing-message",{conversation:I._id,user:i.user})},defaultValue:I._id===Ye.conversation?Ye.content:void 0,onChange:function(e){},placeholder:"Type your message here...",inputRef:f,inputProps:{onKeyDown:function(e){if("Enter"===e.key){e.preventDefault();var t=e.target.value;t=String.isString(t)?t.trim():"",String.isEmpty(t)||(P.default.emit("stopped-typing-message",{conversation:I._id,user:i.user}),function(e){if(I){var t=Object(v.a)(Object(v.a)({},Ye),{},{sender:i.user,created_on:new Date});e&&(JSON.isJSON(e)?t=JSON.merge(e,t):String.isString(e)&&(t.content=e.trim())),(!String.isEmpty(t.content)||["audio","file","video","image"].includes(t.type)&&Array.isArray(t.attachments)&&t.attachments.length>0)&&(P.default.emit("send-message",{message:t,conversation:I,user:i.user}),f.current&&(f.current.value="",f.current.focus()),Xe({is_reply:!1,sender:i.user,reply_for:null,type:"text",content:"",conversation:I._id}))}}(t))}}}})))))),d.a.createElement(k.a,{keepMounted:!0,open:null!==ht.mouseY,onClose:qt,anchorReference:"anchorPosition",anchorPosition:null!==ht.mouseY&&null!==ht.mouseX?{top:ht.mouseY,left:ht.mouseX}:void 0},"conversation"===ht.type&&d.a.createElement(j.a,{onClick:function(e){p("active_conversation",ht.entry),qt()}},"Open Conversation"),"conversation"===ht.type&&d.a.createElement(j.a,{onClick:function(e){var t;t=ht.entry,p("conversations",(function(e){try{var a=JSON.parse(JSON.stringify(e));return a=a.filter((function(e){return!t||(JSON.isJSON(t)?e._id!==t._id:e._id!==t)}))}catch(n){return console.error(n),e}})),P.default.emit("archive-conversation",{conversation:t,user:i.user}),qt()}},"Archive Conversation"),"conversation"===ht.type&&d.a.createElement(j.a,{onClick:function(e){var t;t=ht.entry,p("conversations",(function(e){try{var a=JSON.parse(JSON.stringify(e));return a=a.filter((function(e){return!t||(JSON.isJSON(t)?e._id!==t._id:e._id!==t)}))}catch(n){return console.error(n),e}})),P.default.emit("delete-conversation-for-user",{conversation:t,user:i.user}),qt()}},"Delete Conversation"),"message"===ht.type&&ht.entry.sender._id!==i.user._id&&d.a.createElement(j.a,{onClick:function(e){qt(),Xe({is_reply:!0,sender:i.user,reply_for:ht.entry,content:"",conversation:I._id}),f.current&&(f.current.value="",f.current.focus())}},"Reply Message"),"message"===ht.type&&ht.entry.sender._id===i.user._id&&d.a.createElement(j.a,{onClick:function(e){qt(),P.default&&P.default.emit("delete-message-for-user",{message:ht.entry,user:i.user})}},"Delete For Me"),"message"===ht.type&&ht.entry.sender._id===i.user._id&&d.a.createElement(j.a,{onClick:function(e){qt(),P.default&&P.default.emit("delete-message-for-all",{message:ht.entry,user:i.user})}},"Delete For All")),et&&d.a.createElement(W.a,{open:Boolean(et),autoHideDuration:1e4,onClose:function(){return tt(!1)}},d.a.createElement(Je,{onClose:function(){return tt(!1)},severity:"error"},et)))}Fe.defaultProps={layout:"full",firstView:"conversations",activeConversation:void 0};var Ie=p()(O()((function(e){return{root:{padding:"0",height:"calc(100vh - "+e.spacing(12)+"px)",maxHeight:"100vh",display:"flex",flexDirection:"column",overflowX:"hidden"},text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:e.spacing(7),marginTop:e.spacing(8),flexGrow:1,height:"calc(100% - "+e.spacing(8)+"px)",minHeight:"calc(100% - "+e.spacing(8)+"px)",overflowX:"hidden"},chatPaperWrapper:{position:"relative",marginTop:e.spacing(8),flexGrow:1,height:"calc(100% - "+e.spacing(8)+"px)",minHeight:"calc(100% - "+e.spacing(8)+"px)",overflow:"hidden",padding:0,backgroundColor:e.palette.background.default,background:e.palette.background.default},bodyWrapper:{overflowY:"scroll",overflowX:"hidden",height:"calc(100% - "+e.spacing(4)+"px)"},scrollWrapper:{overflowY:"scroll",overflowX:"hidden"},chatScrollWrapper:{overflowY:"scroll",overflowX:"hidden",top:0,bottom:"auto",height:"80% !important"},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},iconAvatar:{backgroundColor:e.palette.background.default,color:e.palette.accent.main},contactAvatar:{backgroundColor:e.palette.background.paper,color:e.palette.accent.main},avatar:{backgroundColor:e.palette.action.hover,color:e.palette.text.primary,width:e.spacing(5),height:e.spacing(5),borderRadius:e.spacing(2.5)},chatsAppBar:{top:"auto",bottom:0,color:e.palette.background.paper},mainAppBar:{top:0,bottom:"auto",color:e.palette.text.primary,boxShadow:"none"},grow:{flexGrow:1},fabButton:{position:"absolute",zIndex:1,top:-30,left:0,right:0,margin:"0 auto",background:e.palette.accent.main,color:e.palette.background.paper},drawer:{width:e.appDrawer.width,flexShrink:0},drawerPaper:{width:e.appDrawer.width,position:"absolute",zIndex:e.zIndex.appBar+2,backgroundColor:e.palette.background.default},temporaryDrawerPaper:{width:e.appDrawer.width,background:e.palette.background.default},content:{flexGrow:1,padding:0,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentDrawerMargin:{marginRight:-e.appDrawer.width},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0},chatInputsWrapper:{minHeight:"20% !important",padding:0,paddingTop:e.spacing(2),paddingBottom:e.spacing(2),background:e.palette.background.paper,color:e.palette.text.primary},chatBubbleLocal:{maxWidth:"40%",background:e.palette.primary.light,borderBottomRightRadius:"1.5rem",borderBottomLeftRadius:"1.5rem",borderTopRightRadius:0,borderTopLeftRadius:"1.5rem"},chatBubbleExternal:{background:e.palette.background.paper,borderBottomRightRadius:"1.5rem",borderBottomLeftRadius:"1.5rem",borderTopRightRadius:"1.5rem",borderTopLeftRadius:0},chatBubbleLocalSequential:{borderBottomRightRadius:"1.5rem",borderBottomLeftRadius:"1.5rem",borderTopRightRadius:"1.5rem",borderTopLeftRadius:"1.5rem"},"@keyframes typing_loader_line":{"0%":{backgroundColor:e.palette.action.active,boxShadow:"12px 0px 0px 0px rgba(0,0,0,0.2),  24px 0px 0px 0px rgba(0,0,0,0.2)"},"25%":{backgroundColor:e.palette.action.hover,boxShadow:"12px 0px 0px 0px rgba(0,0,0,2), 24px 0px 0px 0px rgba(0,0,0,0.2)"},"75%":{backgroundColor:e.palette.text.disabled,boxShadow:"12px 0px 0px 0px rgba(0,0,0,0.2), 24px 0px 0px 0px rgba(0,0,0,2)"}},typing_loader:{margin:e.spacing(),width:e.spacing(),height:e.spacing(),borderRadius:e.spacing(.5),backgroundColor:"rgba(0,0,0, 1)",webkitAnimation:"$typing_loader_line 1s linear infinite alternate",mozAnimation:"$typing_loader_line 1s linear infinite alternate",animation:"$typing_loader_line 1s linear infinite alternate"}}})),Object(u.b)((function(e){return{auth:e.auth,communication:e.communication,device:e.device}}),{apiCallRequest:h.gb,setMessagingCache:h.Qb,clearMessagingCache:h.nb}),f.a)(Fe),Le=a(50),ze=function(e){Object(i.a)(a,e);var t=Object(s.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.appendNavHistory,n=e.theme;a&&t&&a({name:"messages",uri:t.pathname,title:"Messages",view:null,color:n.palette.primary,scrollTop:0})}},{key:"render",value:function(){this.props.classes;return d.a.createElement(o.a,{className:"m-0 p-0"},d.a.createElement(l.a,{xs:12},d.a.createElement(Ie,null)))}}]),a}(c.Component);t.default=Object(Le.a)(p()(Object(u.b)((function(e){return{auth:e.auth}}),{appendNavHistory:h.hb}),f.a)(ze))}}]);
//# sourceMappingURL=9.15eb9d82.chunk.js.map