(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[14,20],{1347:function(e,t,a){e.exports=a.p+"static/media/empty-state-table.cdb06dd9.svg"},1366:function(e,t,a){"use strict";var n=a(2),r=a(14),i=a(26),o=a(27),s=a(18),l=a(17),c=a(43),d=a.n(c),u=(a(1347),a(263)),p=a(22),m=a(16),h=a(21),f=a(0),v=a.n(f),g=a(35),b=a(63),y=a.n(b),w=a(11),E=a(50),x=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(e){var i;Object(r.a)(this,a),(i=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},records:[]},i.handleDeleteItemConfirm=function(e){return function(t){var a=i.props,n=a.openDialog,r=a.closeDialog;Object(o.a)(i);n({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return r()}},delete:{text:"Delete",color:"error",onClick:function(t){r(),i.handleDeleteItem(e)}}}})}},i.handleDeleteItem=function(e){return function(e){var t=i.props,a=t.openDialog,n=t.closeDialog;a({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return n()}}}})}};var s=e.defination,l=e.service,c=e.query;return i.state.defination=s,i.state.service=l,i.state.query=c?Object(n.a)(Object(n.a)({},c),{},{p:1}):{p:1},i.handleDeleteItemConfirm=i.handleDeleteItemConfirm.bind(Object(o.a)(i)),i.handleDeleteItem=i.handleDeleteItem.bind(Object(o.a)(i)),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var r=this.props.query;this.setState({query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,r=e.query;e.cache;t&&this.setState({defination:t,service:a,query:r?Object(n.a)(Object(n.a)({},r),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n)if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(o)&&o(t),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.googlemapview.resolveData)&&r.views.listing.googlemapview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.googleMapProps,n=e.api,r=e.defination;return v.a.createElement(p.a,{className:t.root},v.a.createElement(m.a,{className:"p-0 m-0",xs:12},v.a.createElement(p.a,{className:"p-0 m-0"},v.a.createElement(p.a,{className:"p-0 m-0"},v.a.createElement(m.a,{className:"p-0 m-0",xs:12},v.a.createElement(p.a,{className:"p-0 m-0"},v.a.createElement(m.a,{xs:12,className:"p-0 m-0"},v.a.createElement(u.a,Object.assign({defaultZoom:12,zoom:12},a,{polylines:r&&"polyline"===r.views.listing.googlemapview.type?this.state.records:[],markers:"marker"===r.views.listing.googlemapview.type?this.state.records:[],circles:"circle"===r.views.listing.googlemapview.type?this.state.records:[],showCurrentPosition:!0})))))),!!n&&(n.complete&&n.error)&&v.a.createElement(p.a,null,v.a.createElement(m.a,{xs:12},v.a.createElement(h.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg))))))}}]),a}(v.a.Component);x.defaultProps={googleMapProps:{mapHeight:900,showClientsPositions:!0,showCurrentPosition:!0},query:{},load_data:!0,cache_data:!0};y()(d()((function(e){return{root:{padding:"0"}}})),Object(g.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:w.gb,openDialog:w.sb,closeDialog:w.pb}),E.a)(x)},1370:function(e,t,a){"use strict";var n=a(6),r=a(9),i=a.n(r),o=a(20),s=a(12),l=a(2),c=a(14),d=a(26),u=a(27),p=a(18),m=a(17),h=a(254),f=a(43),v=a.n(f),g=a(22),b=a(16),y=a(21),w=a(0),E=a.n(w),x=a(35),O=a(63),C=a.n(O),k=a(1574),j=a(1474),_=a(1475),D=a(212),N=a(632),S=a(1240),A=a(1442),R=a.n(A),q=a(1395),P=a.n(q),M=a(1386),I=a.n(M),F=a(1441),V=a.n(F),T=a(56),L=a(59),B=a(109),z=a(261),J=a.n(z),U=a(264),W=a.n(U),K=a(430),Y=a(1347),H=a.n(Y),Z=a(1301),X=a(1337),G=a(1628),$=a(1925),Q=a(1307),ee=a(1425),te=a.n(ee),ae=a(3),ne=a(41),re=a(433),ie=a(687),oe=a(434),se=a(435),le=a(92),ce=a(76),de=a(34),ue=a(45),pe=a(437),me=v()({indicator:{backgroundColor:ae.b.hex.accent}})(X.a),he=v()((function(e){return{root:{textTransform:"none",minWidth:50,fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(),"&:hover":{color:ae.b.hex.default,opacity:1},"&$selected":{color:ae.b.hex.accent,fontWeight:e.typography.fontWeightMedium},"&:focus":{color:ae.b.hex.accent}},selected:{}}}))((function(e){return E.a.createElement(Z.a,e)})),fe=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=E.a.createRef(),n.state={view:"month",view_title:(new Date).format(ce.b.dateformats.month),calendars:[],tasks:[],schedules:[]},n.handleChangeCalendarView=function(e,t){if(n.calendarRef.current){var a=n.calendarRef.current.getInstance().getDate().toDate();n.setState((function(e){return{view:t,view_title:"day"===t?a.format(ce.b.dateformats.date):"week"===t?a.format(ce.b.dateformats.week):a.format(ce.b.dateformats.month)}}))}else n.setState((function(e){return{view:t}}))},n.handleClickPrevButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.prev();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleClickNextButton=function(){if(n.calendarRef.current){var e=n.calendarRef.current.getInstance();e.next();var t=e.getDate().toDate();n.setState((function(e){return{view_title:"day"===e.view?t.format(ce.b.dateformats.date):"week"===e.view?t.format(ce.b.dateformats.week):t.format(ce.b.dateformats.month)}}))}},n.handleOnEditEntryClick=function(e){n.calendarRef.current},n.handleOnDeleteEntryClick=function(e){n.calendarRef.current};var r=e.theme,i=e.view,o=e.calendars,s=e.tasks,d=e.schedules,p=e.show_actions,m=e.icon,h=e.title,f=e.subtitle,v=e.icon_color,g=e.title_color,b=e.subtitle_color,y=e.calendarProps;return n.state=Object(l.a)(Object(l.a)({},n.state),{},{theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:o,tasks:s,schedules:d,show_actions:p,icon:m,title:h,subtitle:f,icon_color:v,title_color:g,subtitle_color:b,calendarProps:y}),n.handleChangeCalendarView=n.handleChangeCalendarView.bind(Object(u.a)(n)),n.handleClickPrevButton=n.handleClickPrevButton.bind(Object(u.a)(n)),n.handleClickNextButton=n.handleClickNextButton.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.initCalendarEvents()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{refreshRequired:!Object.areEqual(e,this.props)}}},{key:"componentDidUpdate",value:function(e,t,a){var n=this.props,r=n.theme,i=n.view,o=n.calendars,s=n.tasks,l=n.schedules,c=n.show_actions,d=n.icon,u=n.title,p=n.subtitle,m=n.icon_color,h=n.title_color,f=n.subtitle_color,v=n.calendarProps;a.refreshRequired&&this.setState({theme:r,view:i,view_title:"day"===i?(new Date).format(ce.b.dateformats.date):"week"===i?(new Date).format(ce.b.dateformats.week):(new Date).format(ce.b.dateformats.month),calendars:o,tasks:s,schedules:l,show_actions:c,icon:d,title:u,subtitle:p,icon_color:m,title_color:h,subtitle_color:f,calendarProps:v},this.initCalendarEvents)}},{key:"initCalendarEvents",value:function(){var e=this.props,t=e.onSelect,a=e.onClickEntry,n=e.onClickEdit,r=e.onClickDelete,i=this.calendarRef.current.getInstance();i&&i.on({clickSchedule:function(e){de.e.isOfType(a,"function")&&a(e.schedule)},beforeCreateSchedule:function(e){de.e.isOfType(t,"function")&&t(e)},beforeUpdateSchedule:function(e){de.e.isOfType(n,"function")&&n(e)},beforeDeleteSchedule:function(e){de.e.isOfType(r,"function")&&r(e)}})}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.height,n=e.defaultView,r=e.disableDblClick,i=e.disableClick,o=e.isReadOnly,s=e.useDetailPopup,c=e.useCreationPopup,d=e.scheduleView,u=e.taskView,p=this.state,m=p.theme,h=p.view,f=p.view_title,v=p.calendars,w=p.tasks,x=p.schedules,O=(p.show_actions,p.icon),C=p.title,k=p.subtitle,j=p.icon_color,_=(p.title_color,p.subtitle_color,p.calendarProps),D=Object(l.a)({height:a+"px",defaultView:n,disableDblClick:r,disableClick:i,isReadOnly:o,useDetailPopup:s,useCreationPopup:c,scheduleView:d,taskView:u},_);return E.a.createElement(re.a,{elevation:0,outlineColor:"#cfd8dc"},E.a.createElement(se.a,{avatar:E.a.createElement(ne.a,{"aria-label":C,style:{background:j}},O),title:C,subheader:k}),E.a.createElement(oe.a,{className:"p-0 m-0"},E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{sm:6,md:4},E.a.createElement(me,{value:h,onChange:this.handleChangeCalendarView,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"view change tabs"},E.a.createElement(he,{value:"month",label:"Month"}),E.a.createElement(he,{value:"week",label:"Week"}),E.a.createElement(he,{value:"day",label:"Day"}))),E.a.createElement(b.a,{sm:6,md:4},E.a.createElement(y.a,{variant:"h3",center:!0}," ",f," ")),E.a.createElement(b.a,{sm:12,md:4},E.a.createElement("div",{className:"float-right"},E.a.createElement(B.a,{onClick:this.handleClickPrevButton},E.a.createElement(G.a,null)),E.a.createElement(B.a,{onClick:this.handleClickNextButton},E.a.createElement($.a,null))))),E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{xs:12},E.a.createElement(te.a,Object.assign({theme:m,view:h,className:t.calendar,calendars:v,tasks:w,schedules:x,ref:this.calendarRef},D)))))),E.a.createElement(ie.a,null,E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{variant:"subtitle2",display:"block",color:"default",gutterBottom:!0}," ","Calendar index"," ")),E.a.createElement(b.a,{xs:12},v.map((function(e,t){return E.a.createElement(le.a,{color:e.bgColor?e.bgColor:ae.b.hex.secondary,text:e.name,key:"calendar-"+t})}))))))}}]),a}(E.a.Component);fe.defaultProps={calendars:[],tasks:[],schedules:[],view:"month",theme:{"common.border":"1px solid rgba("+ae.b.rgb.grey+", 0.5)","common.backgroundColor":"#fcfcfc","common.holiday.color":ae.b.hex.grey,"common.saturday.color":ae.b.hex.grey,"common.dayname.color":ae.b.hex.default,"common.today.color":ae.b.hex.primary,"week.currentTime.color":ae.b.hex.primarydark},show_actions:!0,icon:E.a.createElement(Q.a,null),title:"My",subtitle:"Calendar",icon_color:ae.b.hex.primary,title_color:ae.b.hex.primary,subtitle_color:ae.b.hex.grey,calendarProps:{},height:900,defaultView:"month",disableDblClick:!0,disableClick:!1,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!0};var ve=Object(ue.a)(v()(pe.a)(fe)),ge=a(168),be=a(11),ye=a(50),we=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).calendarRef=E.a.createRef(),n.state={loading:!0,load_error:!1,records:[]},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;r({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{}}),n.state.service.delete(e).then((function(e){i(),n.loadData()})).catch((function(e){console.log("CalendarView delete error",e),i()}))}};var r=e.defination,i=e.service,o=e.query;e.app;return n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1}):{p:1},n.handleEditItem=n.handleEditItem.bind(Object(u.a)(n)),n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.loadContext()}},{key:"getSnapshotBeforeUpdate",value:function(e){return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination)&&!Object.areEqual(e.service,this.props.service),dataReloadRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&this.loadContext(),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"componentWillUnmount",value:function(){var e=this.props;e.openDialog;(0,e.closeDialog)()}},{key:"handleEditItem",value:function(e){var t=this.props.auth;this.state.defination.access.actions.update.restricted(t.user)||(window.location.href="/"+this.state.defination.access.actions.update.uri(e.schedule.id))}},{key:"handleDeleteItemConfirm",value:function(e){var t=this.props,a=t.openDialog,n=t.closeDialog;a({title:"Confirm Delete",body:"Are you sure you want delete "+e.schedule.title+"? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return n()}},delete:{text:"Delete",color:"error",onClick:this.handleDeleteItem(e.schedule.id)}}})}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.auth;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},calendars:[{id:t.name,name:t.label,bgColor:t.color,borderColor:t.color}],records:[],loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n)if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){console.log("calendar data",t),Function.isFunction(o)&&o(t,e.state.query),e.prepareData(t)})).catch((function(t){console.log("calendar error",t),e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l,this.state.query),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=(a.auth,a.cache),r=a.defination,i=Array.isArray(t)?t:Array.isArray(n.data[r.name])?n.data[r.name]:[];r&&r.scope.columns;Function.isFunction(r.views.listing.calendarview.resolveData)&&r.views.listing.calendarview.resolveData(i,!0).then((function(t){e.setState((function(e){return{records:t,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],loading:!1}}))}))}},{key:"render",value:function(){var e=this.props.classes;return E.a.createElement(g.a,{className:e.root},this.state.defination&&E.a.createElement(b.a,{className:"p-0 m-0",xs:12},this.state.loading?E.a.createElement(g.a,{className:e.full_height,justify:"center",alignItems:"center"},E.a.createElement(b.a,{xs:1},E.a.createElement(ge.a,{size:24,thickness:4,className:e.progress,color:"secondary",disableShrink:!0}))):E.a.createElement(g.a,{className:"p-0 m-0"},this.state.load_error?E.a.createElement(g.a,null,E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},E.a.createElement(K.a,{fontSize:"large"},"error"))),E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{color:"error",variant:"body1",center:!0,fullWidth:!0},"An error occured.",E.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,E.a.createElement("br",null),this.state.load_error.msg))):E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{xs:12},E.a.createElement(ve,{icon:this.state.defination.icon,title:this.state.defination.label,title_color:this.state.defination.color,icon_color:this.state.defination.color,subtitle:"",calendars:this.state.calendars,view:"month",schedules:this.state.records,className:e.calendar,onClickEdit:this.handleEditItem,onClickDelete:this.handleDeleteItemConfirm}))):E.a.createElement(g.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},E.a.createElement("img",{alt:"Empty list",className:e.emptyImage,src:H.a}),E.a.createElement(y.a,{className:e.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",this.state.defination.label?this.state.defination.label:"Records"," ","found")))))))}}]),a}(E.a.Component);we.defaultProps={calendarProps:{height:"900px",defaultView:"month",disableDblClick:!0,disableClick:!0,isReadOnly:!1,useDetailPopup:!0,useCreationPopup:!1,scheduleView:!0,taskView:!1},query:{p:1},cache_data:!0,load_data:!0};var Ee=Object(ye.a)(C()(v()((function(e){return{root:{padding:"0"}}})),Object(x.b)((function(e){return{auth:e.auth,app:e.app}}),{apiCallRequest:be.gb,openDialog:be.sb,closeDialog:be.pb}))(we)),xe=(a(1366),a(1380)),Oe=a(1329),Ce=a(1198),ke=a(1202),je=a(1270),_e=a(1274),De=a(1242),Ne=a(1303),Se=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,raw_records:[],records:[]},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props.dispatch;Object(u.a)(n);a(be.sb({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return a(be.pb())}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}}))}},n.handleDeleteItem=function(e){return function(e){var t=n.props.dispatch;t(be.sb({title:"Deleting safely",body:"Please wait. Executing safe delete...",actions:{close:{text:"Close",color:"default",onClick:function(){return t(be.pb())}}}}))}};e.defination;return n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this.props,t=e.defination,a=e.service,n=e.query;e.cache;t&&this.setState({defination:t,service:a,query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1},loading:!1},this.loadData)}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n){if(s)r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(o)&&o(t,e.state.query),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else if(i){var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l,this.state.query),this.prepareData(l)}}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=a.auth,r=a.cache,i=a.defination,o=a.entryItemProps,s=Array.isArray(t)?t:Array.isArray(r.data[i.name])?r.data[i.name]:[];i&&i.scope.columns;Function.isFunction(i.views.listing.listview.resolveData)&&i.views.listing.listview.resolveData(s,n.user,o).then((function(a){e.setState((function(e){return{raw_records:t,records:a,loading:!1}}))})).catch((function(t){e.setState((function(e){return{records:[],raw_records:[],loading:!1}}))}))}},{key:"prepareForData",value:function(){var e=this.props,t=(e.classes,e.defination);e.auth,e.dispatch,t.scope.columns;this.state.records=[],this.state.loading=!1}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=(t.service,t.onClickEntry);return E.a.createElement(g.a,{className:a.root},E.a.createElement(b.a,{className:"p-0 m-0",xs:12},this.state.loading?E.a.createElement(g.a,null,E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-8/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-4/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-5/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-9/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-4/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-3/12"}))),E.a.createElement(b.a,{md:12,className:"flex flex-row items-center relative p-0 px-4 my-4"},E.a.createElement(Ne.a,{variant:"circle",width:40,height:40}),E.a.createElement("div",{className:"flex-grow mx-2 flex flex-col"},E.a.createElement(Ne.a,{variant:"text",className:"w-4/12"})))):E.a.createElement(g.a,{className:"p-0 m-0"},this.state.load_error?E.a.createElement(g.a,null,E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},E.a.createElement(K.a,{fontSize:"large"},"error"))),E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{color:"error",variant:"body1",className:"w-full text-center",center:!0,fullWidth:!0},"An error occured.",E.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,E.a.createElement("br",null),this.state.load_error.msg))):E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{className:"p-0 m-0",xs:12},Array.isArray(this.state.records)&&this.state.records.length>0?E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{xs:12},E.a.createElement(Ce.a,{className:"p-0 transparent-bg"},this.state.records.map((function(t,i){return E.a.createElement("div",{key:n.name+"-"+i},E.a.createElement(ke.a,{button:!0,alignItems:"flex-start",onClick:function(){Function.isFunction(r)&&r(e.state.raw_records[i],i)},className:a.listItem},t.avatar&&E.a.createElement(je.a,null," ",t.avatar," "),t.icon&&E.a.createElement(_e.a,null," ",t.icon," "),E.a.createElement(De.a,{primary:t.title,secondary:t.body})),E.a.createElement(Oe.a,{component:"li"}))}))))):E.a.createElement(g.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},E.a.createElement("img",{alt:"Empty list",className:a.emptyImage,src:H.a}),E.a.createElement(y.a,{className:a.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",n.label?n.label:"Records"," ","found")))))))}}]),a}(E.a.Component);Se.defaultProps={show_actions:!0,show_links:!0,query:{p:1},load_data:!0,cache_data:!0};var Ae=C()(v()((function(e){return{root:{padding:"0"},listItem:{background:"transparent",transition:e.transitions.create("background",{easing:e.transitions.easing.sharp,duration:50}),"&:hover":{background:e.palette.action.hover}}}})),Object(x.b)((function(e,t){t.defination;return{auth:e.auth,cache:e.cache,api:e.api}}),{apiCallRequest:be.gb,openDialog:be.sb,closeDialog:be.pb}),ye.a)(Se),Re=a(1250),qe=(a(1371),a(1204)),Pe=a(1427),Me=a.n(Pe),Ie=a(42),Fe=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={loading:!0,load_error:!1,defination:null,service:null,query:{p:1},dt_columns:[],records:[],raw_data:[],mouseX:null,mouseY:null,actionsView:"contextMenu",context:null},n.handleDeleteItemConfirm=function(e){return function(t){var a=n.props,r=a.openDialog,i=a.closeDialog;Object(u.a)(n);r({title:"Confirm Delete",body:"Are you sure you want delete entry? This action might be irreversible",actions:{cancel:{text:"Cancel",color:"default",onClick:function(){return i()}},delete:{text:"Delete",color:"error",onClick:n.handleDeleteItem(e)}}})}},n.handleDeleteItem=function(e){return function(t){var a=n.props,r=a.openDialog;(0,a.closeDialog)(),e._id&&(e=e._id),n.state.service.delete(e).then((function(t){n.setState((function(t){var a=t.records;return Array.isArray(a)&&(a=a.filter((function(t){if(t.entry){if(t.entry._id===e)return!1}else if(t._id===e)return!1;return!0}))),Array.isArray(a)||(a=[]),{records:a}}))})).catch((function(e){r({title:"Delete failed",body:e.msg,actions:{}})}))}},n.handleOnRowContextMenu=function(e){return function(t){t.preventDefault();var a=t.clientX-2,r=t.clientY-4;console.log("this.state.raw_data[index]",n.state.raw_data[e]),n.setState((function(t){return{mouseX:a,mouseY:r,context:t.raw_data[e]}}))}},n.handleOnRowContextMenuClose=function(e){e.preventDefault(),n.setState({mouseX:null,mouseY:null})};var r=e.defination,i=e.service,o=e.query,s=e.cache.data;return n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1}):{p:1},n.state.records=Array.isArray(s[r.name])?s[r.name]:[],n.mounted=!1,n.handleDeleteItemConfirm=n.handleDeleteItemConfirm.bind(Object(u.a)(n)),n.handleDeleteItem=n.handleDeleteItem.bind(Object(u.a)(n)),n.handleOnRowContextMenu=n.handleOnRowContextMenu.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.cache,a=e.defination;this.mounted=!0,this.loadContext(),this.prepareData(Array.isArray(t.data[a.name])?t.data[a.name]:[])}},{key:"getSnapshotBeforeUpdate",value:function(e){this.mounted=!1;var t=this.props;t.cache,t.defination;return{contextReloadRequired:!Object.areEqual(e.defination,this.props.defination),dataReloadRequired:!Object.areEqual(e.query,this.props.query),dataPreparationRequired:!1}}},{key:"componentDidUpdate",value:function(e,t,a){if(this.mounted=!0,a.contextReloadRequired&&(this.loadContext(),this.prepareData()),a.dataReloadRequired){var n=this.props.query;this.setState({query:n?Object(l.a)(Object(l.a)({},n),{},{p:1}):{p:1}},this.loadData)}}},{key:"loadContext",value:function(){var e=this,t=this.props,a=t.classes,n=t.defination,r=t.service,i=t.query,o=t.auth,c=t.actionsType;if(n){var d=n.scope.columns,u=[];if(!n.access.restricted(o.user)){u.push({name:"entry",label:String.isString(n.label)?n.label.singularize():"Action",options:{filter:!1,sort:!1,customBodyRender:function(t,r,i){if("inline"===c)return E.a.createElement(g.a,{spacing:2,className:a.data_actions_wrapper},Object.keys(n.access.actions).map((function(a,r){return!n.access.actions[a].restricted(o.user)&&E.a.createElement("div",{key:t+"_"+a+"_action"},"delete"===a?n.access.actions[a].link.inline.listing(t,"error_text",e.handleDeleteItemConfirm(t)):n.access.actions[a].link.inline.listing(t))})))}}});for(var p=0,m=Object.entries(d);p<m.length;p++){var h=Object(s.a)(m[p],2),f=h[0],v=h[1],b=!0;v.restricted&&"display"in v.restricted&&"function"===typeof v.restricted.display&&(b=!v.restricted.display(!1,o.user)),b&&(de.e.isOfType(this.state.defination.views.listing.tableview.resolveData,"function")?v.reference||v.possibilities?u.push({name:f,label:v.label,options:{filter:!!v.possibilities,sort:!0,customBodyRender:function(e,t,a){return Array.isArray(e)?E.a.createElement(g.a,{spacing:2},e.map((function(e,t){return E.a.createElement("div",{key:t}," ",e," ")}))):null!==e&&void 0!==e?e:""}}}):u.push({name:f,label:v.label,options:{filter:!!v.possibilities,sort:!0}}):v.reference&&"file"!==v.input.type?u.push({name:f,label:v.label,options:{filter:!!v.possibilities,sort:!0,customBodyRender:function(e,t,n){return Array.isArray(e)?E.a.createElement(g.a,{spacing:2},e.map((function(e,t){return E.a.createElement(Re.a,{className:a.valueChip,key:e.value,label:e.resolve})}))):null!==e&&void 0!==e?E.a.createElement(Re.a,{label:e.resolve}):""}}}):v.reference&&"file"===v.input.type?u.push({name:f,label:v.label,options:{filter:!!v.possibilities,sort:!0,customBodyRender:function(e,t,n){return Array.isArray(e)?E.a.createElement(g.a,{spacing:2},e.map((function(e,t){return E.a.createElement(Re.a,{className:a.valueChip,avatar:E.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e.resolve)?Ie.attachments.getAttachmentFileUrl(e.value):void 0},de.c.fileIcon(e.resolve)),label:e.resolve,onClick:function(t){t.preventDefault(),window.open(Ie.attachments.getAttachmentFileUrl(e.value),"_blank").focus()},key:"file-"+e.value})}))):null!==e&&void 0!==e?E.a.createElement(Re.a,{avatar:E.a.createElement(ne.a,{color:"#cfd8dc",textColor:"#000000",src:"image"===de.c.fileType(e.resolve)?Ie.attachments.getAttachmentFileUrl(e.value):void 0},de.c.fileIcon(e.resolve)),onClick:function(t){t.preventDefault(),window.open(Ie.attachments.getAttachmentFileUrl(e.value),"_blank").focus()},label:e.resolve}):""}}}):u.push({name:f,label:v.label,options:{filter:!!v.possibilities,sort:!0}}))}}this.setState({defination:n,service:r,query:i?Object(l.a)(Object(l.a)({},i),{},{p:1}):{p:1},dt_columns:u,records:[],loading:!1},this.loadData)}}},{key:"parseData",value:function(e){var t=this.props,a=t.defination,n=t.auth,r=e,i=a.scope.columns;r.entry=e;for(var o=0,l=Object.entries(i);o<l.length;o++){var c=Object(s.a)(l[o],2),d=c[0],u=c[1];if("date"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.date):r[d]=""),"datetime"===u.input.type&&e[d]&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.datetime):r[d]=""),"time"===u.input.type&&(e[d]?r[d]=new Date(e[d]).format(ce.b.dateformats.time):r[d]=""),"boolean"===u.type&&(e[d]?r[d]="Yes":r[d]="No"),JSON.isJSON(r[d])&&!u.reference&&(r[d]=JSON.stringify(r[d])),u.possibilities)if(JSON.isJSON(u.possibilities))e[d]in u.possibilities&&(r[d]=u.possibilities[e[d]]);else if(Function.isFunction(u.possibilities)){var p=u.possibilities(e,n.user);JSON.isJSON(p)&&e[d]in p&&(r[d]=p[e[d]])}}return r}},{key:"loadData",value:function(){var e=this,t=this.props,a=(t.auth,t.cache),n=t.defination,r=t.apiCallRequest,i=t.cache_data,o=t.onLoadData,s=t.load_data;if(n)if(s)this.setState({loading:!0,load_error:!1}),r(n.name,{uri:n.endpoint,type:"records",params:this.state.query,data:{},cache:i}).then((function(t){Function.isFunction(o)&&o(t,e.state.query),e.setState({loading:!1}),e.prepareData(t)})).catch((function(t){e.setState((function(e){return{records:[],load_error:t,loading:!1}}))}));else{var l=Array.isArray(a.data[n.name])?a.data[n.name]:[];Function.isFunction(o)&&o(l,this.state.query),this.prepareData(l)}else this.setState((function(e){return{records:[],load_error:{msg:"No Context defination or provided"},loading:!1}}))}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.props,n=a.auth,r=a.cache,i=a.defination,o=Array.isArray(t)?t:Array.isArray(r.data[i.name])?r.data[i.name]:[],s=i?i.scope.columns:{},l=[];if(Function.isFunction(i.views.listing.tableview.resolveData))i.views.listing.tableview.resolveData(o,!0).then((function(t){e.mounted?e.setState((function(e){return{raw_data:o,records:t,loading:!1}})):(e.state.records=t,e.state.loading=!1)})).catch((function(t){e.mounted?e.setState((function(e){return{raw_data:[],records:[],loading:!1}})):(e.state.records=[],e.state.loading=!1)}));else{l=de.d.resolveReferenceColumnsDisplays(o,s,n.user);var c=this,d=l.map((function(e){return c.parseData(e)}));this.setState((function(e){return{records:d}}))}}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.defination,n=e.api,r=(e.cache,e.actionsType),i={filterType:"dropdown",filter:!0,downloadOptions:{filename:(a?a.label:"Records")+" - "+(new Date).format("d M Y H:i:s A")+".csv",separator:","},resizableColumns:!1,selectableRows:"none",responsive:"scroll",pagination:!1,rowHover:!0,customToolbarSelect:function(e,t,a){console.log("customToolbarSelect selectedRows",e),console.log("customToolbarSelect displayData",t)}};return E.a.createElement(g.a,{className:t.root},E.a.createElement(b.a,{className:"p-0 m-0",xs:12},this.state.loading&&E.a.createElement(g.a,{className:t.full_height,justify:"center",alignItems:"center"},E.a.createElement(b.a,{xs:12,className:"flex relative flex-row"},E.a.createElement("div",{className:"flex-grow"},E.a.createElement(Ne.a,{variant:"text",width:150})),E.a.createElement("div",{className:"flex"},E.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),E.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),E.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}),E.a.createElement(Ne.a,{variant:"circle",width:32,height:32,className:"float-right mx-2"}))),E.a.createElement(b.a,{xs:12},E.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),E.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),E.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}),E.a.createElement(Ne.a,{variant:"rect",width:"100%",height:70,className:"mt-2"}))),!this.state.loading&&Array.isArray(this.state.records)&&E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{className:"p-0 m-0",xs:12},"context"===r&&E.a.createElement(qe.a,{onContextMenu:this.handleOnRowContextMenuClose,onClickAway:this.handleOnRowContextMenuClose},E.a.createElement(N.a,{open:null!==this.state.mouseY,onClose:this.handleOnRowContextMenuClose,anchorReference:"anchorPosition",anchorPosition:null!==this.state.mouseY&&null!==this.state.mouseX?{top:this.state.mouseY,left:this.state.mouseX}:void 0},E.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Copy"),E.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Print"),E.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Highlight"),E.a.createElement(S.a,{onClick:this.handleOnRowContextMenuClose},"Email"))),this.state.records.length>0?E.a.createElement(Me.a,{title:(n.loading?"Loading ":"")+a.label+(n.loading?"...":""),data:this.state.records,columns:this.state.dt_columns,options:i}):E.a.createElement(g.a,{className:"p-0 m-0",justify:"center",alignItems:"center"},E.a.createElement("img",{alt:"Empty list",className:t.emptyImage,src:H.a}),E.a.createElement(y.a,{className:t.emptyText,color:"grey",variant:"body2",center:!0,fullWidth:!0},"No"," ",a.label?a.label:"Records"," ","found")))),!!n&&(n.busy&&n.error)&&E.a.createElement(g.a,null,E.a.createElement(b.a,{xs:12},E.a.createElement(y.a,{color:"error",variant:"body2",center:!0,fullWidth:!0},"An error occured. \n "+n.error.msg+" \n Displaying cached data."))))))}}]),a}(E.a.Component);Fe.defaultProps={show_actions:!0,show_links:!0,query:{p:1},cache_data:!0,load_data:!0,actionsType:"inline"};var Ve=Object(ye.a)(C()(v()((function(e){return{root:{padding:"0"},data_actions_wrapper:{display:"inline-block",whiteSpace:"nowrap","& > *":{display:"inline-block",whiteSpace:"nowrap"}},valueChip:{margin:e.spacing(.5)},emptyImage:{maxWidth:200,width:"100%"},emptyText:{marginTop:e.spacing(3)}}})),Object(x.b)((function(e,t){return{auth:e.auth,cache:e.cache,api:e.api}}),{openDialog:be.sb,closeDialog:be.pb,apiCallRequest:be.gb}))(Fe));function Te(e){var t=Object(T.a)(),a=e.count,n=e.page,r=e.rowsPerPage,i=e.onChangePage;return E.a.createElement("div",{className:"ml-2 flex-shrink-0"},E.a.createElement(B.a,{onClick:function(e){i(e,0)},disabled:0===n,"aria-label":"first page"},"rtl"===t.direction?E.a.createElement(V.a,null):E.a.createElement(R.a,null)),E.a.createElement(B.a,{onClick:function(e){i(e,n-1)},disabled:0===n,"aria-label":"previous page"},"rtl"===t.direction?E.a.createElement(I.a,null):E.a.createElement(P.a,null)),E.a.createElement(B.a,{onClick:function(e){i(e,n+1)},disabled:n>=Math.ceil(a/r)-1,"aria-label":"next page"},"rtl"===t.direction?E.a.createElement(P.a,null):E.a.createElement(I.a,null)),E.a.createElement(B.a,{onClick:function(e){i(e,Math.max(0,Math.ceil(a/r)-1))},disabled:n>=Math.ceil(a/r)-1,"aria-label":"last page"},"rtl"===t.direction?E.a.createElement(R.a,null):E.a.createElement(V.a,null)))}var Le=function(e){Object(p.a)(a,e);var t=Object(m.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).state={defination:null,service:null,view:"tableview",views:{},showViewOptions:!0,showAddBtn:!0,searchKeyword:"",query:{},pages:10,page:1,viewMenuAnchorEl:null,sortFields:[],filterAccordionExpanded:!1,filterableFields:{},filterContext:!1,filterMenuAnchor:null,filters:{values:{},labels:{}}},n.mounted=!1,n.searchkeywordRef=E.a.createRef(),n.handleViewItemClick=function(e){return function(t){n.mounted?n.setState({view:e,viewMenuAnchorEl:null}):(n.state.view=e,n.state.viewMenuAnchorEl=null)}},n.handleShowViewsMenu=function(e){var t=e.currentTarget;n.mounted?n.setState({viewMenuAnchorEl:t}):n.state.viewMenuAnchorEl=t},n.handleCloseViewsMenu=function(){n.mounted?n.setState({viewMenuAnchorEl:null}):n.state.viewMenuAnchorEl=null},n.handleOnPageChanged=function(e,t){n.setState((function(e){return{page:t+1,query:Object(l.a)(Object(l.a)({},e.query),{},{page:t+1}),viewMenuAnchorEl:null}}))},n.handleOnRecordsPerPageChanged=function(e){var t=Number.parseNumber(e.target.value,n.state.query.pagination);n.setState((function(e){return{page:1,query:Object(l.a)(Object(l.a)({},e.query),{},{pagination:t})}}))};var r=e.defination,i=e.service,o=e.query,d=(e.cache,e.app);n.state.defination=r,n.state.service=i,n.state.query=o?Object(l.a)(Object(l.a)({},o),{},{p:1,pagination:"rpp"in o?o.rpp:"pagination"in o?o.pagination:d.preferences.data.pagination,page:"pg"in o?o.pg:"page"in o?o.page:1}):{p:1,pagination:"rpp"in o?o.rpp:"pagination"in o?o.pagination:d.preferences.data.pagination,page:"pg"in o?o.pg:"page"in o?o.page:1};var p={},m=!1,h="";if(Object.entries(r.scope.columns).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(p[n]=r)})),JSON.isJSON(o)){var f=!1,v=Object.keys(p);Object.entries(o).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];!f&&v.includes(a)&&(m=a,h=n,h=String.isString(n)?n:String(n),f=!0)}))}return m||!o.q&&!o.query?(n.state.searchKeyword=h,n.state.filterContext=m):o.q?n.state.searchKeyword=o.q:n.state.searchKeyword=o.query,n.handleViewItemClick=n.handleViewItemClick.bind(Object(u.a)(n)),n.handleOnPageChanged=n.handleOnPageChanged.bind(Object(u.a)(n)),n.handleOnRecordsPerPageChanged=n.handleOnRecordsPerPageChanged.bind(Object(u.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0,this.prepareForRender()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"getSnapshotBeforeUpdate",value:function(e){return this.mounted=!1,{prepareForRenderRequired:!Object.areEqual(e.query,this.props.query)}}},{key:"componentDidUpdate",value:function(e,t,a){this.mounted=!0,a.prepareForRenderRequired&&this.prepareForRender()}},{key:"prepareForRender",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a,n,r,o,c,d,u,p,m,h,f,v,g,b,y,w,E,x,O,C;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.defination,n=t.service,r=t.query,o=t.view,c=t.showViewOptions,d=t.showAddBtn,u=t.app,a&&n){p={tableview:"Table View",listview:"List View",googlemapview:"Map View",vectormapview:"Vector Map View",calendarview:"Calendar View"},m={},h="tableview",a.views.listing.default in p&&(h=a.views.listing.default);for(f=0,v=Object.entries(p);f<v.length;f++)g=Object(s.a)(v[f],2),b=g[0],y=g[1],b in a.views.listing&&(m[b]=y);w={},E=!1,x="",Object.entries(a.scope.columns).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];["file","dynamic","textarea","password","wysiwyg","map","file","slider","multiselect"].includes(r.input.type)||(w[n]=r)})),JSON.isJSON(r)&&(O=!1,C=Object.keys(w),Object.entries(r).map((function(e){var t=Object(s.a)(e,2),a=t[0],n=t[1];!O&&C.includes(a)&&(E=a,x=n,x=String.isString(n)?n:String(n),O=!0)}))),console.log("this.searchkeywordRef","this.searchkeywordRef"),this.mounted?this.setState((function(e){return{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:m,view:o||h,showViewOptions:c,showAddBtn:d,filterableFields:w,searchKeyword:x,filterContext:E}})):this.state=Object(l.a)(Object(l.a)({},this.state),{},{defination:a,service:n,query:r?Object(l.a)(Object(l.a)({},r),{},{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1}):{p:1,pagination:"rpp"in r?r.rpp:"pagination"in r?r.pagination:u.preferences.data.pagination,page:"pg"in r?r.pg:"page"in r?r.page:1},views:m,view:o||h,showViewOptions:c,showAddBtn:d,filterableFields:w,searchKeyword:x,filterContext:E})}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,r=t.auth,i=(t.query,t.defination),o=(t.service,t.cache),c=(t.api,t.showPagination),d=t.showSorter,u=t.cache_data,p=t.onLoadData,m=t.load_data,f=t.onClickEntry,v=(t.sorterFormLayoutType,this.state.view);return E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(g.a,{className:"p-0 m-0"},this.state.showViewOptions&&E.a.createElement(b.a,{sm:12,md:8},Object.entries(this.state.views).map((function(t,a){var n=Object(s.a)(t,2),r=n[0],i=n[1];return E.a.createElement(h.a,{color:"primary",variant:r===v?"contained":"text",onClick:function(t){console.log(r),e.setState({view:r,viewMenuAnchorEl:null})},key:"btn-view-"+r},i)}))),this.state.showAddBtn&&i&&!i.access.actions.create.restricted(r.user)&&E.a.createElement(b.a,{sm:12,md:this.state.showViewOptions?4:12},i.access.actions.create.link.inline.default({className:"float-right"}))),E.a.createElement(g.a,{className:"p-1 m-0"},d&&"googlemapview"!==v&&E.a.createElement(b.a,{xs:12,className:"p-0 m-0 mb-2"},E.a.createElement(g.a,{className:"p-0 m-0"},E.a.createElement(b.a,{xs:12,className:"p-0"},E.a.createElement(j.a,{expanded:this.state.filterAccordionExpanded,className:"p-0",variant:"outlined"},E.a.createElement(D.a,{component:"form",elevation:0,className:a.searchRoot,onSubmit:function(t){t.preventDefault(),e.setState((function(e){return{query:e.filterContext?Object(l.a)(Object(l.a)({},e.query),{},Object(n.a)({},e.filterContext,e.searchKeyword)):Object(l.a)(Object(l.a)({},e.query),{},{q:e.searchKeyword})}})),console.log("Search submit searchKeyword",e.state.searchKeyword)}},!this.state.filterContext&&E.a.createElement(B.a,{className:a.filterIconButton,"aria-label":"Filter",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},E.a.createElement(J.a,null)),this.state.filterContext&&this.state.filterableFields[this.state.filterContext]&&E.a.createElement(h.a,{"aria-label":"Filter",size:"small",color:"secondary",onClick:function(t){t.preventDefault(),e.setState({filterMenuAnchor:t.currentTarget})}},Function.isFunction(this.state.filterableFields[this.state.filterContext].label)?this.state.filterContext.humanize():this.state.filterableFields[this.state.filterContext].label),E.a.createElement(N.a,{id:"filter-fields-menu",anchorEl:this.state.filterMenuAnchor,keepMounted:!0,open:Boolean(this.state.filterMenuAnchor),onClose:function(){return e.setState({filterMenuAnchor:null})}},Object.entries(this.state.filterableFields).map((function(t,a){var n=Object(s.a)(t,2),r=n[0],i=n[1];return E.a.createElement(S.a,{onClick:function(){e.setState({filterContext:e.state.filterContext!==r&&r,filterMenuAnchor:null})}},Function.isFunction(i.label)?r.humanize():i.label)}))),E.a.createElement(L.m,{className:a.searchInput,placeholder:"Search...",inputProps:{"aria-label":"Search"},defaultValue:this.state.searchKeyword,onFocus:function(){e.state.filterAccordionExpanded||e.setState({filterAccordionExpanded:!0})},onChange:function(t){e.setState((function(e){var a={searchKeyword:t};if(e.query&&e.query.q){var n=JSON.fromJSON(e.query);delete n.q,a.query=n}return a}))},variant:"base",ref:function(t){return e.searchkeywordRef=t}}),E.a.createElement(B.a,{type:"submit",className:a.searchIconButton,"aria-label":"search"},E.a.createElement(W.a,null))),E.a.createElement(_.a,{className:"p-0"},Object.keys(this.state.filters.values).length>0&&E.a.createElement(g.a,{className:"m-0"},Object.entries(this.state.filters.labels).map((function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1];return E.a.createElement(Re.a,{className:"mx-1 my-1 max-w-xs",color:"secondary",label:(String.isString(i.scope.columns[n].label)?i.scope.columns[n].label+" : ":"")+r,variant:"outlined",style:{maxWidth:180},key:"filter-chip-"+t})})))))))),E.a.createElement(b.a,{xs:12,className:"p-0 m-0"},"tableview"==v&&E.a.createElement(Ve,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"googlemapview"===v&&E.a.createElement(xe.default,{context:i.name,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"calendarview"===v&&E.a.createElement(Ee,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}),"listview"===v&&E.a.createElement(Ae,{defination:i,service:this.state.service,query:this.state.query,cache_data:u,load_data:m,onLoadData:p,onClickEntry:f}))),c&&"googlemapview"!=v&&E.a.createElement(g.a,{className:"p-0 m-0 mb-4"},E.a.createElement(b.a,{xs:12,className:"p-2 flex items-center justify-center"},E.a.createElement(k.a,{count:i.name in o.res?o.res[i.name].count:1,page:i.name in o.res?o.res[i.name].page-1:this.state.page-1,rowsPerPage:this.state.query.pagination,onChangePage:this.handleOnPageChanged,labelRowsPerPage:"Records per page",rowsPerPageOptions:[5,10,25,50,100,{value:-1,label:"All"}],onChangeRowsPerPage:this.handleOnRecordsPerPageChanged,ActionsComponent:Te,SelectProps:{label:"Records per page",variant:"outlined"},classes:{toolbar:"flex-col-reverse px-2"}}))))}}]),a}(E.a.Component);Le.defaultProps={show_actions:!0,show_links:!0,showViewOptions:!0,showAddBtn:!0,showPagination:!0,showSorter:!0,sorterFormLayoutType:"inline",query:{},load_data:!0,cache_data:!0};t.a=C()(v()((function(e){return{root:{padding:e.spacing(),backgroundColor:e.palette.background.paper},calendar:{borderRight:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important",borderLeft:"1px solid rgba("+ae.b.rgb.grey+", 0.5) !important"},activeVieBtn:{background:ae.b.hex.primary,color:ae.b.hex.inverse,border:"1px solid"+ae.b.hex.primary},viewBtnGroup:{position:"absolute !important",right:e.spacing()},searchRoot:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%",margin:0},searchInput:{marginLeft:e.spacing(1),flex:1},searchIconButton:{padding:10},searchDivider:{height:28,margin:4}}})),Object(x.b)((function(e){return{auth:e.auth,cache:e.cache,api:e.api,app:e.app}}),{}),ye.a)(Le)},1380:function(e,t,a){"use strict";a.r(t);var n=a(24),r=a(12),i=a(9),o=a.n(i),s=a(6),l=a(2),c=a(20),d=a(14),u=a(26),p=a(27),m=a(18),h=a(17),f=a(109),v=a(29),g=a.n(v),b=a(43),y=a.n(b),w=a(1344),E=a(1198),x=a(1202),O=a(1242),C=a(1270),k=a(259),j=a.n(k),_=a(219),D=(a(3),a(41)),N=a(433),S=a(687),A=a(434),R=a(435),q=a(22),P=a(16),M=a(21),I=a(1926),F=a(1927),V=a(601),T=a(1426),L=a.n(T),B=a(0),z=a.n(B),J=a(35),U=a(11),W=a(72),K=a(63),Y=a.n(K),H=a(263),Z=(a(1366),a(1370)),X=a(59),G=a(50),$=a(451),Q=a.n($),ee=a(452),te=a.n(ee),ae=!1,ne=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(d.a)(this,a),(n=t.call(this,e)).state={definations:{},services:{},defination:null,service:null,drawerOpen:!0,show_client_positions:!0,clients_positions:{},context:"commissions",context_entry:null,defaultZoom:10,multicontexts:!0,rendered_contexts:[],contexts_props:{},zoom:15,query:{},records:[],markers:[],circles:[],polylines:[]},n.toggleDrawer=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&e!==n.state.drawerOpen&&n.setState((function(t){return{drawerOpen:e}}))}},n.handleOnDrawerNavigationValueChange=function(e,t){var a=n.props,r=a.definations,i=a.services,o=a.cache;n.setState((function(e){return{context:t,context_entry:null,context_entries:["commissions","tracks"].includes(t)&&Array.isArray(o.data[t])?o.data[t]:[],defination:["commissions","tracks"].includes(t)?r[t]:e.defination,service:["commissions","tracks"].includes(t)?i[t]:e.service}}))},n.handleClientListItemClick=function(e,t){return function(e){console.log("handleClientListItemClick client",t,"googleMap",ae),ae&&(ae.panTo({lat:t.position.latitude,lng:t.position.longitude}),ae.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.setZoom(15))}},n.handleToggleContextRender=function(e,t){var a=n.props,r=a.definations,i=(a.cache,a.apiCallRequest),d=a.app;n.setState((function(t){var a=t.rendered_contexts.indexOf(e);return{rendered_contexts:t.rendered_contexts.includes(e)?t.rendered_contexts.removeAtIndex(a):t.rendered_contexts.concat([e])}}),Object(c.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r[e]&&t?i(r[e].name,{uri:r[e].endpoint,type:"records",params:JSON.isJSON(n.state.contexts_props[e])?n.state.contexts_props[e].query:{page:1,pagination:d.preferences.data.pagination,populate:1},data:{},cache:!0}).then((function(t){r[e]&&Function.isFunction(r[e].views.listing.googlemapview.resolveData)&&Array.isArray(t)&&r[e].views.listing.googlemapview.resolveData(t,!0).then((function(a){n.isMounted()?n.setState((function(n){return{context_entry_type:r[e].views.listing.googlemapview.type,context_entry:t.length>0?0:void 0,contexts_props:Object(l.a)(Object(l.a)({},n.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0})))}})):(n.state.context_entry_type=r[e].views.listing.googlemapview.type,n.state.context_entry=t.length>0?0:void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:a,element:r[e].views.listing.googlemapview.type,loaded:!0}))))}))})).catch((function(e){})):r[e]&&(n.isMounted()?n.setState((function(t){return{context_entry_type:void 0,context_entry:void 0,contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},t.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))}})):(n.state.context_entry_type=void 0,n.state.context_entry=void 0,n.state.contexts_props=Object(l.a)(Object(l.a)({},n.state.contexts_props),{},Object(s.a)({},e,Object(l.a)(Object(l.a)({},n.state.contexts_props[e]),{},{elements:[],element:r[e].views.listing.googlemapview.type,loaded:!1})))));case 1:case"end":return a.stop()}}),a)}))))},n.handleContextEntryClick=function(e,t){n.setState({context_entry:t})};var r=n.props,i=(r.device,r.cache),u=r.context,m=r.contexts,h=(r.definations,r.app);return n.elementRef=z.a.createRef(),n.prepareForView(),n.toggleDrawer=n.toggleDrawer.bind(Object(p.a)(n)),n.handleOnLoadMap=n.handleOnLoadMap.bind(Object(p.a)(n)),n.handleClientListItemClick=n.handleClientListItemClick.bind(Object(p.a)(n)),n.handleOnToggleShowClients=n.handleOnToggleShowClients.bind(Object(p.a)(n)),n.handleOnClientsPositionsLoaded=n.handleOnClientsPositionsLoaded.bind(Object(p.a)(n)),n.handleOnClientPositionAvailable=n.handleOnClientPositionAvailable.bind(Object(p.a)(n)),n.handleOnClientPositionUnavailable=n.handleOnClientPositionUnavailable.bind(Object(p.a)(n)),n.handleOnClientPositionChanged=n.handleOnClientPositionChanged.bind(Object(p.a)(n)),n.handleOnDrawerNavigationValueChange=n.handleOnDrawerNavigationValueChange.bind(Object(p.a)(n)),n.handleContextEntryClick=n.handleContextEntryClick.bind(Object(p.a)(n)),n.handleToggleContextRender=n.handleToggleContextRender.bind(Object(p.a)(n)),n.state=Object(l.a)(Object(l.a)({},n.state),{},{context:u||n.state.context,defaultZoom:h.preferences.data.defaultMapZoom,multicontexts:!!Array.isArray(m)&&m.length>1,rendered_contexts:u?[u]:[],contexts_props:u?Object(s.a)({},u,{query:{page:1,pagination:h.preferences.data.pagination,populate:1},element:"marker",records:[]}):{},context_entries:Array.isArray(i.data[n.state.defination.name])?i.data[n.state.defination.name]:[],drawerOpen:!1}),n}return Object(u.a)(a,[{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"componentDidMount",value:function(){}},{key:"prepareForView",value:function(){for(var e=this.props,t=e.auth,a=e.definations,n=e.services,i=e.app,o=null,s=null,l={},c={},d=this.state.contexts_props,u=0,p=Object.entries(a);u<p.length;u++){var m=Object(r.a)(p[u],2),h=m[0],f=m[1];f.access.restricted(t.user)||f.views.listing.googlemapview&&Function.isFunction(f.views.listing.googlemapview.resolveData)&&(l[h]=f,c[h]=n[h],d[h]={query:{page:1,pagination:i.preferences.data.pagination,populate:1},element:f.views.listing.googlemapview.type,elements:[],loaded:!1},null===o&&(o=f,s=n[h]))}this.state.contexts_props=d,this.state.definations=l,this.state.services=c,this.state.defination=o,this.state.service=s}},{key:"handleOnToggleShowClients",value:function(e){this.setState((function(e){return{show_client_positions:!e.show_client_positions}}))}},{key:"handleOnLoadMap",value:function(e,t){ae=e}},{key:"handleOnClientsPositionsLoaded",value:function(e){this.setState((function(t){return{clients_positions:e}}))}},{key:"handleOnClientPositionAvailable",value:function(e,t){this.setState((function(a){return{clients_positions:Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(s.a)({},e,t))}}))}},{key:"handleOnClientPositionUnavailable",value:function(e,t){this.setState((function(t){var a=JSON.fromJSON(t.clients_positions);return delete a[e],{clients_positions:a}}))}},{key:"handleOnClientPositionChanged",value:function(e,t){this.setState((function(a){return{clients_positions:a.drawerOpen?Object(l.a)(Object(l.a)({},a.clients_positions),{},Object(s.a)({},e,t)):a.clients_positions}}))}},{key:"render",value:function(){var e,t=this,a=this.props,i=a.theme,o=a.classes,c=(a.showAll,a.device),d=(a.sockets,a.definations),u=a.services,p=a.contexts,m=a.actions,h=this.state,v=h.context,b=h.clients_positions,y=(h.show_client_positions,h.rendered_contexts),k=h.contexts_props,V=[],T=[],B=[];return y.map((function(e){d[e]&&e in k&&("marker"===k[e].element&&Array.isArray(k[e].elements)?T=T.concat(k[e].elements):"circle"===k[e].element&&Array.isArray(k[e].elements)?V=V.concat(k[e].elements):"polyline"===k[e].element&&Array.isArray(k[e].elements)&&(B=B.concat(k[e].elements)))})),z.a.createElement(N.a,{elevation:0,outlineColor:i.palette.text.primary,style:{backgroundColor:i.palette.background.paper},ref:this.elementRef},z.a.createElement(R.a,{avatar:z.a.createElement(D.a,{style:{backgroundColor:"rgba(0,0,0,0.05)",color:i.palette.text.primary}},z.a.createElement(L.a,null)),title:this.props.context?d[this.props.context]?d[this.props.context].label+" Map":"Map":"Map Overview",subheader:"Click on any context marker, route or polyline in the map for more infomation on the context ",action:z.a.createElement("div",null,Array.isArray(m)&&m.map((function(e,t){var a=e.onClick,r=e.icon,i=Object(n.a)(e,["onClick","icon"]);return z.a.createElement(f.a,Object.assign({"aria-label":"Action",className:"mx-1 inverse-text translucent ",onClick:a,style:{backgroundColor:"rgba(0,0,0,0.05)"},key:"action-button-"+t},i),r)})),z.a.createElement(f.a,{"aria-label":"menu",color:"inherit",className:"mx-1 inverse-text ",onClick:this.toggleDrawer(!this.state.drawerOpen),style:{backgroundColor:"rgba(0,0,0,0.05)"}},z.a.createElement(j.a,{path:_.f,title:"Map Overview Drawer Menu",rotate:this.state.drawerOpen?0:180,size:.8,color:i.palette.text.primary})))}),z.a.createElement(A.a,{className:"p-0 m-0 overflow-x-hidden"},z.a.createElement(q.a,{className:"p-0 m-0"},z.a.createElement(P.a,{xs:12,className:o.wrapper},z.a.createElement("div",{className:g()(o.content,(e={},Object(s.a)(e,o.contentDrawerMargin,c.window_size.width>=1280),Object(s.a)(e,o.contentShift,this.state.drawerOpen&&c.window_size.width>=1280),e)),style:{minHeight:c.window_size.height,backgroundColor:i.palette.background.paper}},z.a.createElement(H.a,{mapHeight:c.window_size.height,showClientsPositions:y.includes("clients_positions"),showCurrentPosition:!0,onLoadClientsPositions:this.handleOnClientsPositionsLoaded,onClientPositionAvailable:this.handleOnClientPositionAvailable,onClientPositionUnavailable:this.handleOnClientPositionUnavailable,onClientPositionChanged:this.handleOnClientPositionChanged,selectedEntry:this.state.context_entry,selectedEntryType:this.state.context_entry_type?this.state.context_entry_type:"clients_position",defaultZoom:this.state.defaultZoom,zoom:this.state.zoom,onMapLoad:this.handleOnLoadMap,polylines:B,markers:T,circles:V})),z.a.createElement(w.a,{className:o.drawer,variant:c.window_size.width>=1280?"persistent":"temporary",anchor:"right",open:this.state.drawerOpen,onClose:this.toggleDrawer(!1),onOpen:this.toggleDrawer(!0),classes:{paper:c.window_size.width>=1280?o.drawerPaper:o.temporaryDrawerPaper}},this.state.multicontexts&&z.a.createElement(I.a,{value:v,onChange:this.handleOnDrawerNavigationValueChange,showLabels:!0,className:"w-full"},z.a.createElement(F.a,{value:"clients_positions",label:"Users",icon:z.a.createElement(j.a,{path:_.a,title:"Clients Postions Users",size:1})}),Object.entries(this.state.definations).map((function(e,t){var a=Object(r.a)(e,2),n=a[0],i=a[1];return z.a.createElement(F.a,{value:n,label:i.label,icon:i.icon,key:"googlemapview-btn-"+n+"-option"})}))),"clients_positions"===v&&0===Object.size(b)&&z.a.createElement(q.a,null,z.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},z.a.createElement(j.a,{path:_.d,title:"No Records available yet.",color:"#CCCCCC",size:5})),z.a.createElement(P.a,{xs:12,className:"flex items-center justify-center p-2"},z.a.createElement(M.a,null,"No Records available yet."))),"clients_positions"===v&&z.a.createElement(E.a,{className:o.root},Object.entries(b).map((function(e,a){var n=Object(r.a)(e,2),i=n[0],o=n[1],s=!0;if(a>0?o.user._id===b[Object.keys(b)[a-1]].user._id&&(s=!1):ae&&(ae.panTo({lat:o.position.latitude,lng:o.position.longitude}),ae.context.__SECRET_MAP_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.setZoom(15)),o.user&&s)return z.a.createElement(x.a,{className:"cursor-pointer hover:bg-gray-400",onClick:t.handleClientListItemClick(i,o),key:"client-"+i},z.a.createElement(C.a,null,z.a.createElement(D.a,{src:String.isString(o.user.gender)&&"female"===o.user.gender.trim().toLowerCase()?Q.a:te.a})),z.a.createElement(O.a,{primary:o.user.first_name+" "+o.user.last_name,secondary:String.isString(o.user.role)?o.user.role.humanize():""}))}))),"commissions"===v&&z.a.createElement(Z.a,{defination:d.commissions,service:u.commissions,query:{},showViewOptions:!1,showAddBtn:!1,showSorter:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[v]&&Function.isFunction(d[v].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[v].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},v,Object(l.a)(Object(l.a)({},t.contexts_props[v]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(a){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},v,Object(l.a)(Object(l.a)({},t.contexts_props[v]),{},{elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}),"tracks"===v&&z.a.createElement(Z.a,{defination:d.tracks,service:u.tracks,showViewOptions:!1,showAddBtn:!1,showSorter:!0,showPagination:!0,sorterFormLayoutType:"normal",view:"listview",onLoadData:function(e,a){d[v]&&Function.isFunction(d[v].views.listing.googlemapview.resolveData)&&Array.isArray(e)&&d[v].views.listing.googlemapview.resolveData(e,!0).then((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},v,Object(l.a)(Object(l.a)({},t.contexts_props[v]),{},{query:a,elements:n,loaded:!0}))),records:e}}))})).catch((function(n){t.setState((function(t){return{contexts_props:Object(l.a)(Object(l.a)({},t.contexts_props),{},Object(s.a)({},v,Object(l.a)(Object(l.a)({},t.contexts_props[v]),{},{query:a,elements:[],loaded:!0}))),records:e}}))}))},onClickEntry:this.handleContextEntryClick}))))),z.a.createElement(S.a,null,z.a.createElement(q.a,{className:"p-0 m-0"},Array.isArray(p)&&p.map((function(e,a){return z.a.createElement(P.a,{xs:12,md:Math.round(12/p.length),className:"flex items-center justify-center",key:"context_entry_switch-"+a},z.a.createElement(X.l,{label:"clients_positions"===e?"Users":d[e]?d[e].label:e,value:t.state.rendered_contexts.includes(e),onChange:function(a){t.handleToggleContextRender(e,a)}}))})),z.a.createElement(P.a,{xs:12},z.a.createElement(M.a,{variant:"body2"},this.props.context&&d[this.props.context]?d[this.props.context].label+" Map from a glance":"Map from a glance")))))}}]),a}(z.a.Component);ne.defaultProps={contexts:["clients_positions","commissions","tracks"],context:"clients_positions",actions:[]};t.default=Object(W.c)(Y()(y()((function(e){return{root:{padding:"0"},wrapper:{display:"flex",margin:0,padding:0},drawer:{width:e.appDrawer.width,flexShrink:0},drawerPaper:{width:e.appDrawer.width,position:"absolute",zIndex:e.zIndex.appBar/2,backgroundColor:e.palette.background.paper},temporaryDrawerPaper:{width:e.appDrawer.width,background:e.palette.background.default},content:{flexGrow:1,padding:0,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentDrawerMargin:{marginRight:-e.appDrawer.width},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}})),Object(J.b)((function(e){return{app:e.app,auth:e.auth,cache:e.cache,device:e.device}}),{apiCallRequest:U.gb,closeDialog:U.pb,openDialog:U.sb}),V.a,G.a)(ne))},1382:function(e,t,a){"use strict";var n=a(47);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),i=(0,n(a(61)).default)(r.default.createElement("path",{d:"M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3zM12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z"}),"WarningRounded");t.default=i},1944:function(e,t,a){"use strict";a.r(t);var n=a(14),r=a(26),i=a(18),o=a(17),s=a(430),l=a(43),c=a.n(l),d=a(1382),u=a.n(d),p=a(3),m=a(23),h=a(22),f=a(16),v=a(168),g=a(21),b=a(28),y=a(0),w=a.n(y),E=a(35),x=a(8),O=a(63),C=a.n(O),k=a(42),j=a(50),_=a(438),D=a(437),N=a(2),S=a(6),A=a(12),R=a(27),q=a(24),P=a(254),M=a(632),I=a(1240),F=a(4),V=a(1267),T=a(109),L=a(256),B=a.n(L),z=a(1370),J=a(1331),U=a(1337),W=a(1301),K=a(1238),Y=a(433),H=a(687),Z=a(434),X=a(435),G=a(76),$=a(34);var Q=Object(E.b)((function(e){return{auth:e.auth}}),{})(Object(j.a)((function(e){var t=Object.assign({},e),a=w.a.useState(!0),n=Object(A.a)(a,2),r=(n[0],n[1],t.record),i=t.defination,o=t.auth,s={};function l(e){return i.scope.columns[e].reference&&s[e]?Array.isArray(s[e])?w.a.createElement(w.a.Fragment,null,s[e].map((function(t,a){return w.a.createElement(g.a,{color:"default",paragraph:!0,key:e+"-"+a},t.resolve)}))):w.a.createElement(g.a,{color:"default",paragraph:!0},s[e].resolve):Array.isArray(s[e])?w.a.createElement(w.a.Fragment,null,s[e].map((function(t,a){return w.a.createElement(g.a,{color:"default",paragraph:!0,key:e+"-"+a},t)}))):JSON.isJSON(s[e])?w.a.createElement(g.a,{color:"default",paragraph:!0},JSON.stringify(s[e])):"date"===i.scope.columns[e].input.type||"datetime"===i.scope.columns[e].input.type?"date"===i.scope.columns[e].input.type?w.a.createElement(g.a,{color:"default",paragraph:!0},s[e]?new Date(s[e]).format(G.b.dateformats.date):""):w.a.createElement(g.a,{color:"default",paragraph:!0},s[e]?new Date(s[e]).format(G.b.dateformats.datetime):""):"boolean"===i.scope.columns[e].type?w.a.createElement(g.a,{color:"default",paragraph:!0},s[e]?"Yes":"No"):w.a.createElement(g.a,{color:"default",paragraph:!0},s[e]?s[e]:"")}return"function"===typeof i.views.single.cardview.resolveData?(s=i.views.single.cardview.resolveData(r,o.user,!0),JSON.isJSON(s)||(s={}),s.resolver="defination"):(s=$.d.resolveReferenceColumnsDisplays([r],i.scope.columns,o.user)[0],JSON.isJSON(s)||(s={}),s.resolver="helper"),i&&r?w.a.createElement(Y.a,{elevation:0,outlineColor:"#CCCCCC"},w.a.createElement(X.a,{avatar:function(){var e=null;return"defination"===s.resolver&&(e=s.avatar),e}(),title:function(){var e="";if("defination"===s.resolver)e=s.title;else if("helper"===s.resolver)for(var t=i.scope.identity.primary,a=0;a<t.length;a++)e+=i.scope.columns[t[a]].reference&&s[t[a]]?s[t[a]].resolve:s[t[a]];return e}(),subheader:function(){var e="";if("defination"===s.resolver)e=s.subtitle;else if("helper"===s.resolver)for(var t=i.scope.identity.secondary,a=0;a<t.length;a++)e+=i.scope.columns[t[a]].reference&&s[t[a]]?s[t[a]].resolve:s[t[a]];return e}()}),w.a.createElement(Z.a,{className:"p-0 m-0"},function(){var e="";return"defination"===s.resolver?e=s.body:"helper"===s.resolver&&(e=w.a.createElement(h.a,{className:"p-0 m-0"},Object.entries(i.scope.columns).map((function(e,t){var a=Object(A.a)(e,2),n=a[0],i=a[1];return i.restricted&&Function.isFunction()?!i.restricted.display(r,o.user)&&w.a.createElement(h.a,{className:"p-0 m-0",key:t},w.a.createElement(f.a,{xs:5},w.a.createElement(g.a,{color:"grey",paragraph:!0},i.label)),w.a.createElement(f.a,{xs:7},l(n))):w.a.createElement(h.a,{className:"p-0 m-0",key:t},w.a.createElement(f.a,{xs:5},w.a.createElement(g.a,{color:"grey",paragraph:!0},i.label)),w.a.createElement(f.a,{xs:7},l(n)))})))),e}()),w.a.createElement(H.a,null)):w.a.createElement(h.a,null)})));function ee(e){var t=e.children,a=e.value,n=e.index,r=Object(q.a)(e,["children","value","index"]);return w.a.createElement(g.a,Object.assign({component:"div",role:"tabpanel",hidden:a!==n,id:"scrollable-force-tabpanel-".concat(n),"aria-labelledby":"scrollable-force-tab-".concat(n)},r),w.a.createElement(K.a,{className:"p-0"},t))}var te=function(e){Object(i.a)(a,e);var t=Object(o.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).state={view:"cardview",views:{},viewMenuAnchorEl:null,expanded:!0},r.handleViewMenuItemClick=function(e){return function(t){r.setState({view:e,viewMenuAnchorEl:null})}},r.handleShowViewsMenu=function(e){r.setState({viewMenuAnchorEl:e.currentTarget})},r.handleCloseViewsMenu=function(){r.setState({viewMenuAnchorEl:null})},r.prepareForView(),r.handleExpandClick=r.handleExpandClick.bind(Object(R.a)(r)),r.handleViewMenuItemClick=r.handleViewMenuItemClick.bind(Object(R.a)(r)),r.handleRelatedTabValueChange=r.handleRelatedTabValueChange.bind(Object(R.a)(r)),r.handleCloseViewsMenu=r.handleCloseViewsMenu.bind(Object(R.a)(r)),r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){}},{key:"handleRelatedTabValueChange",value:function(e,t){this.setState({relatedTab:t})}},{key:"handleExpandClick",value:function(){this.setState((function(e){return{expanded:!e.expanded}}))}},{key:"prepareForView",value:function(){var e=this.props,t=e.defination,a=e.auth,n={cardview:"Card View",googlemapview:"Google Map View",vectormapview:"Vector Map View",calendarview:"Calendar View"},r={},i="cardview";t.views.single.default in n&&(i=t.views.single.default);for(var o=0,s=Object.entries(n);o<s.length;o++){var l=Object(A.a)(s[o],2),c=l[0],d=l[1];c in t.views.single&&(r[c]=d)}var u=null;if(JSON.isJSON(t.scope.dependants))for(var p=0,m=Object.entries(t.scope.dependants);p<m.length;p++){var h=Object(A.a)(m[p],2),f=h[0];h[1];if(b[f].name!==t.name){if(String.isString(u))break;b[f].access.restricted(a.user)||(u=b[f].name)}}this.state.views=r,this.state.view=i,this.state.relatedTab=u}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.auth,r=t.defination,i=t.record,o=t.service;return w.a.createElement(h.a,{className:a.root},w.a.createElement(h.a,null,w.a.createElement(f.a,{xs:12},w.a.createElement(P.a,{className:a.viewSelectBtn,onClick:this.handleShowViewsMenu,"aria-label":"view-select"},this.state.views[this.state.view]),w.a.createElement(M.a,{id:"lock-menu",anchorEl:this.state.viewMenuAnchorEl,keepMounted:!0,open:Boolean(this.state.viewMenuAnchorEl),onClose:this.handleCloseViewsMenu},Object.entries(this.state.views).map((function(t,a){var n=Object(A.a)(t,2),r=n[0],i=n[1];return w.a.createElement(I.a,{key:r,selected:r===e.state.view,onClick:e.handleViewMenuItemClick(r)},i)}))))),w.a.createElement(h.a,null,"cardview"===this.state.view&&w.a.createElement(Q,{defination:r,service:o,record:i})),w.a.createElement(h.a,{className:"p-0"},w.a.createElement(f.a,{xs:12},w.a.createElement(h.a,null,w.a.createElement(f.a,{xs:2,md:1},w.a.createElement(T.a,{className:Object(F.a)(a.expand,Object(S.a)({},a.expandOpen,this.state.expanded)),onClick:this.handleExpandClick,"aria-expanded":this.state.expanded,"aria-label":"show more"},w.a.createElement(B.a,null))),w.a.createElement(f.a,{xs:10,md:11},w.a.createElement(g.a,{className:a.relationsSectionTitle,color:this.state.expanded?"default":"grey",variant:"body2"}," ","Related to this"," ",r.label.singularize()," ")))),w.a.createElement(f.a,{xs:12},w.a.createElement(V.a,{in:this.state.expanded,timeout:"auto"},JSON.isJSON(r.scope.dependants)?w.a.createElement(J.a,{position:"static",color:"default",elevation:0},w.a.createElement(U.a,{value:this.state.relatedTab,onChange:this.handleRelatedTabValueChange,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"related data tabs"},Object.entries(r.scope.dependants).map((function(e,t){var a,r=Object(A.a)(e,2),i=r[0];r[1];return!b[i].access.restricted(n.user)&&w.a.createElement(W.a,Object.assign({value:i,label:b[i].label,icon:b[i].icon,key:t+"_tab"},{id:"scrollable-force-tab-".concat(a=i),"aria-controls":"scrollable-force-tabpanel-".concat(a)}))})))):w.a.createElement(g.a,{color:"grey",paragraph:!0}," ","No Related data"," "),JSON.isJSON(r.scope.dependants)&&Object.entries(r.scope.dependants).map((function(t,a){var r=Object(A.a)(t,2),o=r[0],s=r[1];return!b[o].access.restricted(n.user)&&w.a.createElement(ee,{className:"p-0",value:e.state.relatedTab,index:o,key:"tab-"+a},w.a.createElement(z.a,{defination:b[o],service:k[o],query:Object(N.a)(Object(N.a)({},s.query),{},Object(S.a)({},s.column,i._id)),show_actions:!1,showAddBtn:!1}))}))))))}}]),a}(w.a.Component);te.defaultProps={};var ae=C()(c()((function(e){return{root:{padding:e.spacing()},viewSelectBtn:{position:"absolute !important",right:e.spacing(),bottom:e.spacing()},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"},relationsSectionTitle:{height:"100%",lineHeight:"48px",verticalAlign:"middle"}}})),Object(E.b)((function(e){return{auth:e.auth}}),{}),j.a)(te),ne=function(e){Object(i.a)(a,e);var t=Object(o.a)(a);function a(e){var r;Object(n.a)(this,a),(r=t.call(this,e)).state={loading:!0,load_error:!1,record:null},r.defination=null,r.service=null;var i=e.componentProps,o=e.match.params;return r.context=i.context,r.defination=b[i.context],r.service=k[i.context],r.id=o.id,r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.auth,a=e.location,n=e.appendNavHistory;n&&a&&this.defination&&n({name:this.defination.name.singularize()+"_"+this.id,uri:a.pathname,title:Function.isFunction(this.defination.label)?this.defination.label(t.user).singularize():this.defination.label.singularize(),view:null,color:this.defination.color?this.defination.color:p.b.hex.primary,scrollTop:0}),this.getRecord()}},{key:"getRecord",value:function(){var e=this;this.service.getRecordById(this.id,{p:1}).then((function(t){e.setState({record:t.body.data,loading:!1})})).catch((function(t){e.setState({loading:!1,load_error:t})}))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.auth,n=e.nav,r=!!Array.isArray(n.entries)&&(n.entries.length>1&&n.entries[n.entries.length-2].uri),i=!this.state.loading&&(!JSON.isJSON(this.state.record)||this.defination.access.actions.view_single.restricted(a.user));return w.a.createElement(h.a,{className:t.root},w.a.createElement(f.a,{xs:12},this.state.loading?w.a.createElement(h.a,{className:t.full_height,justify:"center",alignItems:"center"},w.a.createElement(f.a,{xs:1},w.a.createElement(v.a,{size:24,thickness:4,className:t.progress,color:"secondary",disableShrink:!0}))):w.a.createElement(h.a,{className:"p-0 m-0"},this.state.load_error?w.a.createElement(h.a,null,w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},w.a.createElement(s.a,{fontSize:"large"},"error"))),w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"error",variant:"body1",center:!0,fullWidth:!0},"An error occured.",w.a.createElement("br",null),"Status Code :"," ",this.state.load_error.code,w.a.createElement("br",null),this.state.load_error.msg))):w.a.createElement(h.a,null,i&&w.a.createElement(h.a,{className:t.fullPageHeight,direction:"column",justify:"center",alignItems:"center"},w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"error",variant:"h1",center:!0,fullWidth:!0},w.a.createElement(u.a,{className:t.errorIcon}))),w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"grey",variant:"h3",center:!0,fullWidth:!0},"Access Denied!")),w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"default",variant:"body1",center:!0,fullWidth:!0},"Sorry! Access to this resource is prohibitted since you lack required priviledges. ",w.a.createElement("br",null)," Please contact the system administrator for further details.")),w.a.createElement(f.a,{xs:12},w.a.createElement(g.a,{color:"error",variant:"body1",center:!0,fullWidth:!0},w.a.createElement(x.b,{to:"home".toUriWithDashboardPrefix()}," ",w.a.createElement(m.a,{variant:"text",color:"default",simple:!0}," ","Home"," ")," "),r&&w.a.createElement(x.b,{to:r}," ",w.a.createElement(m.a,{variant:"text",color:"default",simple:!0}," ","Back"," ")," ")))),!i&&w.a.createElement(h.a,{className:"p-0 m-0"},w.a.createElement(f.a,{className:"p-0 m-0",xs:12},this.state.record&&w.a.createElement(ae,{defination:this.defination,service:this.service,record:this.state.record})))))))}}]),a}(w.a.Component);t.default=C()(c()(D.a),Object(E.b)((function(e){return{auth:e.auth,nav:e.nav}}),{appendNavHistory:_.a}),j.a)(ne)}}]);
//# sourceMappingURL=14.ddbbec8d.chunk.js.map